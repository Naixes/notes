## Reactä¸­åˆ›å»ºç»„ä»¶

### functionç»„ä»¶

> **ä½¿ç”¨æ„é€ å‡½æ•°æ¥åˆ›å»ºç»„ä»¶**ï¼Œå¦‚æœè¦æ¥æ”¶å¤–ç•Œä¼ é€’çš„æ•°æ®ï¼Œéœ€è¦åœ¨æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­ä½¿ç”¨`props`æ¥æ¥æ”¶ï¼›
>
> å¿…é¡»è¦å‘å¤–returnä¸€ä¸ªåˆæ³•çš„JSXåˆ›å»ºçš„è™šæ‹ŸDOMï¼›

- åˆ›å»ºç»„ä»¶ï¼š

  ```jsx
  function Hello (props) { 
  	// return null 
  	return <div>Hello ç»„ä»¶</div>
  }
  ```

- ä¸ºç»„ä»¶ä¼ é€’æ•°æ®ï¼š

  ```jsx
  // ä½¿ç”¨ç»„ä»¶å¹¶ä¸ºç»„ä»¶ä¼ é€’ props æ•°æ®
  <Hello name={dog.name} age={dog.age} gender={dog.gender}></Hello>
  <Hello {...dog}></Hello>
  
  // åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œä½¿ç”¨ props å½¢å‚ï¼Œæ¥æ”¶å¤–ç•Œä¼ é€’è¿‡æ¥çš„æ•°æ®
  function Hello(props) {
    // props.name = 'zs'
    console.log(props)
    // ç»“è®ºï¼šä¸è®ºæ˜¯ Vue è¿˜æ˜¯ Reactï¼Œç»„ä»¶ä¸­çš„ props æ°¸è¿œéƒ½æ˜¯åªè¯»çš„ï¼›ä¸èƒ½è¢«é‡æ–°èµ‹å€¼ï¼›
    return <div>è¿™æ˜¯ Hello ç»„ä»¶ --- {props.name} --- {props.age} --- {props.gender}</div>
  }
  ```


1. çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®

2. ä½¿ç”¨{...obj}å±æ€§æ‰©æ•£ä¼ é€’æ•°æ®

3. å°†ç»„ä»¶å°è£…åˆ°å•ç‹¬çš„æ–‡ä»¶ä¸­

4. æ³¨æ„ï¼šç»„ä»¶çš„åç§°é¦–å­—æ¯å¿…é¡»æ˜¯å¤§å†™

5. åœ¨å¯¼å…¥ç»„ä»¶çš„æ—¶å€™ï¼Œå¦‚ä½•çœç•¥ç»„ä»¶çš„`.jsx`åç¼€åï¼š

   ```js
   // æ‰“å¼€ webpack.config.js ï¼Œå¹¶åœ¨å¯¼å‡ºçš„é…ç½®å¯¹è±¡ä¸­ï¼Œæ–°å¢ å¦‚ä¸‹èŠ‚ç‚¹ï¼š
   resolve: {
       extensions: ['.js', '.jsx', '.json'], // è¡¨ç¤ºï¼Œè¿™å‡ ä¸ªæ–‡ä»¶çš„åç¼€åï¼Œå¯ä»¥çœç•¥ä¸å†™
       alias: {
           '@': path.join(__dirname, './src')
       }
     }
   ```

6. åœ¨å¯¼å…¥ç»„ä»¶çš„æ—¶å€™ï¼Œé…ç½®å’Œä½¿ç”¨`@`è·¯å¾„ç¬¦å·

#### çŠ¶æ€ç®¡ç†

```js
import { useState, useEffect } from "react"; 
function ClockFunc() { 
    // useStateåˆ›å»ºä¸€ä¸ªçŠ¶æ€å’Œä¿®æ”¹è¯¥çŠ¶æ€çš„å‡½æ•° 
    const [date, setDate] = useState(new Date()); 
    // useEffectç¼–å†™å‰¯ä½œç”¨ä»£ç  
    useEffect(() => { 
        // å¯åŠ¨å®šæ—¶å™¨æ˜¯æˆ‘ä»¬çš„å‰¯ä½œç”¨ä»£ç  
        const timerID = setInterval(() => { setDate(new Date()); }, 1000); 
        // è¿”å›æ¸…ç†å‡½æ•° 
        return () => clearInterval(timerID); 
    }, []);
    // å‚æ•°2ä¼ é€’ç©ºæ•°ç»„ä½¿æˆ‘ä»¬å‚æ•°1å‡½æ•°ä»…æ‰§è¡Œä¸€æ¬¡ 
    return <div>{date.toLocaleTimeString()}</div>; 
}
```

### classç»„ä»¶

#### ES6ä¸­ class å…³é”®å­—çš„ä½¿ç”¨

1. class ä¸­ `constructor` çš„åŸºæœ¬ä½¿ç”¨
2. å®ä¾‹å±æ€§å’Œå®ä¾‹æ–¹æ³•
3. é™æ€å±æ€§å’Œé™æ€æ–¹æ³•

```javascript
// åœ¨ç±»ä¸­åªèƒ½å†™æ„é€ å™¨å®ä¾‹é™æ€æ–¹æ³•å’Œå±æ€§
// æœ¬è´¨å’Œä¹‹å‰çš„æ„é€ å‡½æ•°ä¸€è‡´
class Animal {
    // æ¯ä¸€ä¸ªç±»éƒ½æœ‰æ„é€ å™¨ï¼Œæ²¡æœ‰æŒ‡å®šæ—¶æœ‰é»˜è®¤çš„æ„é€ å™¨
    // newçš„æ—¶å€™ä¼˜å…ˆæ‰§è¡Œæ„é€ å™¨ä¸­çš„ä»£ç 
    constructor(å‚æ•°1, å‚æ•°2) {
        // å®ä¾‹å±æ€§
        this.aa = å‚æ•°1
        this.bb = å‚æ•°2
    }
    // é™æ€å±æ€§ï¼Œé€šè¿‡æ„é€ å‡½æ•°è°ƒç”¨
    static name = 'name'
	// å®ä¾‹æ–¹æ³•
	foo() {}
	// é™æ€æ–¹æ³•
	static foo() {}
}
```

4. ä½¿ç”¨ `extends` å…³é”®å­—å®ç°ç»§æ‰¿

```javascript
class Person {}
class Chinese extends Person{
    constructor(å‚æ•°1, å‚æ•°2) {
        // extendså…³é”®å­—ç»§æ‰¿çš„çˆ¶ç±»ï¼Œè¦åœ¨æ„é€ å™¨æœ€å¼€å§‹è°ƒç”¨super()
        // super()æ˜¯çˆ¶ç±»æ„é€ å™¨çš„å¼•ç”¨
        super(å‚æ•°1, å‚æ•°2)
        this.state={}
    }
    render() {}
}
// å­ç±»å¯ä»¥è®¿é—®çˆ¶ç±»çš„å®ä¾‹æ–¹æ³•
```

5. ä¸ºå­ç±»æŒ‚è½½ç‹¬æœ‰çš„å®ä¾‹æ–¹æ³•å’Œå±æ€§

æ”¾åˆ°super()åé¢

#### åŸºäºclasså…³é”®å­—åˆ›å»ºç»„ä»¶

1. æœ€åŸºæœ¬çš„ç»„ä»¶ç»“æ„ï¼š

   ```jsx
   // å¦‚æœè¦ä½¿ç”¨ class å®šä¹‰ç»„ä»¶ï¼Œå¿…é¡» è®©è‡ªå·±çš„ç»„ä»¶ï¼Œç»§æ‰¿è‡ª React.Component
   class ç»„ä»¶åç§° extends React.Component {
       constructor(...args){
           super(...args)
           // çŠ¶æ€ï¼šconstructorä¸­åˆå§‹åŒ–ï¼Œè¦ç”¨setState({})ä¿®æ”¹æ›´æ–°åä¼šé‡æ–°æ¸²æŸ“ï¼ŒåŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªkeyï¼Œåªä¼šæœ‰ä¸€ä¸ªèµ·ä½œç”¨
           this.state = {
           }
       }
       // åœ¨ç»„ä»¶å†…éƒ¨ï¼Œå¿…é¡»æœ‰ render å‡½æ•°,ä½œç”¨ï¼šæ¸²æŸ“å½“å‰ç»„ä»¶å¯¹åº”çš„ è™šæ‹ŸDOMç»“æ„
       render(){
           const name = "react study"
           const user = { firstName: "tom", lastName: "jerry" }
           function formatName(user) { 
               return user.firstName + " " + user.lastName;
           }
           const greet = <p>hello, Jerry</p>;
           const arr = [1, 2, 3].map(num => <li key={num}>{num}</li>)
           // render å‡½æ•°ä¸­ï¼Œå¿…é¡» è¿”å›åˆæ³•çš„ JSX è™šæ‹ŸDOMç»“æ„
           return ( 
               <div> 
                   {/* æ¡ä»¶è¯­å¥ */} 
                   {name ? <h2>{name}</h2> : null} 
                   {/* å‡½æ•°ä¹Ÿæ˜¯è¡¨è¾¾å¼ */} 
                   {formatName(user)} 
                   {/* jsxä¹Ÿæ˜¯è¡¨è¾¾å¼ */} 
                   {greet} 
                   {/* æ•°ç»„ */} 
                   <ul>{arr}</ul> 
                   {/* å±æ€§ */} 
                   <img src={logo} className={style.img} alt="" /> 
               </div> 
           )
       }
   }
   // ä½¿ç”¨<åç§°></åç§°>ç›¸å½“ä¸'ç»„ä»¶åç§°'ç±»çš„å®ä¾‹å¯¹è±¡
   ```

ä¼ é€’çš„å‚æ•°ä¸ç”¨æ¥æ”¶ï¼Œç›´æ¥ä½¿ç”¨this.propsè®¿é—®ï¼Œåªè¯»

##### setStateç‰¹æ€§

- setStateæ˜¯æ‰¹é‡æ‰§è¡Œçš„ï¼Œå› æ­¤å¯¹åŒä¸€ä¸ªçŠ¶æ€æ‰§è¡Œå¤šæ¬¡åªèµ·ä¸€æ¬¡ä½œç”¨ï¼Œå¤šä¸ªçŠ¶æ€æ›´æ–°å¯ä»¥æ”¾åœ¨åŒä¸€ä¸ª 

setStateä¸­è¿›è¡Œï¼š

```js
componentDidMount() { 
    // å‡å¦‚couteråˆå§‹å€¼ä¸º0ï¼Œæ‰§è¡Œä¸‰æ¬¡ä»¥åå…¶ç»“æœæ˜¯å¤šå°‘ï¼Ÿ 
    this.setState({counter: this.state.counter + 1}); 
    this.setState({counter: this.state.counter + 1}); 
    this.setState({counter: this.state.counter + 1}); 
}
```

- setStateé€šå¸¸æ˜¯å¼‚æ­¥çš„ï¼Œå› æ­¤å¦‚æœè¦è·å–åˆ°æœ€æ–°çŠ¶æ€å€¼æœ‰ä»¥ä¸‹ä¸‰ç§æ–¹å¼ï¼š

1. ä¼ é€’å‡½æ•°ç»™setStateæ–¹æ³•ï¼Œè¿™ä¸ªå‡½æ•°ç”¨ä¸Šä¸€ä¸ª state ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°†æ­¤æ¬¡æ›´æ–°è¢«åº”ç”¨æ—¶çš„ props åšä¸ºç¬¬äºŒä¸ªå‚æ•°

```js
this.setState((state, props) => ({ counter: state.counter + 1}));// 1 
this.setState((state, props) => ({ counter: state.counter + 1}));// 2 
this.setState((state, props) => ({ counter: state.counter + 1}));// 3
```

2. ä½¿ç”¨å®šæ—¶å™¨ï¼š

```js
setTimeout(() => { 
    console.log(this.state.counter); 
}, 0);
```

3. åŸç”Ÿäº‹ä»¶ä¸­ä¿®æ”¹çŠ¶æ€

```js
componentDidMount(){ 
    document.body.addEventListener('click', this.changeValue, false)
}
changeValue = () => { 
    this.setState({counter: this.state.counter+1}) console.log(this.state.counter) 
}
```

### ä¸¤ç§åˆ›å»ºç»„ä»¶æ–¹å¼çš„å¯¹æ¯”

> æ³¨æ„ï¼šä½¿ç”¨ class å…³é”®å­—åˆ›å»ºçš„ç»„ä»¶ï¼Œæœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼ˆthis.stateï¼‰ å’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼›
>
> æ³¨æ„ï¼šä½¿ç”¨ function åˆ›å»ºçš„ç»„ä»¶ï¼Œåªæœ‰propsï¼Œæ²¡æœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®å’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼›

1. ç”¨**æ„é€ å‡½æ•°**åˆ›å»ºå‡ºæ¥çš„ç»„ä»¶ï¼šå«åšâ€œæ— çŠ¶æ€ç»„ä»¶â€ã€ä¸éœ€è¦æœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®æ—¶ä½¿ç”¨ã€‘
2. ç”¨**classå…³é”®å­—**åˆ›å»ºå‡ºæ¥çš„ç»„ä»¶ï¼šå«åšâ€œæœ‰çŠ¶æ€ç»„ä»¶â€ã€éœ€è¦æœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®æ—¶ä½¿ç”¨ã€‘
3. Reactå®˜æ–¹è¯´ï¼šæ— çŠ¶æ€ç»„ä»¶ï¼Œç”±äºæ²¡æœ‰è‡ªå·±çš„stateå’Œç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œæ‰€ä»¥è¿è¡Œæ•ˆç‡ä¼šæ¯”æœ‰çŠ¶æ€ç»„ä»¶ç¨å¾®é«˜ä¸€äº›ï¼›

### PropTypesæ£€æŸ¥å±æ€§ç±»å‹

```react
import PropTypes from 'prop-typs'
...
PriceList.propTypes = {
  items: PropTypes.array.isRequired,
  onModifyItemL: PropTypes.func.isRequired,
  onDeleteItemL: PropTypes.func.isRequired
}

// defaultProps:é»˜è®¤å±æ€§
PriceList.defaultProps = {
  onModifyItemL: () => {}
}
```

### æ¸²æŸ“è¯„è®ºåˆ—è¡¨

![æ•ˆæœ](E:/Jennifer/other/notes/react/media/cmtlist.png)

æœ‰ä¸¤ä¸ªç»„ä»¶ï¼Œä¸€ä¸ªçˆ¶ç»„ä»¶ä¸€ä¸ªå­ç»„ä»¶

#### é€šè¿‡forå¾ªç¯ç”Ÿæˆå¤šä¸ªç»„ä»¶

```jsx
import React from 'react'
import ReactDOM from 'react-dom'

function CommentsItem(props) {
    return {<div>
        <h1>{props.user}</h1>
    	<p>{props.content}</p>
    </div>)}
}

class Comments extends React.Component {
    constructor() {
        super()
        this.state = CommentList: [
            { id: 1, user: 'å¼ ä¸‰', content: 'å“ˆå“ˆï¼Œæ²™å‘' },
            { id: 2, user: 'æå››', content: 'å“ˆå“ˆï¼Œæ¿å‡³' },
            { id: 3, user: 'ç‹äº”', content: 'å“ˆå“ˆï¼Œå‡‰å¸­' },
            { id: 4, user: 'èµµå…­', content: 'å“ˆå“ˆï¼Œç –å¤´' },
            { id: 5, user: 'ç”°ä¸ƒ', content: 'å“ˆå“ˆï¼Œæ¥¼ä¸‹å±±ç‚®' }
        ]
    }
    render() {
        return (
            <div>
            	<h1>è¯„è®ºåˆ—è¡¨</h1>
            	{this.state.CommentList.map(item => <CommentsItem {...item} key={item.id}>				 </CommentsItem>}
        	</div>
		)
    }
}
```

### ç»„ä»¶é€šä¿¡

#### props

ä¼ é€’çŠ¶æ€

ä¼ é€’å‡½æ•°ï¼šå¯ä»¥æŠŠå­ç»„ä»¶ä¿¡æ¯ä¼ å…¥çˆ¶ç»„ä»¶ï¼Œè¿™ä¸ªå¸¸ç§°ä¸ºçŠ¶æ€æå‡

```react
// StateMgt 
<Clock change={this.onChange}/> 
// Clock 
this.timerID = setInterval(() => { 
    this.setState({ date: new Date() }, ()=>{ 
        // æ¯æ¬¡çŠ¶æ€æ›´æ–°å°±é€šçŸ¥çˆ¶ç»„ä»¶ 
        this.props.change(this.state.date); 
    }); 
}, 1000);
```

ä¼ é€’thisï¼š

```jsx
let root = document.getElementById("div")
// çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ å€¼ï¼Œå­ç»„ä»¶å¯ä¿®æ”¹
class Comp extends React.Component{
    constructor(...args){
        super(...args)
        this.state = {
            a: 0
        }
    }
    add(n){
        this.setState({
            a: this.state.a + n
        })
    }
    render() {
        return (
            <div>
                {this.state.a}
                <Sub par={this}/>
            </div>
        )
    }
}
class Sub extends React.Component {
    constructor(...args){
        super(...args)
        this.state = {
        }
    }
    fn(){
        this.props.par.add(1)
    }
    render() {
        return (
            <div>
                <input type="button" value="+1" onClick={this.fn.bind(this)} />
            </div>
        )
    }
}
ReactDOM.render(
    <div className="box">
        <div>
            <Comp a={2}/>
        </div>
    </div>,
    root
)
```

#### ref

```jsx
let root = document.getElementById("div")
// å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ å€¼ï¼Œçˆ¶ç»„ä»¶å¯ä¿®æ”¹
class Comp extends React.Component{
    constructor(...args){
        super(...args)
        this.state = {
        }
    }
    fn(){
        this.refs['sub'].add(1);
    }
    render() {
        return (
            <div>
                <input type="button" value="+1" onClick={this.fn.bind(this)} />
                <Sub ref='sub'/>
            </div>
        )
    }
}
class Sub extends React.Component{
    constructor(...args){
        super(...args)
        this.state = {
            a: 2
        }
    }
    add(n){
        this.setState({
            a: this.state.a + n
        })
    }
    render() {
        return (
            <div>
                {this.state.a}
            </div>
        )
    }
}
ReactDOM.render(
    <div className="box">
        <div>
            <Comp a={2}/>
        </div>
    </div>,
    root
)
```

#### context

è·¨å±‚çº§ç»„ä»¶ä¹‹é—´é€šä¿¡ 

```react
// ä¸ºå½“å‰çš„ theme åˆ›å»ºä¸€ä¸ª contextï¼ˆâ€œlightâ€ä¸ºé»˜è®¤å€¼ï¼‰ã€‚æ¯ä¸ª Context å¯¹è±¡éƒ½ä¼šè¿”å›ä¸€ä¸ª Provider React ç»„ä»¶ï¼Œå®ƒå…è®¸æ¶ˆè´¹ç»„ä»¶è®¢é˜… context çš„å˜åŒ–ã€‚
const ThemeContext = React.createContext('light');
class App extends React.Component {
  render() {
    // ä½¿ç”¨ä¸€ä¸ª Provider æ¥å°†å½“å‰çš„ theme ä¼ é€’ç»™ä»¥ä¸‹çš„ç»„ä»¶æ ‘ã€‚
    // æ— è®ºå¤šæ·±ï¼Œä»»ä½•ç»„ä»¶éƒ½èƒ½è¯»å–è¿™ä¸ªå€¼ã€‚
    // åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°† â€œdarkâ€ ä½œä¸ºå½“å‰çš„å€¼ä¼ é€’ä¸‹å»ã€‚
    return (
      <ThemeContext.Provider value="dark">
        <Toolbar />
      </ThemeContext.Provider>
    );
  }
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}

class ThemedButton extends React.Component {
  // æŒ‚è½½åœ¨ class ä¸Šçš„ contextType å±æ€§ä¼šè¢«é‡èµ‹å€¼ä¸ºä¸€ä¸ªç”± React.createContext() åˆ›å»ºçš„ Context å¯¹è±¡ã€‚è¿™èƒ½è®©ä½ ä½¿ç”¨ this.context æ¥æ¶ˆè´¹æœ€è¿‘ Context ä¸Šçš„é‚£ä¸ªå€¼ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ç”Ÿå‘½å‘¨æœŸä¸­è®¿é—®åˆ°å®ƒï¼ŒåŒ…æ‹¬ render å‡½æ•°ä¸­ã€‚
  // React ä¼šå¾€ä¸Šæ‰¾åˆ°æœ€è¿‘çš„ theme Providerï¼Œç„¶åä½¿ç”¨å®ƒçš„å€¼ã€‚
  static contextType = ThemeContext;
  render() {
    return <Button theme={this.context} />;
  }
}
```

Context ä¸»è¦åº”ç”¨åœºæ™¯åœ¨äºå¾ˆå¤šä¸åŒå±‚çº§çš„ç»„ä»¶éœ€è¦è®¿é—®åŒæ ·ä¸€äº›çš„æ•°æ®ã€‚è¯·è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºè¿™ä¼šä½¿å¾—ç»„ä»¶çš„å¤ç”¨æ€§å˜å·®ã€‚

```react
import React from "react"; 
// åˆ›å»ºä¸Šä¸‹æ–‡ 
const Context = React.createContext(); 
// è·å–Providerå’ŒConsumer 
const Provider = Context.Provider; 
const Consumer = Context.Consumer; 
// Childæ˜¾ç¤ºè®¡æ•°å™¨ï¼Œå¹¶èƒ½ä¿®æ”¹å®ƒï¼Œå¤šä¸ªChildä¹‹é—´éœ€è¦å…±äº«æ•°æ® 
function Child(props) { 
    return <div onClick={() => props.add()}>{props.counter}</div>; 
}
export default class ContextTest extends React.Component { 
    // stateæ˜¯è¦ä¼ é€’çš„æ•°æ® 
    state = { counter: 0 };
	// addæ–¹æ³•å¯ä»¥ä¿®æ”¹çŠ¶æ€ 
	add = () => { 
        this.setState(nextState => ({ counter: nextState.counter + 1 })); 
    };
	// counterçŠ¶æ€å˜æ›´ 
	render() { 
        return ( 
            <Provider value={{ counter: this.state.counter, add: this.add }}> 
                {/* Consumerä¸­å†…åµŒå‡½æ•°ï¼Œå…¶å‚æ•°æ˜¯ä¼ é€’çš„æ•°æ®ï¼Œè¿”å›è¦æ¸²æŸ“çš„ç»„ä»¶ */} 
                {/* æŠŠvalueå±•å¼€ä¼ é€’ç»™Child */} 
                <Consumer>{value => <Child {...value} />}</Consumer> 
                <Consumer>{value => <Child {...value} />}</Consumer> 
            </Provider>
        ); 
    } 
}
```



**å¦‚æœä½ åªæ˜¯æƒ³é¿å…å±‚å±‚ä¼ é€’ä¸€äº›å±æ€§ï¼Œç»„ä»¶ç»„åˆï¼ˆcomponent compositionï¼‰æœ‰æ—¶å€™æ˜¯ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆ**

#### redux

ç±»ä¼¼vuexï¼Œæ— æ˜æ˜¾å…³ç³»çš„ç»„ä»¶é—´é€šä¿¡

## ref

### DOM

```react
class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);
    // åˆ›å»ºä¸€ä¸ª ref æ¥å­˜å‚¨ textInput çš„ DOM å…ƒç´ 
    this.textInput = React.createRef();
    this.focusTextInput = this.focusTextInput.bind(this);
  }

  focusTextInput() {
    // ç›´æ¥ä½¿ç”¨åŸç”Ÿ API ä½¿ text è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
    // æ³¨æ„ï¼šæˆ‘ä»¬é€šè¿‡ "current" æ¥è®¿é—® DOM èŠ‚ç‚¹
    this.textInput.current.focus();
  }

  render() {
    // å‘Šè¯‰ React æˆ‘ä»¬æƒ³æŠŠ <input> ref å…³è”åˆ°æ„é€ å™¨é‡Œåˆ›å»ºçš„ `textInput` ä¸Š
    return (
      <div>
        <input
          type="text"
          ref={this.textInput} />
        <input
          type="button"
          value="Focus the text input"
          onClick={this.focusTextInput}
        />
      </div>
    );
  }
}
```

### Class

```react
class AutoFocusTextInput extends React.Component {
  constructor(props) {
    super(props);
    this.textInput = React.createRef();
  }

  componentDidMount() {
    this.textInput.current.focusTextInput();
  }

  render() {
    return (
      <CustomTextInput ref={this.textInput} />
    );
  }
}
```

é»˜è®¤æƒ…å†µä¸‹ï¼Œ**ä½ ä¸èƒ½åœ¨å‡½æ•°ç»„ä»¶ä¸Šä½¿ç”¨ `ref` å±æ€§**ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰å®ä¾‹

å¦‚æœè¦åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨ `ref`ï¼Œä½ å¯ä»¥ä½¿ç”¨ [`forwardRef`](https://react.docschina.org/docs/forwarding-refs.html)ï¼ˆå¯ä¸ [`useImperativeHandle`](https://react.docschina.org/docs/hooks-reference.html#useimperativehandle) ç»“åˆä½¿ç”¨ï¼‰ï¼Œæˆ–è€…å¯ä»¥å°†è¯¥ç»„ä»¶è½¬åŒ–ä¸º class ç»„ä»¶ã€‚

**Ref è½¬å‘æ˜¯ä¸€ä¸ªå¯é€‰ç‰¹æ€§ï¼Œå…¶å…è®¸æŸäº›ç»„ä»¶æ¥æ”¶ `ref`ï¼Œå¹¶å°†å…¶å‘ä¸‹ä¼ é€’ï¼ˆæ¢å¥è¯è¯´ï¼Œâ€œè½¬å‘â€å®ƒï¼‰ç»™å­ç»„ä»¶ã€‚**

```react
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));

// ä½ å¯ä»¥ç›´æ¥è·å– DOM button çš„ refï¼š
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```

### å›è°ƒref

```react
class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);

    this.textInput = null;

    this.setTextInputRef = element => {
      this.textInput = element;
    };

    this.focusTextInput = () => {
      // ä½¿ç”¨åŸç”Ÿ DOM API ä½¿ text è¾“å…¥æ¡†è·å¾—ç„¦ç‚¹
      if (this.textInput) this.textInput.focus();
    };
  }

  componentDidMount() {
    // ç»„ä»¶æŒ‚è½½åï¼Œè®©æ–‡æœ¬æ¡†è‡ªåŠ¨è·å¾—ç„¦ç‚¹
    this.focusTextInput();
  }

  render() {
    // ä½¿ç”¨ `ref` çš„å›è°ƒå‡½æ•°å°† text è¾“å…¥æ¡† DOM èŠ‚ç‚¹çš„å¼•ç”¨å­˜å‚¨åˆ° React
    // å®ä¾‹ä¸Šï¼ˆæ¯”å¦‚ this.textInputï¼‰
    return (
      <div>
        <input
          type="text"
          ref={this.setTextInputRef}
        />
        <input
          type="button"
          value="Focus the text input"
          onClick={this.focusTextInput}
        />
      </div>
    );
  }
}
```

## HOCé«˜é˜¶ç»„ä»¶

èŒƒä¾‹ï¼šä¸ºå±•ç¤ºç»„ä»¶æ·»åŠ è·å–æ•°æ®èƒ½åŠ›

è¯·æ³¨æ„ï¼ŒHOC ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„ç»„ä»¶ï¼Œä¹Ÿä¸ä¼šä½¿ç”¨ç»§æ‰¿æ¥å¤åˆ¶å…¶è¡Œä¸ºã€‚ç›¸åï¼ŒHOC é€šè¿‡å°†ç»„ä»¶*åŒ…è£…*åœ¨å®¹å™¨ç»„ä»¶ä¸­æ¥*ç»„æˆ*æ–°ç»„ä»¶ã€‚HOC æ˜¯çº¯å‡½æ•°ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚

ä¸è¦è¯•å›¾åœ¨ HOC ä¸­ä¿®æ”¹ç»„ä»¶åŸå‹ï¼ˆæˆ–ä»¥å…¶ä»–æ–¹å¼æ”¹å˜å®ƒï¼‰ã€‚

```react
// Hoc.js 
import React from "react"; 
// Lessonä¿è¯åŠŸèƒ½å•ä¸€ï¼Œå®ƒä¸å…³å¿ƒæ•°æ®æ¥æºï¼Œåªè´Ÿè´£æ˜¾ç¤º 
function Lesson(props) { 
    return ( <div> {props.stage} - {props.title} </div> ); 
}
// æ¨¡æ‹Ÿæ•°æ® 
const lessons = [ 
    { stage: "React", title: "æ ¸å¿ƒAPI" }, 
    { stage: "React", title: "ç»„ä»¶åŒ–1" }, 
    { stage: "React", title: "ç»„ä»¶åŒ–2" } 
];
// é«˜é˜¶ç»„ä»¶withContentè´Ÿè´£åŒ…è£…ä¼ å…¥ç»„ä»¶Comp 
// åŒ…è£…åç»„ä»¶èƒ½å¤Ÿæ ¹æ®ä¼ å…¥ç´¢å¼•è·å–è¯¾ç¨‹æ•°æ®ï¼ŒçœŸå®æ¡ˆä¾‹ä¸­å¯ä»¥é€šè¿‡apiæŸ¥è¯¢å¾—åˆ° 
const withContent = Comp => props => { 
    const content = lessons[props.idx]; 
    // {...props}å°†å±æ€§å±•å¼€ä¼ é€’ä¸‹å» 
    return <Comp {...content} />; 
};
// LessonWithContentæ˜¯åŒ…è£…åçš„ç»„ä»¶ 
const LessonWithContent = withContent(Lesson); 
export default function HocTest() { 
    // HocTestæ¸²æŸ“ä¸‰ä¸ªLessonWithContentç»„ä»¶ 
    return ( 
        <div> {[0,0,0].map((item, idx) => ( <LessonWithContent idx={idx} key={idx} /> ))} </div> 
    ); 
}
```

èŒƒä¾‹ï¼šæ”¹é€ å‰é¢æ¡ˆä¾‹ä½¿ä¸Šä¸‹æ–‡ä½¿ç”¨æ›´ä¼˜é›…

```react
// withConsumeræ˜¯é«˜é˜¶ç»„ä»¶å·¥å‚ï¼Œå®ƒèƒ½æ ¹æ®é…ç½®è¿”å›ä¸€ä¸ªé«˜é˜¶ç»„ä»¶ 
function withConsumer(Consumer) { 
    return Comp => props => { 
        return <Consumer>{value => <Comp {...value} {...props} />}</Consumer>; 
    }; 
}
// Childæ˜¾ç¤ºè®¡æ•°å™¨ï¼Œå¹¶èƒ½ä¿®æ”¹å®ƒï¼Œå¤šä¸ªChildä¹‹é—´éœ€è¦å…±äº«æ•°æ® 
// æ–°çš„Childæ˜¯é€šè¿‡withConsumer(Consumer)è¿”å›çš„é«˜é˜¶ç»„ä»¶åŒ…è£…æ‰€å¾— 
const Child = withConsumer(Consumer)(function (props) { 
    return <div onClick={() => props.add()} title={props.name}>{props.counter}</div>; 
}); 
export default class ContextTest extends React.Component { 
    render() { 
        return ( 
        <Provider value={{ counter: this.state.counter, add: this.add }}> 
            {/* æ”¹é€ è¿‡çš„Childå¯ä»¥è‡ªåŠ¨ä»Consumerè·å–å€¼ï¼Œç›´æ¥ç”¨å°±å¥½äº† */} 
            <Child name="foo"/> 
            <Child name="bar"/>
        </Provider> 
    	); 
    } 
}
```

### é“¾å¼è°ƒç”¨

```react
// é«˜é˜¶ç»„ä»¶withLogè´Ÿè´£åŒ…è£…ä¼ å…¥ç»„ä»¶Comp 
// åŒ…è£…åç»„ä»¶åœ¨æŒ‚è½½æ—¶å¯ä»¥è¾“å‡ºæ—¥å¿—è®°å½• 
const withLog = Comp => { 
    // è¿”å›ç»„ä»¶éœ€è¦ç”Ÿå‘½å‘¨æœŸï¼Œå› æ­¤å£°æ˜ä¸ºclassç»„ä»¶ 
    return class extends React.Component { 
        render() { 
            return <Comp {...this.props} />; 
        }
        componentDidMount() { 
            console.log("didMount", this.props); 
        } 
    }; 
};
// LessonWithContentæ˜¯åŒ…è£…åçš„ç»„ä»¶ 
const LessonWithContent = withLog(withContent(Lesson));
```

### è£…é¥°å™¨å†™æ³• 

CRAé¡¹ç›®ä¸­é»˜è®¤ä¸æ”¯æŒjsä»£ç ä½¿ç”¨è£…é¥°å™¨è¯­æ³•ï¼Œå¯ä¿®æ”¹åç¼€åä¸ºtsxåˆ™å¯ä»¥ç›´æ¥æ”¯æŒ 

```react
// è£…é¥°å™¨åªèƒ½ç”¨åœ¨classä¸Š 
// æ‰§è¡Œé¡ºåºä»ä¸‹å¾€ä¸Š 
@withLog 
@withContent 
class Lesson2 extends React.Component { 
    render() { 
        return ( <div> {this.props.stage} - {this.props.title} </div> ); 
    } 
}
export default function HocTest() { 
    // è¿™é‡Œä½¿ç”¨Lesson2 
    return ( 
        <div> {[0, 0, 0].map((item, idx) => ( 
                <Lesson2 idx={idx} key={idx} /> 
            ))} 
        </div> 
    ); 
}
```

æ³¨æ„ä¿®æ”¹App.jsä¸­å¼•å…¥éƒ¨åˆ†ï¼Œæ·»åŠ ä¸€ä¸ªåç¼€å 

è¦æ±‚craç‰ˆæœ¬é«˜äº2.1.0 

## Render Props

æˆ‘ä»¬å¯ä»¥æä¾›ä¸€ä¸ªå¸¦æœ‰å‡½æ•° prop çš„ `<Mouse>` ç»„ä»¶ï¼Œå®ƒèƒ½å¤ŸåŠ¨æ€å†³å®šä»€ä¹ˆéœ€è¦æ¸²æŸ“çš„ï¼Œè€Œä¸æ˜¯å°† `<Cat>` ç¡¬ç¼–ç åˆ° `<Mouse>` ç»„ä»¶é‡Œï¼Œå¹¶æœ‰æ•ˆåœ°æ”¹å˜å®ƒçš„æ¸²æŸ“ç»“æœã€‚

```react
class Cat extends React.Component {
  render() {
    const mouse = this.props.mouse;
    return (
      <img src="/cat.jpg" style={{ position: 'absolute', left: mouse.x, top: mouse.y }} />
    );
  }
}

class Mouse extends React.Component {
  constructor(props) {
    super(props);
    this.handleMouseMove = this.handleMouseMove.bind(this);
    this.state = { x: 0, y: 0 };
  }

  handleMouseMove(event) {
    this.setState({
      x: event.clientX,
      y: event.clientY
    });
  }

  render() {
    return (
      <div style={{ height: '100vh' }} onMouseMove={this.handleMouseMove}>

        {/*
          Instead of providing a static representation of what <Mouse> renders,
          use the `render` prop to dynamically determine what to render.
        */}
        {this.props.render(this.state)}
      </div>
    );
  }
}

class MouseTracker extends React.Component {
  render() {
    return (
      <div>
        <h1>ç§»åŠ¨é¼ æ ‡!</h1>
        <Mouse render={mouse => (
          <Cat mouse={mouse} />
        )}/>
      </div>
    );
  }
}
```

## ç»„åˆ

### åŒ…å«å…³ç³»

```react
function FancyBorder(props) {
  return (
    <div className={'FancyBorder FancyBorder-' + props.color}>
      {/* ä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„ children prop æ¥å°†ä»–ä»¬çš„å­ç»„ä»¶ä¼ é€’åˆ°æ¸²æŸ“ç»“æœ */}
      {props.children}
    </div>
  );
}

function WelcomeDialog() {
  return (
    <FancyBorder color="blue">
      <h1 className="Dialog-title">
        Welcome
      </h1>
      <p className="Dialog-message">
        Thank you for visiting our spacecraft!
      </p>
    </FancyBorder>
  );
}
```

`<FancyBorder>` JSX æ ‡ç­¾ä¸­çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šä½œä¸ºä¸€ä¸ª `children` prop ä¼ é€’ç»™ `FancyBorder` ç»„ä»¶ã€‚å› ä¸º `FancyBorder` å°† `{props.children}` æ¸²æŸ“åœ¨ä¸€ä¸ª `<div>` ä¸­ï¼Œè¢«ä¼ é€’çš„è¿™äº›å­ç»„ä»¶æœ€ç»ˆéƒ½ä¼šå‡ºç°åœ¨è¾“å‡ºç»“æœä¸­ã€‚

å°‘æ•°æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªç»„ä»¶ä¸­é¢„ç•™å‡ºå‡ ä¸ªâ€œæ´â€ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨ `children`ï¼Œè€Œæ˜¯è‡ªè¡Œçº¦å®šï¼šå°†æ‰€éœ€å†…å®¹ä¼ å…¥ propsï¼Œå¹¶ä½¿ç”¨ç›¸åº”çš„ propã€‚

```react
function SplitPane(props) {
  return (
    <div className="SplitPane">
      <div className="SplitPane-left">
        {props.left}
      </div>
      <div className="SplitPane-right">
        {props.right}
      </div>
    </div>
  );
}

function App() {
  return (
    <SplitPane
      left={
        <Contacts />
      }
      right={
        <Chat />
      } />
  );
}
```

ä¹Ÿå¯ä»¥ä¼ é€’å¯¹è±¡

```react
import React from "react"; 
// è·å–ç›¸åº”éƒ¨åˆ†å†…å®¹å±•ç¤ºåœ¨æŒ‡å®šä½ç½® 
function Dialog(props) { 
    return ( 
        <div style={{ border: "1px solid blue" }}> 
            {props.children.default} 
            <div>{props.children.footer}</div> 
        </div> 
    ); 
}
export default function Composition() { 
    return ( 
        <div> {/* ä¼ å…¥æ˜¾ç¤ºå†…å®¹ */} 
            <Dialog> {{
                    default: ( 
                        <>
                            <h1>ç»„ä»¶å¤åˆ</h1> 
                            <p>å¤åˆç»„ä»¶ç»™ä¸ä½ è¶³å¤Ÿçš„æ•æ·å»å®šä¹‰è‡ªå®šä¹‰ç»„ä»¶çš„å¤–è§‚å’Œè¡Œä¸º</p> 
                        </> 
                    ),
                    footer: <button onClick={() => alert("reactç¡®å®å¥½")}>ç¡®å®š</button> 
                }} 
            </Dialog> 
        </div> 
    ); 
}
```

å¦‚æœä¼ å…¥çš„æ˜¯å‡½æ•°ï¼Œè¿˜å¯ä»¥å®ç°ä½œç”¨åŸŸæ’æ§½çš„åŠŸèƒ½

```react
function Dialog(props) {
    // å¤‡é€‰æ¶ˆæ¯ 
    const messages = { 
        "foo": {title: 'foo', content: 'foo~'}, 
        "bar": {title: 'bar', content: 'bar~'}, 
    }
    // æ‰§è¡Œå‡½æ•°è·å¾—è¦æ˜¾ç¤ºçš„å†…å®¹ 
    const {body, footer} = props.children(messages[props.msg]); 
    return ( 
        <div style={{ border: "1px solid blue" }}> 
            {/* æ­¤å¤„æ˜¾ç¤ºçš„å†…å®¹æ˜¯åŠ¨æ€ç”Ÿæˆçš„ */} 
            {body} 
            <div>{footer}</div> 
        </div> 
    ); 
}
export default function Composition() { 
    return ( 
        <div> 
            {/* æ‰§è¡Œæ˜¾ç¤ºæ¶ˆæ¯çš„key */} 
            <Dialog msg="foo"> 
                {/* ä¿®æ”¹ä¸ºå‡½æ•°å½¢å¼ï¼Œæ ¹æ®ä¼ å…¥å€¼ç”Ÿæˆæœ€ç»ˆå†…å®¹ */} 
                {({title, content}) => ({ 
                    body: ( 
                    <>
                        <h1>{title}</h1>
                        <p>{content}</p>
                    </> 
                	),
                    footer: 
                    <button onClick={() => alert("reactç¡®å®å¥½")}>ç¡®å®š</button>
                })} 
            </Dialog> 
        </div> 
    ); 
}
```

å¦‚æœprops.childrenæ˜¯jsxï¼Œæ­¤æ—¶å®ƒæ˜¯**ä¸èƒ½ä¿®æ”¹**çš„ 

èŒƒä¾‹ï¼šå®ç°RadioGroupå’ŒRadioç»„ä»¶ï¼Œå¯é€šè¿‡RadioGroupè®¾ç½®Radioçš„name 

```react
function RadioGroup(props) { 
    // ä¸å¯è¡Œ, 
    // React.Children.forEach(props.children, child => { 
    // child.props.name = props.name; 
    // }); 
    return ( 
        <div> {React.Children.map(props.children, child => { 
                // è¦ä¿®æ”¹è™šæ‹Ÿdom åªèƒ½å…‹éš†å®ƒ
                // å‚æ•°1æ˜¯å…‹éš†å¯¹è±¡
                // å‚æ•°2æ˜¯è®¾ç½®çš„å±æ€§
                return React.cloneElement(child, { name: props.name });
                })} 
        </div> 
    ); 
}
// Radioä¼ å…¥value,nameå’Œchildrenï¼Œæ³¨æ„åŒºåˆ† 
function Radio({ children, ...rest }) { 
    return ( <label> <input type="radio" {...rest} /> {children} </label> ); 
}
export default function Composition() { 
    return ( 
        <div> 
            {/* æ‰§è¡Œæ˜¾ç¤ºæ¶ˆæ¯çš„key */} 
            <RadioGroup name="mvvm"> 
                <Radio value="vue">vue</Radio> 
                <Radio value="react">react</Radio> 
                <Radio value="ng">angular</Radio> 
            </RadioGroup> 
        </div> 
    ); 
}
```

#### React.Children

`React.Children` æä¾›äº†ç”¨äºå¤„ç† `this.props.children` ä¸é€æ˜æ•°æ®ç»“æ„çš„å®ç”¨æ–¹æ³•ã€‚

**React.Children.map**

```
React.Children.map(children, function[(thisArg)])
```

åœ¨ `children` é‡Œçš„æ¯ä¸ªç›´æ¥å­èŠ‚ç‚¹ä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°† `this` è®¾ç½®ä¸º `thisArg`ã€‚å¦‚æœ `children` æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒå°†è¢«éå†å¹¶ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå­èŠ‚ç‚¹è°ƒç”¨è¯¥å‡½æ•°ã€‚å¦‚æœå­èŠ‚ç‚¹ä¸º `null` æˆ–æ˜¯ `undefined`ï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å› `null` æˆ–æ˜¯ `undefined`ï¼Œè€Œä¸ä¼šè¿”å›æ•°ç»„ã€‚

### ç‰¹ä¾‹å…³ç³»

æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæŠŠä¸€äº›ç»„ä»¶çœ‹ä½œæ˜¯å…¶ä»–ç»„ä»¶çš„ç‰¹æ®Šå®ä¾‹ï¼Œæ¯”å¦‚ `WelcomeDialog` å¯ä»¥è¯´æ˜¯ `Dialog` çš„ç‰¹æ®Šå®ä¾‹ã€‚

åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ç»„åˆæ¥å®ç°è¿™ä¸€ç‚¹ã€‚â€œç‰¹æ®Šâ€ç»„ä»¶å¯ä»¥é€šè¿‡ props å®šåˆ¶å¹¶æ¸²æŸ“â€œä¸€èˆ¬â€ç»„ä»¶ï¼Œå³å¯¹ä¸€èˆ¬ç»„ä»¶è¿›è¡ŒåŒ…è£…

## ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ

æ¦‚å¿µï¼šåœ¨ç»„ä»¶åˆ›å»ºã€åˆ°åŠ è½½åˆ°é¡µé¢ä¸Šè¿è¡Œã€ä»¥åŠç»„ä»¶è¢«é”€æ¯çš„è¿‡ç¨‹ä¸­ï¼Œæ€»æ˜¯ä¼´éšç€å„ç§å„æ ·çš„äº‹ä»¶ï¼Œè¿™äº›åœ¨ç»„ä»¶ç‰¹å®šæ—¶æœŸï¼Œè§¦å‘çš„äº‹ä»¶ï¼Œç»Ÿç§°ä¸ºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼›

### 16.0ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸ

![react16ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸ](E:\Jennifer\other\notes\media\react16ä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸ.png)

**ç¬¬ä¸€ä¸ªæ˜¯ç»„ä»¶åˆå§‹åŒ–(initialization)é˜¶æ®µ** 

ä¹Ÿå°±æ˜¯ä»¥ä¸‹ä»£ç ä¸­ç±»çš„æ„é€ æ–¹æ³•( constructor() ),Testç±»ç»§æ‰¿äº†react Componentè¿™ä¸ªåŸºç±»ï¼Œä¹Ÿå°±ç»§æ‰¿è¿™ä¸ªreactçš„ åŸºç±»ï¼Œæ‰èƒ½æœ‰render(),ç”Ÿå‘½å‘¨æœŸç­‰æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œè¿™ä¹Ÿè¯´æ˜ä¸ºä»€ä¹ˆ å‡½æ•°ç»„ä»¶ä¸èƒ½ä½¿ç”¨è¿™äº›æ–¹æ³• çš„åŸå› ã€‚ 

super(props) ç”¨æ¥è°ƒç”¨åŸºç±»çš„æ„é€ æ–¹æ³•( constructor() ), ä¹Ÿå°†çˆ¶ç»„ä»¶çš„propsæ³¨å…¥ç»™å­ç»„ä»¶ã€‚ è€Œ constructor() ç”¨æ¥åšä¸€äº›ç»„ä»¶çš„åˆå§‹åŒ–å·¥ä½œï¼Œå¦‚å®šä¹‰this.stateçš„åˆå§‹å†… å®¹ã€‚

```react
import React, { Component } from 'react'; 
class Test extends Component { 
    constructor(props) { super(props); } 
}
```

**ç¬¬äºŒä¸ªæ˜¯ç»„ä»¶çš„æŒ‚è½½(Mounting)é˜¶æ®µ**

æ­¤é˜¶æ®µåˆ†ä¸ºcomponentWillMountï¼Œrenderï¼ŒcomponentDidMountä¸‰ä¸ªæ—¶æœŸã€‚

- componentWillMount: 

åœ¨ç»„ä»¶æŒ‚è½½åˆ°DOMå‰è°ƒç”¨ï¼Œä¸”åªä¼šè¢«**è°ƒç”¨ä¸€æ¬¡**ï¼Œåœ¨è¿™è¾¹è°ƒç”¨this.setStateä¸ä¼šå¼•èµ·ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥æŠŠå†™åœ¨è¿™è¾¹çš„å†…å®¹æå‰åˆ°constructor()ä¸­ï¼Œæ‰€ä»¥é¡¹ç›®ä¸­å¾ˆå°‘ç”¨ã€‚ 

- render: 

æ ¹æ®ç»„ä»¶çš„propså’Œstateï¼ˆä¸¤è€…çš„**é‡ä¼ é€’å’Œé‡èµ‹å€¼**ï¼Œæ— è®ºå€¼æ˜¯å¦æœ‰å˜åŒ–ï¼Œéƒ½å¯ä»¥å¼•èµ·ç»„ä»¶é‡æ–°renderï¼‰ ï¼Œreturn ä¸€ä¸ªReactå…ƒç´ ï¼Œä¸è´Ÿè´£ç»„ä»¶å®é™…æ¸²æŸ“å·¥ä½œï¼Œä¹‹åç”±Reactè‡ªèº«æ ¹æ®æ­¤å…ƒç´ å»æ¸²æŸ“å‡ºé¡µé¢ DOMã€‚renderæ˜¯çº¯å‡½æ•°ï¼ˆPure functionï¼šå‡½æ•°çš„è¿”å›ç»“æœåªä¾èµ–äºå®ƒçš„å‚æ•°ï¼›å‡½æ•°æ‰§è¡Œè¿‡ç¨‹é‡Œé¢æ²¡æœ‰å‰¯ä½œç”¨ï¼‰ï¼Œ ä¸èƒ½åœ¨é‡Œé¢æ‰§è¡Œthis.setStateï¼Œä¼šæœ‰æ”¹å˜ç»„ä»¶çŠ¶æ€çš„å‰¯ä½œç”¨ã€‚ 

- componentDidMount:

ç»„ä»¶æŒ‚è½½åˆ°DOMåè°ƒç”¨ï¼Œä¸”åªä¼šè¢«**è°ƒç”¨ä¸€æ¬¡**

**ç¬¬ä¸‰ä¸ªæ˜¯ç»„ä»¶çš„æ›´æ–°(update)é˜¶æ®µ**

æ³¨æ„ï¼šsetStateå¼•èµ·çš„stateæ›´æ–°æˆ–çˆ¶ç»„ä»¶é‡æ–°renderå¼•èµ·çš„propsæ›´ æ–°ï¼Œæ›´æ–°åçš„stateå’Œpropsç›¸å¯¹ä¹‹å‰æ— è®ºæ˜¯å¦æœ‰å˜åŒ–ï¼Œéƒ½å°†å¼•èµ·å­ç»„ä»¶çš„é‡æ–°renderã€‚

**é€ æˆç»„ä»¶æ›´æ–°æœ‰ä¸¤ç±»ï¼ˆä¸‰ç§ï¼‰æƒ…å†µï¼š**

1. çˆ¶ç»„ä»¶é‡æ–°render

çˆ¶ç»„ä»¶é‡æ–°renderå¼•èµ·å­ç»„ä»¶é‡æ–°renderçš„æƒ…å†µæœ‰ä¸¤ç§

a. æ¯å½“çˆ¶ç»„ä»¶é‡æ–°renderå¯¼è‡´çš„é‡ä¼ propsï¼Œå­ç»„ä»¶å°†ç›´æ¥è·Ÿç€é‡æ–°æ¸²æŸ“ï¼Œæ— è®ºpropsæ˜¯å¦æœ‰å˜åŒ–ã€‚å¯é€š è¿‡shouldComponentUpdateæ–¹æ³•ä¼˜åŒ–ã€‚ 

b.åœ¨componentWillReceivePropsæ–¹æ³•ä¸­ï¼Œå°†propsè½¬æ¢æˆè‡ªå·±çš„state

```react
class Child extends Component { 
    constructor(props) { 
        super(props); 
        this.state = { someThings: props.someThings }; 
    }
    componentWillReceiveProps(nextProps) { // çˆ¶ç»„ä»¶é‡ä¼ propsæ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• 
        this.setState({someThings: nextProps.someThings}); 
    }
    render() { 
        return <div>{this.state.someThings}</div> 
    } 
}
```

æ ¹æ®å®˜ç½‘çš„æè¿° 

> åœ¨è¯¥å‡½æ•°(componentWillReceiveProps)ä¸­è°ƒç”¨ this.setState() å°†ä¸ä¼šå¼•èµ·ç¬¬äºŒæ¬¡æ¸²æŸ“ã€‚ 

æ˜¯å› ä¸ºcomponentWillReceivePropsä¸­åˆ¤æ–­propsæ˜¯å¦å˜åŒ–äº†ï¼Œè‹¥å˜åŒ–äº†ï¼Œthis.setStateå°†å¼•èµ·stateå˜åŒ–ï¼Œä»è€Œå¼• èµ·renderï¼Œæ­¤æ—¶å°±æ²¡å¿…è¦å†åšç¬¬äºŒæ¬¡å› é‡ä¼ propså¼•èµ·çš„renderäº†ï¼Œä¸ç„¶é‡å¤åšä¸€æ ·çš„æ¸²æŸ“äº†ã€‚ 

2. ç»„ä»¶æœ¬èº«è°ƒç”¨setStateï¼Œæ— è®ºstateæœ‰æ²¡æœ‰å˜åŒ–ã€‚å¯é€šè¿‡shouldComponentUpdateæ–¹æ³•ä¼˜åŒ–ã€‚

**æ­¤é˜¶æ®µåˆ†ä¸ºcomponentWillReceivePropsï¼ŒshouldComponentUpdateï¼Œ componentWillUpdateï¼Œrenderï¼ŒcomponentDidUpdate**

- componentWillReceiveProps(nextProps) 

æ­¤æ–¹æ³•åªè°ƒç”¨äº**propså¼•èµ·çš„ç»„ä»¶æ›´æ–°**è¿‡ç¨‹ä¸­ï¼Œå‚æ•°nextPropsæ˜¯çˆ¶ç»„ä»¶ä¼ ç»™å½“å‰ç»„ä»¶çš„æ–°propsã€‚ä½†çˆ¶ç»„ä»¶render æ–¹æ³•çš„è°ƒç”¨ä¸èƒ½ä¿è¯é‡ä¼ ç»™å½“å‰ç»„ä»¶çš„propsæ˜¯æœ‰å˜åŒ–çš„ï¼Œæ‰€ä»¥åœ¨æ­¤æ–¹æ³•ä¸­æ ¹æ®nextPropså’Œthis.propsæ¥æŸ¥æ˜é‡ä¼  çš„propsæ˜¯å¦æ”¹å˜ï¼Œä»¥åŠå¦‚æœæ”¹å˜äº†è¦æ‰§è¡Œå•¥ï¼Œæ¯”å¦‚æ ¹æ®æ–°çš„propsè°ƒç”¨this.setStateè§¦å‘å½“å‰ç»„ä»¶çš„é‡æ–°render 

- shouldComponentUpdate(nextProps, nextState) 

æ­¤æ–¹æ³•é€šè¿‡æ¯”è¾ƒnextPropsï¼ŒnextStateåŠå½“å‰ç»„ä»¶çš„this.propsï¼Œthis.stateï¼Œè¿”å›trueæ—¶å½“å‰ç»„ä»¶å°†ç»§ç»­æ‰§è¡Œæ›´æ–° è¿‡ç¨‹ï¼Œè¿”å›falseåˆ™å½“å‰ç»„ä»¶æ›´æ–°åœæ­¢ï¼Œä»¥æ­¤å¯ç”¨æ¥å‡å°‘ç»„ä»¶çš„ä¸å¿…è¦æ¸²æŸ“ï¼Œä¼˜åŒ–ç»„ä»¶æ€§èƒ½ã€‚ 

psï¼šè¿™è¾¹ä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œå°±ç®—componentWillReceiveProps()ä¸­æ‰§è¡Œäº†this.setStateï¼Œæ›´æ–°äº†stateï¼Œä½†åœ¨renderå‰ ï¼ˆå¦‚shouldComponentUpdateï¼ŒcomponentWillUpdateï¼‰ï¼Œthis.stateä¾ç„¶æŒ‡å‘æ›´æ–°å‰çš„stateï¼Œä¸ç„¶nextState åŠå½“å‰ç»„ä»¶çš„this.stateçš„å¯¹æ¯”å°±ä¸€ç›´æ˜¯trueäº†ã€‚ 

- componentWillUpdate(nextProps, nextState) 

æ­¤æ–¹æ³•åœ¨è°ƒç”¨renderæ–¹æ³•å‰æ‰§è¡Œï¼Œåœ¨è¿™è¾¹å¯æ‰§è¡Œä¸€äº›ç»„ä»¶æ›´æ–°å‘ç”Ÿå‰çš„å·¥ä½œï¼Œä¸€èˆ¬è¾ƒå°‘ç”¨ã€‚ 

- render 

- componentDidUpdate(prevProps, prevState)

æ­¤æ–¹æ³•åœ¨ç»„ä»¶æ›´æ–°åè¢«è°ƒç”¨ï¼Œå¯ä»¥**æ“ä½œç»„ä»¶æ›´æ–°çš„DOM**ï¼ŒprevPropså’ŒprevStateè¿™ä¸¤ä¸ªå‚æ•°æŒ‡çš„æ˜¯ç»„ä»¶æ›´æ–°å‰çš„ propså’Œstate 

**å¸è½½é˜¶æ®µ**

- componentWillUnmount 

æ­¤æ–¹æ³•åœ¨ç»„ä»¶è¢«å¸è½½å‰è°ƒç”¨ï¼Œå¯ä»¥åœ¨è¿™é‡Œæ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œæ¯”å¦‚æ¸…æ¥šç»„ä»¶ä¸­ä½¿ç”¨çš„å®šæ—¶å™¨ï¼Œæ¸…é™¤componentDidMountä¸­æ‰‹åŠ¨åˆ›å»ºçš„DOMå…ƒç´ ç­‰ï¼Œä»¥é¿å…å¼•èµ·å†…å­˜æ³„æ¼ã€‚

**æ€»ç»“**

ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œé¡ºåºï¼š

- Mountingï¼š
  - constructor()
  - componentWillMount()
  - render()
  - componentDidMount()
- Updatingï¼š
  - componentWillReceiveProps(nextProps)
  - shouldComponentUpdate(nextProps, nextState)
  - componentWillUpdate(nextProps, nextState)
  - render()
  - componentDidUpdate(prevProps, prevState)
- Unmountingï¼š
  - componentWillUnmount()

**React v16.4** **çš„ç”Ÿå‘½å‘¨æœŸ**

![react16.4ç”Ÿå‘½å‘¨æœŸ](E:\Jennifer\other\notes\media\react16.4ç”Ÿå‘½å‘¨æœŸ.png)

### 16.4çš„ç”Ÿå‘½å‘¨æœŸ

åŸæ¥ï¼ˆReact v16.0å‰ï¼‰çš„ç”Ÿå‘½å‘¨æœŸåœ¨React v16æ¨å‡ºçš„Fiberä¹‹åå°±ä¸åˆé€‚äº†ï¼Œå› ä¸ºå¦‚æœè¦å¼€å¯async renderingï¼Œ åœ¨renderå‡½æ•°ä¹‹å‰çš„æ‰€æœ‰å‡½æ•°ï¼Œéƒ½æœ‰å¯èƒ½è¢«æ‰§è¡Œå¤šæ¬¡ã€‚

å¦‚æœå¼€å‘è€…**å¼€äº†async renderingï¼Œè€Œä¸”åˆåœ¨ä»¥ä¸Šè¿™äº›renderå‰æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•åšAJAXè¯·æ±‚çš„è¯ï¼Œé‚£AJAXå°†è¢« æ— è°“åœ°å¤šæ¬¡è°ƒç”¨**ã€‚ã€‚ã€‚æ˜æ˜¾ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ç»“æœã€‚è€Œä¸”åœ¨componentWillMounté‡Œå‘èµ·AJAXï¼Œä¸ç®¡å¤šå¿«å¾—åˆ°ç»“æœ ä¹Ÿèµ¶ä¸ä¸Šé¦–æ¬¡renderï¼Œè€Œä¸”componentWillMountåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ä¹Ÿä¼šè¢«è°ƒç”¨åˆ°ï¼ˆå½“ç„¶ï¼Œä¹Ÿè®¸è¿™æ˜¯é¢„æœŸçš„ç»“ æœï¼‰ï¼Œè¿™æ ·çš„IOæ“ä½œæ”¾åœ¨componentDidMounté‡Œæ›´åˆé€‚ã€‚ 

ç¦æ­¢ä¸èƒ½ç”¨æ¯”åŠå¯¼å¼€å‘è€…ä¸è¦è¿™æ ·ç”¨çš„æ•ˆæœæ›´å¥½ï¼Œæ‰€ä»¥**é™¤äº†shouldComponentUpdateï¼Œå…¶ä»–åœ¨renderå‡½æ•°ä¹‹å‰çš„ æ‰€æœ‰å‡½æ•°ï¼ˆcomponentWillMountï¼ŒcomponentWillReceivePropsï¼ŒcomponentWillUpdateï¼‰éƒ½è¢« getDerivedStateFromPropsæ›¿ä»£ã€‚** 

ä¹Ÿå°±æ˜¯ç”¨ä¸€ä¸ªé™æ€å‡½æ•°getDerivedStateFromPropsæ¥å–ä»£è¢«deprecateçš„å‡ ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œ**å°±æ˜¯å¼ºåˆ¶å¼€å‘è€…åœ¨ renderä¹‹å‰åªåšæ— å‰¯ä½œç”¨çš„æ“ä½œï¼Œè€Œä¸”èƒ½åšçš„æ“ä½œå±€é™åœ¨æ ¹æ®propså’Œstateå†³å®šæ–°çš„state** 

React v16.0åˆšæ¨å‡ºçš„æ—¶å€™ï¼Œæ˜¯å¢åŠ äº†ä¸€ä¸ªcomponentDidCatchç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œè¿™åªæ˜¯ä¸€ä¸ªå¢é‡å¼ä¿®æ”¹ï¼Œå®Œå…¨ä¸å½± å“åŸæœ‰ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼›ä½†æ˜¯ï¼Œåˆ°äº†React v16.3ï¼Œå¤§æ”¹åŠ¨æ¥äº†ï¼Œå¼•å…¥äº†ä¸¤ä¸ªæ–°çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚ 

**getDerivedStateFromProps** 

**static getDerivedStateFromProps(props, state)** åœ¨ç»„ä»¶åˆ›å»ºæ—¶å’Œæ›´æ–°æ—¶çš„renderæ–¹æ³•ä¹‹å‰è°ƒç”¨ï¼Œå®ƒåº”è¯¥è¿”å› ä¸€ä¸ªå¯¹è±¡æ¥æ›´æ–°çŠ¶æ€ï¼Œæˆ–è€…è¿”å›nullæ¥ä¸æ›´æ–°ä»»ä½•å†…å®¹ã€‚ 

getDerivedStateFromProps æœ¬æ¥ï¼ˆReact v16.3ä¸­ï¼‰æ˜¯åªåœ¨åˆ›å»ºå’Œæ›´æ–°ï¼ˆç”±çˆ¶ç»„ä»¶å¼•å‘éƒ¨åˆ†ï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯ç”±çˆ¶ ç»„ä»¶å¼•å‘ï¼Œé‚£ä¹ˆgetDerivedStateFromPropsä¹Ÿä¸ä¼šè¢«è°ƒç”¨ï¼Œå¦‚è‡ªèº«setStateå¼•å‘æˆ–è€…forceUpdateå¼•å‘ã€‚ åœ¨React v16.4ä¸­æ”¹æ­£äº†è¿™ä¸€ç‚¹ï¼Œè®©getDerivedStateFromPropsæ— è®ºæ˜¯Mountingè¿˜æ˜¯ Updatingï¼Œä¹Ÿæ— è®ºæ˜¯å› ä¸ºä»€ä¹ˆå¼•èµ·çš„Updatingï¼Œå…¨éƒ¨éƒ½ä¼šè¢«è°ƒç”¨ï¼Œå…·ä½“å¯çœ‹React v16.4 çš„ç”Ÿå‘½å‘¨æœŸå›¾ã€‚ 

**getSnapshotBeforeUpdate** 

**getSnapshotBeforeUpdate()** è¢«è°ƒç”¨äºrenderä¹‹åï¼Œ**å¯ä»¥è¯»å–ä½†æ— æ³•ä½¿ç”¨DOM**çš„æ—¶å€™ã€‚å®ƒä½¿æ‚¨çš„ç»„ä»¶å¯ä»¥åœ¨å¯ èƒ½æ›´æ”¹ä¹‹å‰ä»DOMæ•è·ä¸€äº›ä¿¡æ¯ï¼ˆä¾‹å¦‚æ»šåŠ¨ä½ç½®ï¼‰ã€‚æ­¤ç”Ÿå‘½å‘¨æœŸè¿”å›çš„ä»»ä½•å€¼éƒ½å°†ä½œä¸ºå‚æ•°ä¼ é€’ç»™ componentDidUpdateï¼ˆï¼‰ã€‚ 

[React Native ä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ](http://www.race604.com/react-native-component-lifecycle/)


![Reactä¸­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ](E:/Jennifer/other/notes/react/images/LifeCycle.png)

### Counterè®¡æ•°å™¨çš„å°æ¡ˆä¾‹

å°è£…ç»„ä»¶

1. ç»™ç»„ä»¶è®¾ç½®é»˜è®¤å¯åŠ¨å±æ€§ï¼š`static defaultProps = {}`

2. ç»™å±æ€§è¿›è¡Œç±»å‹æ ¡éªŒï¼Œéœ€è¦å…ˆè¿è¡Œ`cnpm i prop-types --save`ï¼Œv.15ä¹‹åå•ç‹¬æŠ½ç¦»äº†è¿™ä¸ªåŒ…

   ```jsx
   import React from 'react'
   import PropTypes from 'prop-types'
   class Counter{
       constructor(props) extends React.Componet{
           super(props)
           this.state = {}
       }
   	static defaultProps = {initCount: 0}
   	// åˆ›å»ºä¸€ä¸ªpropTypeså¯¹è±¡ï¼Œå¯ä»¥ç»™å¤–ç•Œä¼ é€’çš„å±æ€§è¿›è¡Œç±»å‹æ ¡éªŒ
   	static propTypes = {initCount: PropTypes.number}
   	render() {
       	return <div>
           </div>
   	}
   }
   ```

### ç»„ä»¶åˆå§‹åŒ–æ—¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶æ€»ç»“

1. componentWillMountï¼šå¯ä»¥è·å–propsï¼Œstateå’Œå·²ç»å®šä¹‰çš„å‡½æ•°ï¼Œç›¸å½“äºVueçš„createdå‡½æ•°

2. renderï¼šåˆ›å»ºè™šæ‹ŸDOM

3. componentDidMountï¼šå¯ä»¥è·å–é¡µé¢çš„DOMå…ƒç´ ï¼Œæƒ³è¦æ“ä½œDOMæœ€æ—©åœ¨è¿™ä¸ªå‡½æ•°

4. shouldComponentUpdateï¼šå¿…é¡»è¿”å›å¸ƒå°”ï¼Œè¿”å›falseæ—¶è™šæ‹ŸDOMå’Œé¡µé¢éƒ½ä¸ä¼šæ›´æ–°ï¼Œå¯èƒ½ä¼šé€ æˆç”»é¢å’Œç»„ä»¶çŠ¶æ€çš„ä¸ä¸€è‡´

   ç›´æ¥é€šè¿‡`this.state`è·å–çš„stateå€¼æ˜¯ä¸Šä¸€æ¬¡çš„å€¼ï¼Œè¦è·å–æœ€æ–°çš„å€¼ï¼Œè¦é€šè¿‡å‚æ•°åˆ—è¡¨çš„`nextPropsæˆ–nextState`è·å–

5. componentWillUpdateï¼šè™šæ‹ŸDOMå’Œé¡µé¢ä¸Šçš„DOMéƒ½æ˜¯æ—§çš„

6. renderï¼šåˆ›å»ºé˜¶æ®µå’Œè¿è¡Œé˜¶æ®µéƒ½æœ‰ï¼ŒDOMè¿˜æ²¡æ¸²æŸ“ä¹‹å‰å¯ä»¥åˆ©ç”¨çŸ­è·¯è¿ç®—é˜²æ­¢æŠ¥é”™

7. æ³¨æ„ï¼šåœ¨renderå‡½æ•°ä¸­ï¼Œä¸èƒ½è°ƒç”¨`setState()`æ–¹æ³•

8. componentDidUpdateï¼šDOMéƒ½æ˜¯æœ€æ–°çš„

9. componentWillReceivePropï¼šç¬¬ä¸€æ¬¡æ¸²æŸ“ä¸ä¼šè§¦å‘ï¼Œ`this.props`è·å–åˆ°çš„æ˜¯ä¸Šä¸€æ¬¡çš„å€¼ï¼Œè¦è·å–æœ€æ–°çš„å€¼ï¼Œè¦é€šè¿‡å‚æ•°åˆ—è¡¨çš„`nextPropsæˆ–nextState`è·å–

## ç»‘å®šthiså¹¶ä¼ å‚çš„ä¸‰ç§æ–¹å¼

1. åœ¨äº‹ä»¶ä¸­ç»‘å®šthiså¹¶ä¼ å‚ï¼š

```jsx
// bindå¯ä»¥æ”¹å˜å‰é¢å‡½æ•°çš„thisæŒ‡å‘ï¼Œå’Œcall/applyä¸åŒï¼Œcall/applyæ”¹å˜thisåä¼šæ‰§è¡Œå‰é¢çš„å‡½æ•°
// bindçš„ç¬¬ä¸€ä¸ªå‚æ•°æ”¹å˜äº†thisæŒ‡å‘ï¼Œåé¢å°±æ˜¯è¦ä¼ é€’çš„å‚æ•°
<input type="button" value="åœ¨äº‹ä»¶ä¸­ç»‘å®šthiså¹¶ä¼ å‚" onClick={this.handleMsg1.bind(this, 'ğŸ•', 'ğŸŸ')} />

// åœ¨äº‹ä»¶ä¸­ç»‘å®šthiså¹¶ä¼ å‚
handleMsg1(arg1, arg2) {
    console.log(this);
    // æ­¤æ—¶thisæ˜¯ä¸ªnull
    this.setState({
        msg: 'åœ¨äº‹ä»¶ä¸­ç»‘å®šthiså¹¶ä¼ å‚ï¼š' + arg1 + arg2
    });
}
```

1. åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šthiså¹¶ä¼ å‚:

```jsx
// ä¿®æ”¹æ„é€ å‡½æ•°ä¸­çš„ä»£ç ï¼š
// bindçš„è¿”å›å€¼æ˜¯æ”¹å˜thisä¹‹åçš„å‡½æ•°çš„å¼•ç”¨
// bindä¸ä¼šæ”¹å˜åŸå‡½æ•°çš„thisæŒ‡å‘ï¼Œè¦ä½¿ç”¨æ”¹å˜ä¹‹åçš„å‡½æ•°è¦é‡æ–°æ¥æ”¶
this.handleMsg2 = this.handleMsg2.bind(this, 'ğŸš—', 'ğŸšš');

<input type="button" value="åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šthiså¹¶ä¼ å‚" onClick={this.handleMsg2} />

// åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šthiså¹¶ä¼ å‚
handleMsg2(arg1, arg2) {
    this.setState({
        msg: 'åœ¨æ„é€ å‡½æ•°ä¸­ç»‘å®šthiså¹¶ä¼ å‚ï¼š' + arg1 + arg2
    });
}
```

1. ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthiså¹¶ä¼ å‚ï¼š

```jsx
// ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthiså¹¶ä¼ å‚
<input type="button" value="ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthiså¹¶ä¼ å‚" onClick={() => { this.handleMsg3('ğŸ‘©', 'ğŸ‘°') }} />

handleMsg3(arg1, arg2) {
    this.setState({
        msg: 'ç”¨ç®­å¤´å‡½æ•°ç»‘å®šthiså¹¶ä¼ å‚ï¼š' + arg1 + arg2
    });
}
```

## Hooks

*Hook* æ˜¯ React 16.8 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒå¯ä»¥è®©ä½ åœ¨ä¸ç¼–å†™ class çš„æƒ…å†µä¸‹ä½¿ç”¨ state ä»¥åŠå…¶ä»–çš„ React ç‰¹æ€§

### çŠ¶æ€é’©å­ State Hook

```react
import React, { useState } from "react";
export default function HooksTest() { 
    // useState(initialState)ï¼Œæ¥æ”¶åˆå§‹çŠ¶æ€ï¼Œè¿”å›ä¸€ä¸ªç”±çŠ¶æ€å’Œå…¶æ›´æ–°å‡½æ•°ç»„æˆçš„æ•°ç»„
    const [fruits, setFruits] = useState(["é¦™è•‰", "è¥¿ç“œ"]); 
    return ( 
        <div>
            <p>{fruit === "" ? "è¯·é€‰æ‹©å–œçˆ±çš„æ°´æœï¼š" : `æ‚¨çš„é€‰æ‹©æ˜¯ï¼š${fruit}`}</p> 
            {/*æ·»åŠ åˆ—è¡¨ç»„ä»¶*/} 
            <FruitList fruits={fruits} onSetFruit={setFruit}/> 
            {/*æ·»åŠ æ°´æœç»„ä»¶*/} 
            <FruitAdd onAddFruit={pname => setFruits([...fruits, pname])} /> 
        </div> 
    ); 
}

// å£°æ˜åˆ—è¡¨ç»„ä»¶ 
function FruitList({fruits, onSetFruit}) { 
    return ( 
        <ul>{fruits.map(f => ( 
                <li key={f} onClick={() => onSetFruit(f)}> {f} </li>
            ))} 
        </ul> ); 
}

// å£°æ˜è¾“å…¥ç»„ä»¶ 
function FruitAdd(props) { 
    // è¾“å…¥å†…å®¹çŠ¶æ€åŠè®¾ç½®å†…å®¹çŠ¶æ€çš„æ–¹æ³• 
    const [pname, setPname] = useState(""); 
    // é”®ç›˜äº‹ä»¶å¤„ç† 
    const onAddFruit = e => { 
        if (e.key === "Enter") { 
        	props.onAddFruit(pname); setPname(""); 
        }
    };
    return ( 
        <div> 
            <input type="text" value={pname} onChange={e => setPname(e.target.value)} onKeyDown={onAddFruit} /> 
        </div> ); 
}
```

### å‰¯ä½œç”¨é’©å­ Effffect Hook

useEffect ç»™å‡½æ•°ç»„ä»¶å¢åŠ äº†æ‰§è¡Œå‰¯ä½œç”¨æ“ä½œçš„èƒ½åŠ›ã€‚ 

å‰¯ä½œç”¨ï¼ˆSide Effffectï¼‰æ˜¯æŒ‡ä¸€ä¸ª function åšäº†å’Œæœ¬èº«è¿ç®—è¿”å›å€¼æ— å…³çš„äº‹ï¼Œæ¯”å¦‚ï¼šä¿®æ”¹äº†å…¨å±€å˜é‡ã€ä¿®æ”¹äº†ä¼ å…¥çš„å‚æ•°ã€ç”šè‡³æ˜¯ console.log()ï¼Œæ‰€ä»¥ ajax æ“ä½œï¼Œä¿®æ”¹ dom éƒ½æ˜¯ç®—ä½œå‰¯ä½œç”¨ã€‚

```react
// å¼‚æ­¥æ•°æ®è·å–ï¼Œæ›´æ–°HooksTest.js
import { useEffect } from "react"; 
useEffect(()=>{ 
    setTimeout(() => { setFruits(['é¦™è•‰','è¥¿ç“œ']) }, 1000); 
},[])
// è®¾ç½®ç©ºæ•°ç»„æ„ä¸ºæ²¡æœ‰ä¾èµ–ï¼Œåˆ™å‰¯ä½œç”¨æ“ä½œä»…æ‰§è¡Œä¸€æ¬¡
// å¦‚æœå‰¯ä½œç”¨æ“ä½œå¯¹æŸçŠ¶æ€æœ‰ä¾èµ–ï¼ŒåŠ¡å¿…æ·»åŠ ä¾èµ–é€‰é¡¹
// useEffect(() => { document.title = fruit; }, [fruit]);

// æ¸…é™¤å·¥ä½œï¼šæœ‰ä¸€äº›å‰¯ä½œç”¨æ˜¯éœ€è¦æ¸…é™¤çš„ï¼Œæ¸…é™¤å·¥ä½œéå¸¸é‡è¦çš„ï¼Œå¯ä»¥é˜²æ­¢å¼•èµ·å†…å­˜æ³„éœ²
useEffect(() => { 
    const timer = setInterval(() => { console.log('msg'); }, 1000); 
    return function(){ 
        clearInterval(timer); 
    } 
}, []);
```

### useReducer

[`useState`](https://zh-hans.reactjs.org/docs/hooks-reference.html#usestate) çš„æ›¿ä»£æ–¹æ¡ˆã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå½¢å¦‚ `(state, action) => newState` çš„ reducerï¼Œå¹¶è¿”å›å½“å‰çš„ state ä»¥åŠä¸å…¶é…å¥—çš„ `dispatch` æ–¹æ³•ã€‚ï¼ˆå¦‚æœä½ ç†Ÿæ‚‰ Redux çš„è¯ï¼Œå°±å·²ç»çŸ¥é“å®ƒå¦‚ä½•å·¥ä½œäº†ã€‚ï¼‰

åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œ`useReducer` ä¼šæ¯” `useState` æ›´é€‚ç”¨ï¼Œä¾‹å¦‚ state é€»è¾‘è¾ƒå¤æ‚ä¸”åŒ…å«å¤šä¸ªå­å€¼ï¼Œæˆ–è€…ä¸‹ä¸€ä¸ª state ä¾èµ–äºä¹‹å‰çš„ state ç­‰ã€‚å¹¶ä¸”ï¼Œä½¿ç”¨ `useReducer` è¿˜èƒ½ç»™é‚£äº›ä¼šè§¦å‘æ·±æ›´æ–°çš„ç»„ä»¶åšæ€§èƒ½ä¼˜åŒ–ï¼Œå› ä¸º[ä½ å¯ä»¥å‘å­ç»„ä»¶ä¼ é€’ `dispatch` è€Œä¸æ˜¯å›è°ƒå‡½æ•°](https://zh-hans.reactjs.org/docs/hooks-faq.html#how-to-avoid-passing-callbacks-down) ã€‚

å¸¸ç”¨äºç»„ä»¶æœ‰å¤æ‚çŠ¶æ€é€»è¾‘æ—¶ï¼Œç±»ä¼¼äºreduxä¸­reduceræ¦‚å¿µã€‚

```react
// å•†å“åˆ—è¡¨çŠ¶æ€ç»´æŠ¤
import { useReducer } from "react"; 
// æ·»åŠ fruitçŠ¶æ€ç»´æŠ¤fruitReducer 
function fruitReducer(state, action) { 
    switch (action.type) { 
        case "init": return action.payload; 
        case "add": return [...state, action.payload]; 
        default: return state; 
    } 
}
export default function HooksTest() { 
    // ç»„ä»¶å†…çš„çŠ¶æ€ä¸éœ€è¦äº† 
    // const [fruits, setFruits] = useState([]); 
    // useReducer(reducerï¼ŒinitState) 
    const [fruits, dispatch] = useReducer(fruitReducer, []); 
    useEffect(() => { 
        setTimeout(() => { 
            // setFruits(["é¦™è•‰", "è¥¿ç“œ"]); 
            // å˜æ›´çŠ¶æ€ï¼Œæ´¾å‘åŠ¨ä½œå³å¯ 
            dispatch({ type: "init", payload: ["é¦™è•‰", "è¥¿ç“œ"] }); 
        }, 1000); 
    }, []); 
    return ( 
        <div> 
            {/*æ­¤å¤„ä¿®æ”¹ä¸ºæ´¾å‘åŠ¨ä½œ*/} 
            <FruitAdd onAddFruit={pname => dispatch({type: 'add', payload: pname})} /> 
        </div>
    );
}
```

è®¡æ•°å™¨æ¡ˆä¾‹ï¼š

```react
const initialState = {count: 0};

function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    default:
      throw new Error();
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, initialState);
  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
    </>
  );
}
```

### useContext

useContextç”¨äºåœ¨å¿«é€Ÿåœ¨å‡½æ•°ç»„ä»¶ä¸­å¯¼å…¥ä¸Šä¸‹æ–‡ã€‚

```react
import React, { useContext } from "react"; 
// åˆ›å»ºä¸Šä¸‹æ–‡ 
const Context = React.createContext(); 
export default function HooksTest() { 
    // ... 
    return ( 
        {/* æä¾›ä¸Šä¸‹æ–‡çš„å€¼ */} 
        <Context.Provider value={{fruits,dispatch}}> <div> 
            {/* è¿™é‡Œä¸å†éœ€è¦ç»™FruitAddä¼ é€’çŠ¶æ€mutationå‡½æ•°ï¼Œå®ç°äº†è§£è€¦ */} 
            <FruitAdd /> </div>
        </Context.Provider> 
    ); 
}
function FruitAdd(props) { 
    // ä½¿ç”¨useContextè·å–ä¸Šä¸‹æ–‡ 
    const {dispatch} = useContext(Context) 
    const onAddFruit = e => { 
        if (e.key === "Enter") { 
            // ç›´æ¥æ´¾å‘åŠ¨ä½œä¿®æ”¹çŠ¶æ€ 
            dispatch({ type: "add", payload: pname }) 
            setPname(""); 
        } 
    };
    // ... 
}
```

# 