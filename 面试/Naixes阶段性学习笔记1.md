## css

### cssé¢„å¤„ç†å™¨

å¤„ç†ç‰¹å®šæ ¼å¼æºæ–‡ä»¶åˆ°ç›®æ ‡cssçš„å¤„ç†ç¨‹åºã€‚

sassï¼Œå¤ªé‡ï¼Œè€

lessï¼Œè½»ä¸€ç‚¹

stylus

å¸¸ç”¨è§„èŒƒï¼š

å˜é‡ æ··åˆ(Mixin)Extend

åµŒå¥—è§„åˆ™

è¿ç®—

å‡½æ•°

Namespaces & Accessors

Scope

æ³¨é‡Š

åŸç”Ÿcssä¹Ÿéƒ½èƒ½æä¾›äº†

### cssåå¤„ç†å™¨

CSSå‹ç¼© CLEAN-CSS

è‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€ Autoprefixer

CSSæ›´åŠ ç¾è§‚æ’åº CSScomb

Reworkå–ä»£Stylus åå¤„ç†å™¨å‘çƒ­

å‰åé€šåƒ **PostCSS**

#### postcss

csså¤„ç†å™¨

æ’ä»¶ï¼š

POSTCSS-CUSTOM-PROPERTIES è¿è¡Œæ—¶å˜é‡

POSTCSS-SIMPLE-VARS ä¸SCSSä¸€è‡´çš„å˜é‡å®ç°

POSTCSS-MIXINS å®ç°ç±»ä¼¼SASSçš„@MIXINçš„åŠŸèƒ½

POSTCSS-EXTEND å®ç°ç±»ä¼¼SASSçš„ç»§æ‰¿åŠŸèƒ½

POSTCSS-IMPORT å®ç°ç±»ä¼¼SASSçš„IMPORT

CSSNext é¢å‘æœªæ¥ CSS Grace ä¿®å¤è¿‡å»

### cssnext

å·²å¼ƒç”¨

postcss-preset-env

### js in css

åŸç”Ÿå¯ä½¿ç”¨

vue3å¯ä»¥ä½¿ç”¨ï¼Œè‡ªå·±å†™çš„ï¼Œvite

### åŸå­css

ä»£è¡¨åº“ï¼šTailwind css

é¡¹ç›®å‚è€ƒï¼š

```js
// postcss.config.js
module.exports = {
  plugins: {
    'postcss-preset-env': {
      stage: 0,
      features: {
        'nesting-rules': true,
      },
    },
  },
};


// webpack.config.js
module.exports = {
  module: {
    rules: [
      {
        enforce: 'pre',
        test: /\.css$/,
        exclude: /node_modules/,
        loader: 'typed-css-modules-loader',
      },
      {
        test: /\.css$/i,
        use: [
          'style-loader',
          {
            loader: 'css-loader',
            options: {
              modules: true,
            },
          },
          'postcss-loader',
        ],
      },
    ],
  },
};

// index.js
// ä¸èƒ½è¿™æ ·å¼•å…¥ï¼Œå¼‚æ­¥çš„ï¼Œç‹¬ç«‹çš„chunk
// import('./index.css');
// css in js
import index from './index.css';
const _html = `<div  class='${index.test}'><h1>äº¬ç¨‹ä¸€ç¯ğŸ®</h1></div>`;
console.log('index: ', index);
document.getElementById('app').innerHTML = _html;

// index.css
:root {
  --sinColor: black;
}
body {
  background: var(--sinColor);
}
.test {
  & h1 {
    color: yellowgreen;
  }
}
```

css-doodleï¼Œåšäº†æ”¯æŒ

æ˜¯ä¸€ä¸ªweb compoments

### css in js

é¢å¤–åŠ è½½cssä¼šå¯¼è‡´jsçš„æ‰§è¡Œï¼Œcss in jså¯ä»¥å‡å°‘cssçš„è¯·æ±‚ï¼Œä½†æ˜¯jsä¼šå¤šä¸€äº›é¢å¤–çš„polyfill

styled components

twin

emotion

### CSSHoudini

åœ¨ç°ä»Šçš„ Web å¼€å‘ä¸­ï¼ŒJavaScript å‡ ä¹å æ®æ‰€æœ‰ç‰ˆé¢ï¼Œé™¤äº†æ§åˆ¶é¡µé¢é€»è¾‘ä¸æ“ä½œ DOM å¯¹è±¡ä»¥å¤–ï¼Œè¿ CSS éƒ½ç›´æ¥å†™åœ¨ JavaScript é‡Œé¢äº†ï¼Œå°±ç®—æµè§ˆå™¨éƒ½è¿˜æ²’æœ‰å®ç°çš„ç‰¹æ€§ï¼Œæ€»ä¼šæœ‰äººåšå‡ºå¯¹åº”çš„ Polyfillsï¼Œè®©ä½ å¿«é€Ÿçš„å°†æ–° Feature åº”ç”¨åˆ° Production ç¯å¢ƒä¸­ï¼Œæ›´åˆ¥ææˆ‘ä»¬è¿˜æœ‰ Babel ç­‰å·¥å…·å¸®å¿™è½¬è¯‘ã€‚

è€Œ CSS å°±ä¸åŒäº†ï¼Œé™¤äº†åˆ¶å®š CSS æ ‡å‡†è§„èŒƒæ‰€éœ€çš„æ—¶é—´å¤–ï¼Œå„å®¶æµè§ˆå™¨çš„ç‰ˆæœ¬ã€å®æˆ˜è¿›åº¦å·®å¼‚æ›´æ˜¯ æ—·æ—¥æŒä¹…ï¼Œé¡¶å¤šåˆ©ç”¨ PostCSSã€Sass ç­‰å·¥å…·ä¾†å¸®æˆ‘å€‘è½¬è¯‘å‡ºæµè§ˆå™¨èƒ½æ¥å—çš„ CSSã€‚å¼€å‘è€…ä»¬èƒ½æ“ä½œçš„å°±æ˜¯é€šè¿‡ JS å»æ§åˆ¶ DOM ä¸ CSSOMæ¥å½±å“é¡µé¢çš„å˜åŒ–ï¼Œä½†æ˜¯å¯¹äºæ¥ä¸‹ä¾†çš„ Layoutã€Paint ä¸ Composite å°±å‡ ä¹æ²’æœ‰æ§åˆ¶æƒäº†ã€‚

ä¸ºäº†è§£æ±ºä¸Šè¿°é—®é¢˜ï¼Œä¸ºäº†è®© CSS çš„é­”åŠ›ä¸å†æµè§ˆå™¨æŠŠæŒï¼ŒHoudini å°±è¯ç”Ÿäº†!
CSS Houdini æ˜¯ç”±ä¸€ç¾¤ä¾†è‡ª Mozilla, Apple, Opera, Microsoft, HP, Intel, IBM, Adobe ä¸ Google çš„å·¥ç¨‹ å¸ˆæ‰€ç»„æˆçš„å·¥ä½œå°ç»„ï¼Œå¿—åœ¨å»ºç«‹ä¸€ç³»åˆ—çš„ APIï¼Œè®©å¼€å‘è€…èƒ½å¤Ÿä»‹å…¥æµè§ˆå™¨çš„ CSS engine

#### Parserã€Paintã€Layout API æ‰©å±•CSSè¯æ³•åˆ†æå™¨

**CSS Parser API** è¿˜æ²¡æœ‰è¢«å†™å…¥è§„èŒƒï¼Œæ‰€ä»¥ä¸‹é¢çš„å†…å®¹éšæ—¶éƒ½ä¼šæœ‰å˜åŒ–ï¼Œä½†æ˜¯å®ƒçš„åŸºæœ¬æ€æƒ³ä¸ä¼šå˜:å…è®¸å¼€å‘è€…è‡ªç”±æ‰©å±• CSS è¯æ³•åˆ†æå™¨ï¼Œå¼•å…¥æ–°çš„ç»“æ„(constructs)ï¼Œ æ¯”å¦‚æ–°çš„åª’ä½“è§„åˆ™ã€æ–°çš„ä¼ªç±»ã€åµŒå¥—ã€@extendsã€ @apply ç­‰ç­‰ã€‚åªè¦æ–°çš„è¯æ³•åˆ†æå™¨çŸ¥é“å¦‚ä½• è§£æè¿™äº›æ–°ç»“æ„ï¼ŒCSSOM å°± ä¸ä¼šç›´æ¥å¿½ç•¥å®ƒä»¬ï¼Œè€Œæ˜¯æŠŠè¿™äº›ç»“æ„æ”¾åˆ°æ­£ç¡®çš„åœ°æ–¹ã€‚

**CSS Layout API**å…è®¸å¼€å‘ è€…å¯ä»¥é€šè¿‡ CSS Layout API å®ç°è‡ªå·±çš„å¸ƒå±€æ¨¡å— (layout module)ï¼Œè¿™é‡Œ çš„â€œå¸ƒå±€æ¨¡å—â€æŒ‡çš„æ˜¯ display çš„å±æ€§å€¼ã€‚ä¹Ÿå°±æ˜¯ è¯´ï¼Œè¿™ä¸ª API å®ç°ä»¥åï¼Œ å¼€å‘è€…é¦–æ¬¡æ‹¥æœ‰äº†åƒ CSS åŸç”Ÿä»£ç (æ¯”å¦‚ display:flexã€ display:table)é‚£æ ·çš„å¸ƒå±€èƒ½åŠ›ã€‚

**CSS Paint API** Layout API éå¸¸ç›¸ä¼¼ã€‚å®ƒæä¾›äº†ä¸€ä¸ª registerPaint æ–¹æ³•ï¼Œæ“ä½œæ–¹å¼å’Œ Worklet ç›¸ä¼¼ã€‚å½“æƒ³è¦æ„å»ºä¸€ä¸ªCSS å›¾åƒçš„æ—¶å€™ï¼Œå¼€å‘è€…éšæ—¶å¯ä»¥è°ƒç”¨paint() å‡½ æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åˆšåˆšæ³¨å†Œå¥½çš„åå­—ã€‚

å…·ä½“çš„codingè¿‡ç¨‹è¦å€ŸåŠ©Worklet

**CSS Layout API** 

`.item-list { display: layout(waterfall); } // https://www.jasondavies.com/wordcloud/`

<img src="./Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ3.39.39.png" alt="æˆªå±2021-05-24 ä¸‹åˆ3.39.39" style="zoom:50%;" />

**Box tree API** ç›®çš„å°±æ˜¯å¸Œæœ›è®©å¼€å‘è€…èƒ½å¤Ÿå–å¾—è¿™äº› fragments çš„ä¿¡æ¯ï¼Œè‡³äºå–å¾—åè¦å¦‚ä½•ä½¿ç”¨ï¼ŒåŸºæœ¬ä¸Šåº”è¯¥ä¼šè·Ÿå é¢ä»‹ç»çš„ Parser APIã€Layout API ä¸ Paint API æœ‰å…³è”ï¼Œå½“æˆ‘ä»¬èƒ½å–å¾—è¯¦ç»†çš„ Box Modal ä¿¡æ¯æ—¶ï¼Œè¦å®¢åˆ¶åŒ– Layout Module æ‰æ›´ä¸ºæ–¹ä¾¿ã€‚

<img src="./Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ3.44.29.png" alt="æˆªå±2021-05-24 ä¸‹åˆ3.44.29" style="zoom:50%;" />

**CSS Paint API**

`.test { background-image: paint(circle); } `

<img src="./Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ3.47.31.png" alt="æˆªå±2021-05-24 ä¸‹åˆ3.47.31" style="zoom:50%;" />

canvasåŠ£åŠ¿ï¼Œdomå…ƒç´ å¢å¤šï¼Œç‹¬ç«‹æˆå±‚ï¼ŒGPUæ¸²æŸ“å˜æ…¢

#### Worklets

`xxxWorklet.addModule('xxx.js').then(...)`

( registerLayout å’Œ registerPaint)å·²ç»äº†è§£è¿‡äº†ï¼Œä¼°è®¡ç°åœ¨ä½ æƒ³çŸ¥ é“çš„æ˜¯ï¼Œè¿™äº›ä»£ç å¾—æ”¾åœ¨å“ªé‡Œå‘¢?ç­”æ¡ˆå°±æ˜¯ worklet è„šæœ¬(å·¥ä½œæµè„šæœ¬ æ–‡ä»¶)ã€‚
 Worklets çš„æ¦‚å¿µå’Œ web worker ç±»ä¼¼ï¼Œå®ƒä»¬å…è®¸ä½ å¼•å…¥è„šæœ¬æ–‡ä»¶å¹¶æ‰§ è¡Œç‰¹å®šçš„ JS ä»£ç ï¼Œè¿™æ ·çš„ JS ä»£ç è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶:

ç¬¬ä¸€ï¼Œå¯ä»¥åœ¨æ¸²æŸ“ æµç¨‹ä¸­è°ƒç”¨;

ç¬¬äºŒï¼Œå’Œä¸»çº¿ç¨‹ç‹¬ç«‹ã€‚

Worklet è„šæœ¬ä¸¥æ ¼æ§åˆ¶äº†å¼€å‘è€…æ‰€èƒ½æ‰§è¡Œçš„æ“ä½œç±»å‹ï¼Œè¿™å°±ä¿è¯äº†æ€§èƒ½ Worklets çš„ç‰¹ç‚¹å°±æ˜¯è½»é‡ä»¥åŠç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­ã€‚

> å…¨å±€å˜é‡CSS

`CSS.paintWorklet.addModule('xxx.js') CSS.layoutWorklet.addModule(â€˜xxx.js')`

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ4.11.40.png" alt="æˆªå±2021-05-24 ä¸‹åˆ4.11.40" style="zoom:30%;" />

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ4.12.05.png" alt="æˆªå±2021-05-24 ä¸‹åˆ4.12.05" style="zoom:20%;" />

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ4.12.19.png" alt="æˆªå±2021-05-24 ä¸‹åˆ4.12.19" style="zoom:20%;" />

#### Typed OM Object

 è§£å†³ç›®å‰æ¨¡å‹çš„ä¸€äº›é—®é¢˜ï¼Œå¹¶å®ç° CSS Parsing API å’Œ CSS å±æ€§ä¸å€¼ API ç›¸å…³çš„ç‰¹æ€§ã€‚

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-24 ä¸‹åˆ4.23.03.png" alt="æˆªå±2021-05-24 ä¸‹åˆ4.23.03" style="zoom:30%;" />

```js
el.attributeStyleMap.set('padding', CSS.px(42))
const padding = el.attributeStyleMap.get('padding')
console.log(padding.value, padding.unit)
// 42, 'px'
```

æ›´å°‘çš„bugã€‚ä¾‹å¦‚æ•°å­—å€¼æ€»æ˜¯ä»¥æ•°å­—å½¢å¼è¿”å›ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚

el.style.opacity += 0.1; el.style.opacity === '0.30.1' // dragons!

ç®—æœ¯è¿ç®—å’Œå•ä½è½¬æ¢ã€‚åœ¨ç»å¯¹é•¿åº¦å•ä½(ä¾‹å¦‚ px -> cm)ä¹‹é—´è¿›è¡Œè½¬æ¢å¹¶è¿›è¡ŒåŸºæœ¬çš„æ•°å­¦è¿ç®—ã€‚

æ•°å€¼èŒƒå›´é™åˆ¶å’Œèˆå…¥ã€‚Typed OM é€šè¿‡å¯¹å€¼è¿›è¡ŒèŒƒå›´é™åˆ¶å’Œèˆå…¥ï¼Œä»¥ä½¿å…¶åœ¨å±æ€§çš„å¯æ¥å—èŒƒå›´å†…ã€‚

æ›´å¥½çš„æ€§èƒ½ã€‚æµè§ˆå™¨å¿…é¡»åšæ›´å°‘çš„å·¥ä½œåºåˆ—åŒ–å’Œååºåˆ—åŒ–å­—ç¬¦ä¸²å€¼ã€‚ç°åœ¨ï¼Œå¯¹äº CSS å€¼ï¼Œå¼•æ“å¯ä»¥å¯¹ JS å’Œ C++ ä½¿ç”¨ç›¸ä¼¼çš„ç†è§£ã€‚Tab Akins å·²ç»å±•ç¤ºäº†ä¸€äº›æ—©æœŸçš„æ€§èƒ½åŸºå‡†æµ‹è¯•ï¼Œä¸ä½¿ç”¨æ—§çš„ CSSOM å’Œå­—ç¬¦ä¸²ç›¸ æ¯”ï¼ŒTyped OM çš„è¿è¡Œé€Ÿåº¦å¿«äº† ~30%ã€‚è¿™å¯¹ä½¿ç”¨ requestionAnimationFrame() å¤„ç†å¿«é€Ÿ CSS åŠ¨ç”»å¯èƒ½å¾ˆé‡ è¦ ã€‚crbug.com/808933 å¯ä»¥è¿½è¸ª Blink çš„æ›´å¤šæ€§èƒ½æ¼”ç¤ºã€‚

é”™è¯¯å¤„ç†ã€‚æ–°çš„è§£ææ–¹æ³•å¸¦æ¥äº† CSS ä¸–ç•Œä¸­çš„é”™è¯¯å¤„ç†ã€‚

ä½ ä¸å†éœ€è¦çŒœæµ‹åå­—æ˜¯éª†é©¼è¿˜æˆ–å­—ç¬¦ä¸²(ä¾‹å¦‚ï¼šel.style.backgroundColor vs el.style['background-color'])ã€‚Typed OM ä¸­çš„ CSS å±æ€§åç§°å§‹ç»ˆæ˜¯å­—ç¬¦ä¸²ï¼Œä¸ æ‚¨å®é™…åœ¨ CSS ä¸­ç¼–å†™çš„å†…å®¹ä¸€è‡´:)

### é¢å‘å¯¹è±¡

æ³¨æ„äº‹é¡¹:

1. ä¸è¦ç›´æ¥å®šä¹‰å­èŠ‚ç‚¹ï¼Œåº”æŠŠå…±æ€§å£°æ˜æ”¾åˆ°çˆ¶ç±»ã€‚
2. ç»“æ„å’Œçš®è‚¤ç›¸åˆ†ç¦»ã€‚
3. å®¹å™¨å’Œå†…å®¹ç›¸åˆ†ç¦»ã€‚
4. æŠ½è±¡å‡ºå¯é‡ç”¨çš„å…ƒç´ ï¼Œå»ºå¥½ç»„ä»¶åº“ï¼Œåœ¨ç»„ä»¶åº“å†…å¯»æ‰¾å¯ç”¨çš„å…ƒç´ ç»„è£…â»šé¢ã€‚
5. å¾€ä½ æƒ³è¦æ‰©å±•çš„å¯¹è±¡æœ¬èº«å¢åŠ classè€Œä¸æ˜¯ä»–çš„çˆ¶èŠ‚ç‚¹ã€‚
6. å¯¹è±¡åº”ä¿æŒç‹¬ç«‹æ€§ã€‚
7. é¿å…ä½¿ç”¨IDé€‰æ‹©å™¨ï¼Œæƒé‡å¤ªé«˜ï¼Œæ— æ³•é‡ç”¨ã€‚
8. é¿å…ä½ç½®ç›¸å…³çš„æ ·å¼ã€‚
9. ä¿è¯é€‰æ‹©å™¨ç›¸åŒçš„æƒé‡ã€‚
10. ç±»å ç®€çŸ­ æ¸…æ™° è¯­ä¹‰åŒ– OOCSSçš„åå­—å¹¶ä¸å½±å“HTMLè¯­ä¹‰åŒ–ã€‚

### åˆ†å±‚

> å¦‚ä½•æ§åˆ¶css scoped
>
> ä½¿ç”¨css moduleï¼ˆå°†ç±»md5ï¼‰/style componentï¼ˆå°†cssç»´æŠ¤åˆ°ç»„ä»¶é‡Œè¾¹ï¼‰

SMACSS 

**BEM**ï¼Œantdesignä½¿ç”¨ï¼Œåå­—é•¿ï¼ˆcssnanoï¼‰

- block -ä»£è¡¨äº†æ›´é«˜çº§åˆ«çš„æŠ½è±¡æˆ–ç»„ä»¶

- block\__element -ä»£è¡¨.blockçš„åä»£ï¼Œç”¨äºå½¢æˆä¸€ä¸ªå®Œæ•´çš„.blockçš„æ•´ä½“ã€‚

- .block--modifier -ä»£è¡¨.blockçš„ä¸åŒçŠ¶æ€æˆ–ä¸åŒç‰ˆæœ¬ã€‚

- ä¿®é¥°ç¬¦ä½¿ç”¨çš„æ˜¯_ï¼Œå­æ¨¡å—ä½¿ç”¨__ç¬¦å·ã€‚(ä¸ç”¨ä¸€ä¸ª-çš„åŸå› æ˜¯CSSå•è¯è¿æ¥)

SUIT

**ACSS**ï¼ŒåŸå­cssï¼Œä»£è¡¨åº“ï¼šTailwind css

 ITCSS

### cssçŸ©é˜µ

2D&3DçŸ©é˜µåº”ç”¨

å‰è€…æ˜¯å…ƒç´ 2Då¹³é¢çš„ç§»åŠ¨å˜æ¢(transform)ï¼Œåè€…åˆ™æ˜¯3Då˜æ¢ã€‚2Då˜æ¢çŸ©é˜µä¸º3\*3;3Då˜æ¢åˆ™æ˜¯4*4çš„çŸ©é˜µã€‚ 						

skew scale rotate translate æ–œæ‹‰ ç¼©æ”¾ æ—‹è½¬ ä½ç§»

#### 2D

`transform: matrix(a,b,c,d,e,f)`ï¼ŒçŸ©é˜µä¸º3*3ï¼Œæ— è®ºæ˜¯æ—‹è½¬è¿˜æ˜¯ä½ç§»ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯ç”±matrix()å®ç°çš„

åç§»

![transformçŸ©é˜µè®¡ç®—](/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/transformçŸ©é˜µè®¡ç®—.png)

```js
matrix(sx,tan(Î¸y),tan(Î¸x),sy,n,m) // n:æ°´å¹³åç§»ï¼Œm:å‚ç›´åç§»ï¼Œsx:ç¼©æ”¾xï¼Œsy:ç¼©æ”¾y
// ç¼©æ”¾
x' = ax+cy+e = s*x+0*y+0 = s*x; 
y' = bx+dy+f = 0*x+s*y+0 = s*y;
matrix(sx, 0, 0, sy, 0, 0); 
ç­‰åŒäºscale(sx, sy);
// æ—‹è½¬
Math.cos(this.value * Math.PI / 180);
Math.sin(this.value * Math.PI / 180); 
transform: matrix(0.866025,0.500000,-0.500000,0.866025,0,0); transform:rotate(30deg);
//æ‹‰ä¼¸(skew)
matrix(1,tan(Î¸y),tan(Î¸x),1,0,0)
x' = x+y*tan(Î¸x)+0 = x+y*tan(Î¸x) 
y' = x*tan(Î¸y)+y+0 = x*tan(Î¸y)+y
```

æ—‹è½¬

<img src="/Users/huangsiying/project/00 github/notes/CSS.assets/æˆªå±2021-05-25 ä¸‹åˆ4.03.49.png" alt="æˆªå±2021-05-25 ä¸‹åˆ4.03.49" style="zoom:50%;" />

http://www.css88.com/tool/css3Preview/Transform-Matrix.html

#### 3D

çŸ©é˜µä¸º4*4

<img src="/Users/huangsiying/project/00 github/notes/CSS.assets/æˆªå±2021-05-25 ä¸‹åˆ3.57.27.png" alt="æˆªå±2021-05-25 ä¸‹åˆ3.57.27" style="zoom:50%;" />

#### æ›´å¤šåœºæ™¯

```
// SVG 
transform="matrix(a b c d e f)"
<!--other elements> ...</g>
// Canvas 
context.transform(2,0,0,2,150,150);
// CSS3D
transform: matrix3d(sx, 0, 0, 0, 0, sy, 0, 0, 0, 0, sz, 0, 0, 0, 0, 1)
```

WebGL

çŸ©é˜µåœ¨3Dæ¸²æŸ“ä¸­ä¸å¯ç¼ºå°‘ï¼Œåæ ‡å˜æ¢æœ‰æ¨¡å‹å˜æ¢ï¼Œè§†å›¾å˜æ¢ï¼ŒæŠ•å½±å˜æ¢ç­‰å¤šç§ã€‚

#### å·¥å…·

å‚è€ƒï¼š

http://wow.techbrood.com/fiddle/25741

matrix3d
http://ds-overdesign.com/transform/matrix3d.html 

CSS-Matrix3dï¼šwebpackè½¬æ¢
https://github.com/Zhangdroid/CSS-Matrix3d 

matrix
http://meyerweb.com/eric/tools/matrix/ 

toolsï¼šè®¾è®¡åŠ¨ç”»
http://www.f2e.name/case/css3/tools.html 

css 3d

tridiv.com

> bestofjs.org // ä¼˜ç§€åº“
>
> cssæ­ç§˜ // ä¹¦

## vue

> web componentsï¼Œå°ç¨‹åºåº•å±‚æ¶æ„ç”¨åˆ°

### æ¶æ„

- distï¼š

  - compile ç¼–è¯‘æ—¶

    - ç¦»çº¿ç¼–è¯‘ï¼Œæœªä¸Šçº¿å‰ï¼Œtemplate -> jsï¼Œè¿è¡Œä¹‹å‰

    - åœ¨çº¿ç¼–è¯‘ï¼Œè¿è¡Œæ—¶ç¼–è¯‘

    `new vue({template: ""}) // åœ¨çº¿ç¼–è¯‘`

  - runtime è¿è¡Œæ—¶ï¼Œåæ˜ å†…å­˜é‡Œçš„æ•°æ®çŠ¶æ€ï¼Œæœ‰è™šæ‹Ÿdomï¼Œè¢«å¤„ç†è¿‡çš„å“åº”å¼æ•°æ®ç­‰

  - æ‰“åŒ…å‡ºæ¥çš„

    - runtime onlyï¼Œæ— ç¼–è¯‘å™¨ï¼Œä¸èƒ½æ‰§è¡Œåœ¨çº¿ç¼–è¯‘
    - runtime+compile

- flowï¼ˆjsç±»å‹æ¡†æ¶ï¼ŒFacebookå·²ç»ä¸æ”¯æŒäº†ï¼Œå’Œtsä¸åŒï¼Œtsæ˜¯è¯­è¨€ï¼‰

- packagesï¼š

  - vueæä¾›çš„ï¼Œå·¥ç¨‹åŒ–ä½¿ç”¨åˆ°çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æ¨¡ç‰ˆç¼–è¯‘ï¼ˆvue-loaderä¸­é›†æˆäº†è¿™ä¸ªï¼‰ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“çš„ä¸€äº›ä¸œè¥¿

- scriptsï¼š
  - æ‰“åŒ…è§„èŒƒç­‰ï¼Œconfig.js
  - æ‰“å‡ºæ¥çš„åŒ…only runtime/runtime + compiler
  
- srcï¼Œæ ¸å¿ƒä»£ç 

  - **compilerï¼Œç¼–è¯‘ä»£ç **
  - **coreï¼Œæ ¸å¿ƒè¿è¡Œæ—¶**
  - platformsï¼Œä¸åŒç«¯çš„å¤„ç†ï¼Œä¸åŒå¹³å°
  - serverï¼ŒæœåŠ¡ç«¯
  - sfcï¼Œå•æ–‡ä»¶ç»„ä»¶ï¼Œåˆ†åˆ«å¤„ç†htmlï¼Œjså’Œcss
  - shared

å¯¹æ¯”ï¼š

vueï¼Œæœ‰ä¸€å¥—å›ºå®šçš„è¯­æ³•è§„èŒƒï¼Œç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå°†templateè½¬åŒ–ä¸ºjsï¼Œåˆ†ä¸ºç¦»çº¿ç¼–è¯‘å’Œåœ¨çº¿ç¼–è¯‘

```js
new Vue({
	template: "" // æ­¤æ—¶ä½¿ç”¨çš„å°±æ˜¯åœ¨çº¿ç¼–è¯‘
})
```

vueçš„è¿è¡Œæ—¶åŒ…æ‹¬è™šæ‹Ÿdomï¼Œè¢«å¤„ç†è¿‡çš„å“åº”å¼æ•°æ®

reactï¼Œåªæ›¿æ¢æ ‡ç­¾ï¼Œç›¸å½“äºåœ¨å†™jsï¼Œåœ¨è¿è¡Œæ—¶ä¼˜åŒ–ï¼ˆfiberæ¶æ„ï¼‰ï¼Œç¼–è¯‘æ—¶å°±æ˜¯jsï¼Œä¼˜åŒ–ä¸äº†

Vueæ¨¡ç‰ˆç¼–è¯‘å‡ºæ¥çš„ä»£ç ï¼š

```js
// ç”¨withç»‘å®šthisï¼Œthisæ˜¯vueå®ä¾‹ï¼Œå› ä¸ºæ¨¡ç‰ˆåˆ†æä¸èƒ½å‡†ç¡®åˆ†æå‡ºå½“å‰çš„thisï¼Œéœ€è¦å•ç‹¬çš„jsè§£æå™¨æ‰è¡Œï¼Œæ‰€ä»¥ç”¨withç»Ÿä¸€ç»‘å®šï¼Œæ‰€ä»¥æ‰€æœ‰çš„å±æ€§éƒ½éœ€è¦ç»‘å®šåœ¨vueå®ä¾‹ä¸Šï¼Œå¦åˆ™è·å–ä¸åˆ°ï¼Œthiså› ä¸ºä½¿ç”¨withç»Ÿä¸€ç»‘å®šçš„

with(this) {
	// åˆ›å»ºè™šæ‹Ÿdomå¹¶è¿”å›
	return _c(...)
}
```

åœ¨vue3ä¸­ï¼Œç¦»çº¿ç¼–è¯‘å’Œåœ¨çº¿ç¼–è¯‘ä½¿ç”¨äº†ä¸åŒçš„æ–¹æ¡ˆï¼Œç¦»çº¿ç¼–è¯‘é›†æˆäº†jsç¼–è¯‘å™¨åˆ†æjsï¼Œæ²¡æœ‰ä½¿ç”¨withï¼Œåœ¨çº¿ç¼–è¯‘è¿˜æ˜¯ä½¿ç”¨çš„with

#### **vue2ç¼–è¯‘**

ç¼ºç‚¹ï¼šä½¿ç”¨æ­£åˆ™åŒ¹é…æ¨¡ç‰ˆï¼Œå›æº¯é—®é¢˜ï¼Œæ€§èƒ½é—®é¢˜ï¼Œæ‰©å±•é—®é¢˜ï¼Œvue3ç¼–è¯‘ï¼Œä½¿ç”¨çŠ¶æ€æœº

ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼šé™æ€èŠ‚ç‚¹ä¼˜åŒ–ï¼Œé€’å½’åˆ†æé™æ€èŠ‚ç‚¹ï¼Œæ·»åŠ æ ‡è®°ï¼Œè·³è¿‡dom diff

è¿‡ç¨‹ï¼š

baseCompile

â€‹	parse: html -> ast

â€‹		æ‰§è¡ŒparseHTMLï¼Œæ„å»ºASTElement

â€‹			æ„å»ºåŸºç¡€æ•°æ®ç±»å‹

â€‹			åˆ¤æ–­å¤„ç†ä¸åŒæ ‡ç­¾ï¼Œæ‰§è¡Œå›è°ƒï¼Œå¼€å§‹ï¼Œç»“æŸï¼ˆç»´æŠ¤äº†ä¸€ä¸ª**å †æ ˆ**ï¼Œç»“æŸæ—¶å‡ºæ ˆï¼‰ï¼Œæ–‡æœ¬ï¼Œæ³¨é‡Šæ ‡ç­¾

â€‹			æ­£åˆ™åŒ¹é…

â€‹	optimizeé™æ€åˆ†æï¼Œä¼˜åŒ–

â€‹		æ·±åº¦ä¼˜å…ˆéå†æ ‡è®°é™æ€èŠ‚ç‚¹

â€‹	generateï¼šast -> å¯æ‰§è¡Œä»£ç 

â€‹		genElementï¼Œé€šè¿‡astæ‹¼æ¥å­—ç¬¦ä¸²

â€‹			åˆ¤æ–­é™æ€èŠ‚ç‚¹

â€‹		è¿”å›æ‹¼æ¥çš„renderå’ŒstaticRenderFnsæ–¹æ³•ï¼ˆæ‹¼æ¥æˆçš„withæ–¹æ³•ï¼‰

â€‹	è¿”å›astï¼Œrenderå’ŒstaticRenderFns

#### **è¿è¡Œæ—¶æ ¸å¿ƒcore**

componentsï¼Œè‡ªå®šä¹‰çš„ç»„ä»¶ï¼Œkeep-alive

global-api

â€‹	assetsï¼Œextendï¼Œindexï¼ˆåœ¨vueä¸ŠæŒ‚è½½ä¸€äº›apiï¼‰ï¼Œminxinï¼Œuse

**instance**ï¼Œvueå®ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œåˆå§‹åŒ–ï¼Œäº‹ä»¶ç­‰

**observer**ï¼Œæ•°æ®æ”¶é›†ä¸è®¢é˜…ï¼ŒåŒå‘ç»‘å®š

â€‹	Object.defineProperty

vdomï¼ŒçœŸå®domä¹Ÿå­˜åœ¨jså¯¹è±¡ï¼Œæ— ç”¨å±æ€§è¿‡å¤š

vueè¿è¡Œæ—¶å…¥å£ï¼š

åˆå§‹åŒ–é˜¶æ®µ

```js
// å®ç°vueåˆå§‹åŒ–å‡½æ•°_init
initMixin(Vue)
	Vue.prototype._init
    // æŠŠç»„ä»¶å®ä¾‹é‡Œé¢ç”¨åˆ°çš„å¸¸ç”¨å±æ€§åˆå§‹åŒ–ï¼Œæ¯”å¦‚$parent/$root/$children
    initLifecycle(vm)
    // çˆ¶ç»„ä»¶ä¸­å®šä¹‰çš„éœ€è¦å­ç»„ä»¶å¤„ç†çš„äº‹ä»¶
    initEvents(vm)
    // $slots $scopedSlotsåˆå§‹åŒ–
    // $createElementå‡½æ•°å£°æ˜
    // $attrså’Œ$listenerså“åº”åŒ–
    initRender(vm)
    callHook(vm, 'beforeCreate')
    // æ³¨å…¥å†…å®¹çš„å“åº”åŒ–
    initInjections(vm) // resolve injections before data/props
    // åˆå§‹åŒ–dataåŒ…æ‹¬æ•°æ®å“åº”åŒ–/props/methods/computed/watchï¼Œ
    initState(vm)
      observe(data, true /* asRootData */)/observe(vm._data = {}, true /* asRootData */)
        new Observer(value) // ç›‘å¬æ•°æ®ï¼Œget/setæ²¡æœ‰æ‰§è¡Œï¼Œæ‰§è¡Œwithæ—¶æ‰§è¡Œ
      initComputed(vm, opts.computed)
      initWatch(vm, opts.watch)
    initProvide(vm) // resolve provide after data/props
    callHook(vm, 'created')
		// æ‰§è¡Œmountæ–¹æ³•
		vm.$mount(vm.$options.el)
// ç»„ä»¶çŠ¶æ€ç›¸å…³apiå¦‚$set,$delete,$watchå®ç°
stateMixin(Vue)
// äº‹ä»¶ç›¸å…³apiå¦‚$on,$emit,$oï¬€,$onceå®ç°
eventsMixin(Vue)
// ç»„ä»¶ç”Ÿå‘½å‘¨æœŸapiå¦‚_update,$forceUpdate,$destroyå®ç° 
lifecycleMixin(Vue)
// å®ç°ç»„ä»¶æ¸²æŸ“å‡½æ•°_render, $nextTick
renderMixin(Vue)
```

åˆ›å»ºå®ä¾‹ä¼šæ‰§è¡Œåˆå§‹åŒ–å‡½æ•°_init()ï¼Œå„ç§å±æ€§çš„åˆå§‹åŒ–ï¼Œæ‰§è¡ŒbeforeCreatedç”Ÿå‘½å‘¨æœŸï¼Œå®ä¾‹ä¸Šå„ç§æ•°æ®çš„åˆå§‹åŒ–ï¼ŒåŒ…æ‹¬æ•°æ®çš„å“åº”åŒ–ï¼Œæ‰§è¡Œcreatedç”Ÿå‘½å‘¨æœŸï¼Œæœ€åæ‰§è¡Œmountæ–¹æ³•

é»˜è®¤çš„mountæ–¹æ³•ï¼šæ‰§è¡ŒbeforeMountç”Ÿå‘½å‘¨æœŸï¼Œ`new Watcher()`ä¼ å…¥ç»„ä»¶æ›´æ–°æ–¹æ³•`updateComponent`ï¼Œæ‰§è¡Œæ—¶åˆå§‹åŒ–èµ‹å€¼æ—¶ä¼šè§¦å‘ä¾èµ–æ”¶é›†ï¼Œè§¦å‘updateComponentç”ŸæˆdomèŠ‚ç‚¹ï¼Œæ‰§è¡Œmountedç”Ÿå‘½å‘¨æœŸ

updateComponentï¼šåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ²¡æœ‰å°±renderæ–°å»ºvnodeï¼Œåˆ›å»ºdomèŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹ï¼Œrenderç”Ÿæˆæ–°çš„èŠ‚ç‚¹ï¼Œä¸ä¸Šä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œdom diffï¼Œæ ¹æ®ç»“æœè¿›è¡Œå®šå‘ä¿®æ”¹

### åŒå‘æ•°æ®ç»‘å®š

```js
Object.defineProperty(obj, 'a', {
	get: fn,
	set: fn
})
```

é‡å†™æ•°æ®çš„æŸä¸€ä¸ªkeyï¼Œä¸èƒ½ç›‘å¬æ–°å¢çš„keyï¼Œå¯ä»¥ç›‘å¬æ•°ç»„ï¼Œä½†æ˜¯è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸï¼Œå› ä¸ºæ•°ç»„æ˜¯è¿ç»­å†…å­˜ï¼Œä¸‹æ ‡å’Œå€¼ä¸æ˜¯ç»‘å®šçš„ï¼Œæ¯”å¦‚åˆ é™¤ç¬¬ä¸€é¡¹ï¼Œæ‰€æœ‰çš„keyéƒ½ä¼šæ”¹å˜ï¼Œä¼šé‡å¤è§¦å‘æ¸²æŸ“

vueé‡å†™æ•°ç»„ä¼šæ”¹å˜ç´¢å¼•çš„ä¸ƒç§æ–¹æ³•ï¼Œæ‰§è¡ŒåŸå§‹æ–¹æ³•ï¼Œç›‘æ§æ–°å¢æ•°æ®ï¼Œæ‰‹åŠ¨è°ƒç”¨è§¦å‘æ¸²æŸ“

ä»£ç ç¼–è¯‘åä¼šç¼–è¯‘æˆæŒ‡ä»¤ï¼Œå¤„ç†æˆwithä»£ç ï¼Œæ‰§è¡Œwithè¿”å›vnodeï¼Œæ­¤æ—¶è·å–æ•°æ®ï¼Œè®°å½•ä¸‹è¿™ä¸ªæŒ‡ä»¤åˆ°depï¼Œè¿™ä¸ªå…³ç³»å°±æ˜¯watcherè´Ÿè´£é€šçŸ¥

ä½¿ç”¨çš„è®¢é˜…å‘å¸ƒæ¨¡å¼ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼æ˜¯è®¢é˜…å‘å¸ƒæ¨¡å¼çš„ä¸€ä¸ªå®ç°ï¼‰

<img src="./Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-05-26 ä¸‹åˆ2.33.47.png" alt="æˆªå±2021-05-26 ä¸‹åˆ2.33.47" style="zoom:50%;" />

æŒ‡ä»¤ï¼ˆä¼šç¼–è¯‘æˆwithä»£ç ï¼‰ï¼Œä½¿ç”¨åŠ¨æ€å±æ€§çš„åœ°æ–¹å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤ï¼Œ**ä¸€ä¸ªæŒ‡ä»¤å¯¹åº”ä¸€ä¸ªwatcherï¼ˆvue1ï¼‰ä¸éœ€è¦diffç›´æ¥å®šå‘ä¿®æ”¹ï¼Œä¸€ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªwatcherï¼ˆvue2ï¼‰**

setter è§¦å‘æ¶ˆæ¯åˆ° Watcherï¼Œwatcherå¸®å¿™å‘Šè¯‰ Directive æ›´æ–°DOMï¼ŒDOMä¸­ä¿®æ”¹äº†æ•°æ®ä¹Ÿä¼šé€šçŸ¥ç»™ Watcherï¼Œwatcher å¸®å¿™ä¿®æ”¹æ•°æ®ã€‚

Depï¼šæ”¶é›†watcherï¼Œé€šçŸ¥watcheræ›´æ–°

- target: watcher

- id: number

- subs: watcher[]ï¼Œæ‰€æœ‰ä¾èµ–
- addSub(sub: Watcher)ï¼Œ`this.subs.push(sub)`
- removeSub(sub: Watcher)
- depend()ï¼Œ`Dep.target.addDep(this) // wathcer.addDep(dep)`
- notify()

Observerï¼šå“åº”å¼æ•°æ®

- value: any
- dep: Dep
- vmCount: number

Watcherï¼šç›‘å¬æ•°æ®ï¼Œæ›´æ–°æ•°æ®

- deps: Array<Dep>ï¼Œä¾èµ–çš„æ•°æ®
- newDeps: Array<Dep>
- depIds: SimpleSet
- newDepIds: SimpleSet;

- addDep(dep: Dep)ï¼Œ`this.newDepIds.add(id); this.newDeps.push(dep); ...dep.addSub(this)` ï¼Ÿï¼Ÿï¼Ÿ
- get()ï¼Œ`pushTarget(this); value = this.getter.call(vm, vm); popTarget(); this.cleanupDeps()`è§¦å‘getï¼Œæ”¶é›†ä¾èµ–ï¼Œnew Watcher()åˆå§‹åŒ–æ—¶ä¼šæ‰§è¡Œ

**Vue**

å°†æ‰€æœ‰æ•°æ®æŒ‚è½½åˆ°vueå®ä¾‹ä¸Š

**observer(data)**ï¼Œåˆ›å»ºå®ä¾‹æ—¶çš„initStateä¸­æ‰§è¡Œ

â€‹	åˆå§‹åŒ–Depç”µè¯æœ¬ï¼ˆ**new Dep()**ï¼‰**ä¸€ä¸ªæ•°æ®å¯¹åº”ä¸€ä¸ªDep**

â€‹	æ•°ç»„åˆ¤æ–­

â€‹	éæ•°ç»„ï¼Œwalk 

â€‹		defineReactiveï¼Œå“åº”å¼æ•°æ®ï¼Œ`Object.defineProperty()`

â€‹			**new Dep()**

â€‹			getï¼šé€šçŸ¥è½½ä½“ï¼ˆwatcherç”µè¯ï¼‰,åˆ¤æ–­`Dep.target`æ ‡å¿—ç¬¬ä¸€æ¬¡è·å–æ•°æ®ï¼Ÿï¼Ÿè®°å½•é€šçŸ¥æ–¹æ³•/æ˜ å°„å…³ç³»`dep.depend()` -> watcherï½œ`watcher.newDeps.push(dep)` & `Dep.subs.push(sub)`ï¼ˆdepç”µè¯æœ¬ï¼‰ï¼Œæ–¹ä¾¿é€šçŸ¥ï¼›è·å–é¡µé¢æ—¶ï¼Œå³æ‰§è¡Œwithè¿”å›vnodeæ—¶è§¦å‘ï¼›æ¯æ¬¡æŒ‡ä»¤æ‰§è¡Œæ—¶è§¦å‘

â€‹			setï¼šé€šçŸ¥`dep.notify()` -> Depï½œéå†subsæ›´æ–°`subs[i].update()` -> watcherï½œåˆ¤æ–­æ‡’åŠ è½½ -> `dirty = true` -> åˆ¤æ–­åŒæ­¥ -> run: `const value = this.get() // å…ˆè·å–æœ€æ–°çš„æ•°æ®; this.cb.call(this.vm, value, oldValue) //æ‰§è¡Œå›è°ƒï¼Œcbå°±æ˜¯domæ›´æ–°çš„renderæ–¹æ³•ï¼Œç›¸å½“äºwith ` -> é»˜è®¤ä¸æ˜¯åŒæ­¥ä¹Ÿä¸æ˜¯æ‡’æ›´æ–°ï¼Œæ‰¹é‡æ›´æ–°schedule -> `queueWatcher(this)` -> run

> æ”¶é›†ï¼šå…·ä½“æ”¶é›†çš„æ˜¯watcher
>
> é€šçŸ¥ï¼šé€šçŸ¥çš„ä¹Ÿæ˜¯watcher

compilerï¼ˆéæºç ï¼Œæ›´ç±»ä¼¼äºvue1ï¼‰

â€‹	åˆ¤æ–­èŠ‚ç‚¹ç±»å‹

   	å…ƒç´ èŠ‚ç‚¹ï¼Œè§£æå±æ€§ï¼Œv-modelå±æ€§æ·»åŠ inputäº‹ä»¶ï¼Œinputäº‹ä»¶è§¦å‘æ—¶ä¿®æ”¹æ•°æ®å€¼

â€‹	**new Watcher()**ï¼Œæºç æ˜¯åœ¨åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸæ—¶åˆ›å»ºçš„

   	Dep.target = this // watcherï¼Œè®°å½•ä¿¡æ¯

   	this.update() // æ‰§è¡Œrenderï¼Œé¦–æ¬¡æ¸²æŸ“ï¼Œè§¦å‘get

â€‹     	this.get() // this.value = this.vm[this.name]ï¼Œè§¦å‘getï¼Œæ”¶é›†ä¾èµ–ï¼ˆä½¿ç”¨äº†æ§åˆ¶åè½¬çš„å†™æ³•ï¼‰ï¼Œæ›´æ–°æ—¶targetä¸ºç©ºä¸ä¼šè§¦å‘ä¾èµ–æ”¶é›†

â€‹     	æ›´æ–°æ•°æ®this.node[this.type] = this.value

   	Dep.target = null

**new Watcher()**ï¼Œmounté˜¶æ®µæ‰§è¡Œ

â€‹	Dep.target = this // watcherï¼Œè®°å½•ä¿¡æ¯

â€‹	æ‰§è¡ŒupdateComponentå‡½æ•°

â€‹		vm.\_update(vm._render(), hydrating) // æ‰§è¡Œrenderï¼Œé¦–æ¬¡æ¸²æŸ“ï¼Œè§¦å‘get

â€‹			_renderï¼šç”Ÿæˆvnodeï¼Œè§¦å‘getï¼Œæ”¶é›†ä¾èµ–ï¼ˆä½¿ç”¨äº†æ§åˆ¶åè½¬çš„å†™æ³•ï¼‰ï¼Œæ›´æ–°æ—¶targetä¸ºç©ºä¸ä¼šè§¦å‘ä¾èµ–æ”¶é›†

â€‹			\_update(vnode: VNode, hydrating?: boolean)ï¼švm.\__patch__(node, vnode)ï¼Œdiffï¼Œç”Ÿæˆdom

â€‹	Dep.target = null

updateæµç¨‹ï¼š

â€‹	åˆ¤æ–­æ²¡æœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„vnode

â€‹	renderç”Ÿæˆæ–°çš„vnode

â€‹	åˆ›å»ºdomèŠ‚ç‚¹

â€‹	æœ‰ä¸Šä¸€ä¸ªèŠ‚ç‚¹

â€‹	renderç”Ÿæˆæ–°çš„èŠ‚ç‚¹

â€‹	diff

â€‹	å®šå‘ä¿®æ”¹

#### **vue2**

ä¸€ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªwatcherï¼Œéœ€è¦dom diffï¼Œéœ€è¦ç»´æŠ¤ä¸€å¥—æ˜ å°„å…³ç³»ï¼Œåº”ç”¨è¿‡å¤§æ—¶å†…å­˜å ç”¨è¿‡é«˜ï¼Œè€Œreactæ²¡æœ‰ç»´æŠ¤è¿™æ ·ä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œï¼Œæ¯æ¬¡æ›´æ–°ä¼šé‡æ–°æ„å»ºfiberï¼ˆjsx -> element -> fiberï¼‰ï¼Œå†è¿›è¡Œfiber diffï¼Œdiffè¾ƒèŠ±è´¹æ—¶é—´ï¼Œå¯ä»¥ä¸­æ–­

### æ‰¹é‡æ›´æ–°

subséå†æ›´æ–°æ—¶ï¼Œæœ‰ä¸‰ç§æ–¹å¼ï¼Œä¸€ä¸ªæ˜¯æ‡’åŠ è½½ï¼Œä¸€ä¸ªæ˜¯åŒæ­¥æ›´æ–°ï¼Œä¸€ä¸ªæ˜¯æ‰¹é‡æ›´æ–°ï¼Œé˜²æ­¢é¢‘ç¹æ›´æ–°

updateä¸­çš„queueWatcherï¼ŒæŠŠæ‰€æœ‰çš„æ›´æ–°æ”¾åˆ°ä¸‹ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡

ç»´æŠ¤ä¸€ä¸ªwatcheré˜Ÿåˆ—ï¼Œå…ˆåˆ¤æ–­watcheræ˜¯å¦å·²ç»å­˜åœ¨ï¼Œä¸å­˜åœ¨æ—¶é€å…¥é˜Ÿåˆ—ï¼Œåˆ¤æ–­æ˜¯å¦ç­‰å¾…ä¸­ï¼Œå¦åˆ™å¾ªç¯åŒæ­¥æˆ–å¼‚æ­¥æ‰§è¡Œwatcherä¸­çš„å›è°ƒæ›´æ–°ï¼Œç±»ä¼¼äºé˜²æŠ–èŠ‚æµï¼Œå†ä¸‹ä¸€æ¬¡æ›´æ–°ä¹‹å‰åªä¼šæœ‰ä¸€ä¸ªwatcherï¼Œåœ¨æ›´æ–°æ—¶æ‰§è¡Œä¸€æ¬¡render

### keep-aliveç®—æ³•

ç¼“å­˜vnode

LRUç®—æ³•ï¼Œç¼“å­˜æœ€æ–°æœ€å¸¸ç”¨çš„

### å…¶ä»–

useï¼šåˆ¤æ–­æ˜¯å¦å‡½æ•°ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œæ‰§è¡Œinstallï¼Œç„¶åæ·»åŠ è¿›æ’ä»¶æ•°ç»„

### vue3

flow -> ts

æ¨¡å—åŒ–ï¼Œvue2å¼•ç”¨æ—¶æ˜¯å®Œæ•´çš„åŒ…ï¼Œvue3åˆ†äº†å•ç‹¬åŠŸèƒ½çš„æ¨¡å—ï¼Œä½¿ç”¨äº†esmoduleç‰¹æ€§ï¼Œmonorepoä»£ç ç®¡ç†ï¼Œåˆ†åŒ…å•ç‹¬åŠŸèƒ½å¼•ç”¨ï¼Œä½¿ç”¨äº†lernaå¤šåŒ…ç®¡ç†å·¥å…·ï¼Œç®¡ç†å¤šä¸ªpackage.json -> æ–¹ä¾¿æºç æ¶æ„ä¸Šæ”¹å˜ï¼Œcomposition api

#### æ•°æ®ç›‘å¬

runtimeé˜¶æ®µ

vue2ï¼šObject.defineProperty --> ä¼šéå†æ‰€æœ‰çš„keyï¼Œé‡å†™æ¯ä¸ªkeyçš„å€¼ï¼Œç›‘å¬ä¸åˆ°æ–°å¢

vue3ï¼š**proxy** --> æ‹¦æˆªï¼Œæ•°ç»„çš„éƒ¨åˆ†æ–¹æ³•è¿˜æ˜¯ä¼šå¤šæ¬¡æ‹¦æˆªï¼Œä¸èƒ½æ‹¦æˆªåˆ°å†…éƒ¨åµŒå¥—å¯¹è±¡ï¼Œåªèƒ½æ‹¦æˆªåˆ°å¤–å±‚ï¼Œæ‡’ä»£ç†

è§£å†³æ•°ç»„

#### ç¼–è¯‘é˜¶æ®µä¼˜åŒ–

ç¼–è¯‘é˜¶æ®µ

vue2æ­£åˆ™åŒ¹é…ï¼Œè´ªå©ªåŒ¹é…ï¼Œé€ æˆå›æº¯ï¼Œé‡å¤è®¡ç®—ï¼Œæ¯”å¦‚si{1, 3}iinåŒ¹é…siiinï¼Œåˆ†æåŠŸèƒ½æœ‰é™ï¼Œä¸èƒ½åšæ›´å¤šçš„ç¼–è¯‘æ—¶ä¼˜åŒ–

vue3çŠ¶æ€æœºï¼šæ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶è¿›è¡Œåˆ†å‰²ï¼Œastï¼Œæ ¹æ®è‡ªèº«è¯­æ³•å’ŒçŠ¶æ€æœºçš„æ¨¡å‹å†™äº†complierï¼Œå¼ºåŒ–äº†æ¨¡ç‰ˆåˆ†æçš„èƒ½åŠ›ï¼Œèƒ½åš**æ›´å¤šçš„ç¼–è¯‘æ—¶ä¼˜åŒ–**

> var a = 1 + 2
>
> åˆ†æï¼š
>
> String var
>
> Space 
>
> String a
>
> ç¬¦å· =
>
> number 1
>
> ...
>
> æœ€ç»ˆåˆ†å‰²ä¸ºï¼Œvarï¼Œ ï¼Œaï¼Œ=ï¼Œ1ï¼Œ+ï¼Œ2ï¼Œï¼ˆtokenï¼‰
>
> æŒ‰ç…§è¯­æ³•ç»“æ„è¿›è¡Œéå†ï¼Œæ„å»ºæŠ½è±¡è¯­æ³•æ ‘astexplorer.net

vue2dom difféœ€è¦é€’å½’diff

vue3ç¼–è¯‘åˆ†ææ—¶ç»™åŠ¨æ€å±æ€§çš„æ ¹å…ƒç´ å¢åŠ dynamicChilren: []è®°å½•åŠ¨æ€èŠ‚ç‚¹ï¼Œå³åœ¨**ç¼–è¯‘é˜¶æ®µæ”¶é›†äº†åŠ¨æ€èŠ‚ç‚¹**ï¼Œç§°ä¸ºblock treeï¼ˆç”±_createBlockç”Ÿæˆï¼‰ï¼Œä½†æ˜¯ä¸ç¨³å®šæ¯”å¦‚v-ifçš„æƒ…å†µï¼Œè¦åˆ†åˆ«å•ç‹¬ä½œä¸ºä¸€ä¸ªblock treeï¼Œè¿˜æ˜¯éœ€è¦dom diffï¼Œè¿˜æœ‰v-forçš„æƒ…å†µä¹Ÿæ˜¯ä¸ç¨³å®šçš„ï¼Œä¸èƒ½æå‡æˆä¸ºblock treeçš„å‡ ç§æƒ…å†µï¼šv-ifï¼Œv-forï¼Œfragment

é™æ€æ ‘æå‡ï¼šæŠŠé™æ€èŠ‚ç‚¹æå‡åˆ°æœ€é¡¶å±‚ä¸éœ€è¦æ¯æ¬¡éƒ½åˆ›å»º

é¢„å­—ç¬¦ä¸²ï¼Œå¤šä¸ªé™æ€èŠ‚ç‚¹ä¼šåˆå¹¶æˆä¸€ä¸ªå­—ç¬¦ä¸²èŠ‚ç‚¹ï¼Œä¸éœ€è¦åˆ›å»ºå¤šä¸ªé™æ€èŠ‚ç‚¹

äº‹ä»¶ç¼“å­˜

keep-aliveæ²¡å˜

æ‰¹å¤„ç†æ²¡å˜

#### æ–‡ä»¶ç»“æ„

packagesï¼ŒåŠŸèƒ½ç‹¬ç«‹

â€‹	compiler-coreï¼Œä¸å¹³å°æ— å…³çš„ç¼–è¯‘å™¨ï¼Œç¼–è¯‘æ¨¡ç‰ˆç­‰

â€‹	compiler-domï¼Œæµè§ˆå™¨è€Œè¨€çš„ç¼–è¯‘å™¨ï¼ŒåŸºäºcompiler-core

â€‹	complier-sfcï¼Œå•æ–‡ä»¶ç¼–è¯‘

â€‹	compiler-ssr

â€‹	**reactivity**ï¼Œruntimeï¼Œæ ¸å¿ƒï¼Œå“åº”å¼å¤„ç†

â€‹	runtime-coreï¼Œä¸å¹³å°æ— å…³çš„è¿è¡Œæ—¶ï¼Œè™šæ‹Ÿdomï¼Œdom diffï¼Œvueç»„ä»¶ç­‰

â€‹	runtime-domï¼Œæµè§ˆå™¨çš„runtimeï¼ŒåŸç”Ÿdom apiï¼ŒåŸç”Ÿdomäº‹ä»¶

â€‹	runtime-testï¼Œæµ‹è¯•

â€‹	server-rendererï¼ŒæœåŠ¡ç«¯æ¸²æŸ“è¿è¡Œæ—¶

â€‹	sfc-playgroundï¼Œåœ¨çº¿demo

â€‹	sharedï¼Œå…¬å…±

â€‹	template-explorerï¼Œåœ¨çº¿ç¼–è¯‘ï¼Œæ²¡æœ‰withï¼Œruntimeæ—¶è¿˜æ˜¯æœ‰with

#### **åŒå‘æ•°æ®ç»‘å®š**

##### **reactive**

è¿”å›ä¸€ä¸ªè¢«ç›‘å¬çš„æ•°æ®ï¼Œproxy

â€‹	åˆ¤æ–­æ˜¯å¦åªè¯»å¤„ç†è¿‡

â€‹	createReactiveObject(  target: Target, isReadonly: boolean, baseHandlers: ProxyHandler<any>, collectionHandlers: ProxyHandler<any>)åˆ›å»ºå“åº”å¼æ•°æ®ï¼Œè¿”å›proxy

â€‹		åˆ¤æ–­æ˜¯å¦éå¯¹è±¡ï¼Œå“åº”å¼æˆ–åªè¯»ï¼Œæ˜¯å¦å·²ç»å­˜åœ¨å“åº”å¼æ•°æ®ï¼ˆç»´æŠ¤äº†ä¸€ä¸ªproxyMapï¼‰ï¼Œæ˜¯å¦å¯ä»¥ä»£ç†ï¼ˆåªæœ‰ç‰¹å®šçš„ç±»å‹å¯ä»¥ä»£ç†ï¼‰ï¼Œç›´æ¥è¿”å›æˆ–è¿”å›å·²æœ‰çš„å“åº”å¼

â€‹		åˆ›å»ºä»£ç†ï¼Œä¸åŒç±»å‹æ•°æ®ä½¿ç”¨ä¸åŒçš„å¤„ç†å‡½æ•°

â€‹			collectionHandlers

â€‹			baseHandlersï¼ŒåŒ…æ‹¬get, set, deleteProperty, has, ownKeys

â€‹				**get**ï¼Œä½¿ç”¨æ—¶è§¦å‘ï¼Œå¯¹ç‰¹æ®Škeyçš„å¤„ç†ï¼Œkeyæ˜¯symbolç›´æ¥è¿”å›ï¼Œåˆ¤æ–­æ•°ç»„é‡å†™ï¼Œåˆ¤æ–­æ˜¯å¦åªè¯»ï¼Œè¿›è¡Œtrackï¼Œå¦‚æœæ˜¯å¯¹è±¡ç»§ç»­reactiveï¼Œå³åªæœ‰åœ¨ä½¿ç”¨æ—¶æ‰ä¼šåšä»£ç†ï¼Œæ²¡æœ‰ä½¿ç”¨æ—¶æ²¡æœ‰ä»£ç† -> **æ‡’ä»£ç†**ï¼Œä½¿ç”¨æ—¶æ‰ä¼šä»£ç†ï¼Œä¸ä¼šä¸€å¼€å§‹å°±æ·±åº¦é€’å½’ã€‚è¿”å›å€¼

â€‹					**track**ï¼šåˆ¤æ–­æ˜¯å¦å¼€å¯ä¾èµ–æ”¶é›†ï¼ŒtargetMapå…¨å±€å˜é‡ï¼Œåˆ¤æ–­å½“å‰çš„targetæ˜¯å¦å­˜åœ¨depsMapï¼Œæ²¡æœ‰æ—¶åˆå§‹åŒ–mapï¼Œåˆ¤æ–­å½“å‰keyæ˜¯å¦å·²ç»æœ‰depsï¼Œæ²¡æœ‰æ—¶åˆå§‹åŒ–setï¼Œæœ‰æ·»åŠ activeEffectåˆ°deps

â€‹				**set**ï¼Œè·å–åˆ°åŸå§‹å€¼ï¼Œåˆ¤æ–­æ˜¯æ–°å¢è¿˜æ˜¯ä¿®æ”¹ï¼Œåå°„ä¿®æ”¹åŸå§‹å€¼ï¼Œæ´¾å‘é€šçŸ¥triggerï¼ŒADD/SETï¼Œè¿”å›æ–°å€¼

â€‹					**trigger**ï¼šè·å–åˆ°åŸå§‹æ•°æ®çš„æ‰€æœ‰ä¾èµ–depsMapï¼Œæ ¹æ®å½“å‰çš„æ“ä½œåˆ›å»ºä¸€ä¸ªæ–°çš„é›†åˆï¼Œéå†æ‰§è¡Œé›†åˆä¸­çš„effectï¼Œåˆ¤æ–­scheduleï¼Œæœ‰çš„è¯æ‰§è¡Œscheduleï¼Œè®©scheduleè°ƒåº¦effectçš„æ‰§è¡Œ

â€‹		æ·»åŠ åˆ°proxyMap

##### **effect**

ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ä¼ é€’è¿›æ¥çš„å‡½æ•°ï¼Œè¿”å›effectå‡½æ•°ï¼Œé¦–æ¬¡æ¸²æŸ“renderï¼Œæ”¶é›†ä¾èµ–ï¼Œç›‘å¬ä½¿ç”¨åˆ°çš„å“åº”å¼æ•°æ®ï¼Œå˜åŠ¨å°±ä¼šæ‰§è¡Œï¼Œé‡æ–°æ¸²æŸ“

â€‹	åˆ¤æ–­æ˜¯å¦effectFn

â€‹	createReactiveEffectï¼Œä¼ å…¥fnï¼Œåˆ›å»ºeffectå‡½æ•°

â€‹		è¿”å›effectå‡½æ•°

â€‹		æ³¨å…¥å±æ€§ï¼ŒrawåŸå§‹å‡½æ•°ï¼Œdepsä¾èµ–ï¼Œactiveæ¿€æ´»çŠ¶æ€ï¼Œé»˜è®¤æ¿€æ´»

â€‹	ä¸æ˜¯æ‡’æ›´æ–°æ—¶ï¼Œæ‰§è¡Œeffect()ï¼š

â€‹		åˆ¤æ–­activeä¸å¤„äºæ¿€æ´»çŠ¶æ€æ—¶ï¼Œåˆ¤æ–­æ²¡æœ‰è°ƒåº¦æ—¶ç›´æ¥æ‰§è¡Œfn()å¹¶è¿”å›ï¼Œå¦åˆ™åˆ¤æ–­æ˜¯å¦å·²ç»åœ¨effectStackæ ˆä¸­å­˜åœ¨ï¼Œå¦ï¼šæ¸…ç©ºä¾èµ–ï¼Œå¼€å¯ä¾èµ–æ”¶é›†ï¼ˆæ·»åŠ åˆ°trackStackï¼ŒshouldTrack=trueï¼‰ï¼Œä¿å­˜effectåˆ°effectStackï¼Œè®¾ç½®æ¿€æ´»activeEffectï¼Œæ‰§è¡Œfn()ï¼Œä¼šè§¦å‘get()ï¼Œè§¦å‘track()ï¼Œæ„å»ºå…¨å±€æ˜ å°„

â€‹		popå‡ºæ ˆï¼ŒactiveEffectç½®ä¸ºæ ˆé¡¶

â€‹		é‡ç½®ä¾èµ–æ”¶é›†ï¼ˆ`const last = trackStack.pop();shouldTrack = last === undefined ? true : last`ï¼‰

â€‹	è¿”å›effectå‡½æ•°

refï¼Œç›‘å¬åŸºæœ¬æ•°æ®

â€‹	new RefImpl()

â€‹		è®¾ç½®getå’Œsetç”¨æ¥æ”¶é›†ä¾èµ–å’Œè§¦å‘æ›´æ–°

**schedule**ï¼šå¯ä»¥å†³å®šä»€ä¹ˆæ—¶å€™æ‰§è¡ŒeffectFn

##### computed

æ¥æ”¶å‡½æ•°æˆ–è€…optionï¼Œå‡½æ•°å°±æ˜¯getterï¼Œå¯¹è±¡å°±æ˜¯getterå’Œsetter

â€‹	new ComputedRefImpl()

â€‹		åŸºäºeffectï¼Œä¼ å…¥getterï¼Œè¿”å›effectï¼ˆè®¾ç½®äº†scheduleï¼‰ï¼Œeffectè®¾ç½®æ‡’æ›´æ–°ï¼ˆä¸ä¼šç«‹å³æ‰§è¡ŒeffectFnï¼‰ï¼Œè®¾ç½®scheduleï¼šåˆ¤æ–­ä¸æ˜¯è„æ•°æ®æ—¶ï¼ˆå·²ç»è·å–è¿‡æ•°æ®ï¼‰ï¼Œdirty=trueï¼Œæ‰§è¡Œtriggeræ›´æ–°

â€‹		get

â€‹			åˆ¤æ–­dirtyä¸ºçœŸæ—¶æ‰§è¡Œeffectè·å–å€¼ï¼Œç¬¬ä¸€æ¬¡è·å–æ—¶æ‰§è¡Œäº†effectFnï¼Œè§¦å‘getå’Œtrackï¼Œåç»­ä¾èµ–é¡¹å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘schedule

â€‹			dirty=falseï¼›

â€‹			æ”¶é›†ä¾èµ–ï¼›è¿”å›å€¼

â€‹		setï¼Œæ‰§è¡Œä¼ å…¥çš„setter

##### **watchEffect**

åŸºäºeffectå’Œscheduleç¼–è¯‘é˜¶æ®µ

#### æµç¨‹

```js
import { createApp } from 'vue'
import App from './app'

/**
    NOTE: æ•´ä¸ªappæŒ‚è½½çš„æ‰§è¡Œæµç¨‹

    STEP: 1.æ•´ä¸ªåº”ç”¨è°ƒç”¨createAppæ–¹æ³•ç”Ÿæˆå®ä¾‹ï¼Œç„¶åè°ƒç”¨mountæ–¹æ³•ï¼Œå¯¹äºæ•´ä¸ªAppå®ä¾‹çš„åˆ›å»ºï¼Œå°±æ˜¯ä¸€ä¸ªå¯¹åº”æ•°æ®ä¸æ–¹æ³•çš„å¯¹è±¡åˆ›å»ºï¼Œ
    è°ƒç”¨mountçš„é˜¶æ®µï¼Œé¦–å…ˆæ ¹æ®å…¥å£ç»„ä»¶<App> åˆ›å»ºVNodeï¼Œ ç„¶åè§¦å‘renderå‡½æ•°ï¼Œæ•´ä¸ªrenderçš„é˜¶æ®µï¼Œå°±æ˜¯Patchæ‰€æœ‰Vnodeçš„é˜¶æ®µï¼Œå½“ä¸­åˆ†ä¸ºåˆå§‹åŒ–æŒ‚è½½ä¸æ›´æ–°ç»„ä»¶çš„é€»è¾‘

    STEP: 2.å¯¹äºå†…éƒ¨patchçš„é˜¶æ®µï¼Œä¼šå¯¹ä¸åŒèŠ‚ç‚¹ç±»å‹æœ‰ä¸åŒçš„å¤„ç†é€»è¾‘ï¼Œä¸»è¦æ˜¯ç»„ä»¶ä¸elementï¼Œç»„ä»¶å°±ç»§ç»­æ‰§è¡Œåˆ›å»ºã€æŒ‚è½½ç­‰ç­‰
  */

const app = createApp(App)
app.mount('#app')
```

createApp

â€‹	åˆ›å»ºappå®ä¾‹

â€‹		createRenderï¼Œåˆ¤æ–­æ¸²æŸ“å™¨ï¼Œä¸åŒç«¯åˆ›å»ºä¸åŒçš„renderï¼Œæ¯”å¦‚æµè§ˆå™¨/å°ç¨‹åºï¼Œæœ‰ä¸åŒçš„é…ç½®é¡¹renderOptionï¼Œè¿”å›renderå’ŒcreateApp

â€‹			patchï¼Œæ•´ä¸ªpatchçš„è¿‡ç¨‹å…¶å®å°±æ˜¯å¯¹åº”çš„VNodeæ·±åº¦ä¼˜å…ˆéå†çš„è¿‡ç¨‹ï¼›æ¥æ„é€ ä¸€é¢—å®Œæ•´çš„æ ‘

â€‹			render

â€‹				åˆ¤æ–­vnode=nullï¼Œè¿›å…¥å¸è½½æµç¨‹

â€‹				å¦åˆ™æ‰§è¡Œpatchï¼Œåˆ›å»ºæˆ–è€…æ›´æ–°ç»„ä»¶

â€‹					åˆæ¬¡æŒ‚è½½ï¼šprocessComponent - mountComponent

â€‹						createComponentInstanceåˆ›å»ºç»„ä»¶å®ä¾‹ï¼Œç»´æŠ¤äº†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼ŒçŠ¶æ€ï¼Œä¸Šä¸‹æ–‡ç­‰

â€‹						setupComponentè®¾ç½®ç»„ä»¶å®ä¾‹ï¼ŒsetupStatefulComponent

â€‹							åˆ›å»ºç¼“å­˜ï¼Œåˆ›å»ºä¸Šä¸‹æ–‡ä»£ç†ï¼Œæ‰§è¡Œsetupï¼Œæ‰§è¡Œæ—¶ä¼šæ”¶é›†ä¾èµ–ï¼Œå¤„ç†setupResultä¸å®ä¾‹åšç»“åˆï¼Œé‡åˆ°refæ•°æ®ç›´æ¥è¿”å›valueï¼ŒfinishComponentSetupï¼šæ²¡æœ‰renderæ—¶åœ¨çº¿ç¼–è¯‘æ„å»ºrenderï¼ŒæŒ‚è½½renderï¼Œå…¼å®¹optionså†™æ³•ï¼ˆåˆå¹¶æ•°æ®ï¼‰

â€‹						setupRenderEffectåˆ›å»ºå“åº”å¼çš„å‰¯ä½œç”¨æ¸²æŸ“å‡½æ•°ï¼Œå½“ç»„ä»¶å†…éƒ¨æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œä¼šé‡æ–°æ‰§è¡ŒcomponentEffectæ–¹æ³•å†…éƒ¨é€»è¾‘ï¼Œå¹¶ä¸”æŒ‚è½½åˆ°ç»„ä»¶å®ä¾‹çš„updateæ–¹æ³•ä¸Šï¼Œåç»­æ›´æ–°æ‰§è¡Œ

â€‹							é¦–æ¬¡æ¸²æŸ“ï¼šæ‰§è¡ŒbeforeMountedï¼Œç”ŸæˆsubTreeï¼Œä½¿ç”¨patchå°†subTreeæ¸²æŸ“åˆ°containerï¼Œpatchæ—¶åˆ›å»ºvnodeï¼Œæ‰§è¡Œç”Ÿå‘½å‘¨æœŸmounted

â€‹			createApp=createAppAPI(render, ..)ï¼Œä¼ å…¥renderï¼Œè¿”å›createAppæ–¹æ³•

â€‹				createAppæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œæ ¹ç»„ä»¶çš„å¯¹è±¡ä¸propsï¼Œé»˜è®¤ä¸ºnull

â€‹				æ„å»ºappå®ä¾‹ï¼ŒåŒ…å«useï¼Œmixinï¼Œcomponentï¼Œdirectiveï¼Œmountï¼Œunmountï¼Œprovideç­‰æ–¹æ³•

â€‹					mountï¼šåˆ¤æ–­è¿˜æ²¡æœ‰æŒ‚è½½ï¼Œåˆ›å»ºvnodeï¼Œè§¦å‘**render**ï¼Œrenderä¸­æ‰§è¡Œpatch

â€‹				è¿”å›app

â€‹	é‡å†™mountæ–¹æ³•

â€‹		åˆ¤æ–­æ˜¯å¦ä¼ å…¥renderå’Œtemplateæ–¹æ³•

ç”Ÿå‘½å‘¨æœŸ

åŠ¨æ€æ›´æ–°/å…¨éƒ¨diff

æµç¨‹ï¼š

1. å¤„ç†åŸºæœ¬render 

2. åˆ›å»ºApp å®ä¾‹ 

3. App.mount  åˆ›å»ºrootcomponent 

4. compoent  ==> åˆ›å»ºcompoent instance 

5. patch compoent | Element | Text

6. mount componet 

7. componet ä»£ç† data option props 

8. componet æ‰§è¡Œsetup ==> è¿”å›render \ proxy(ref) \ optionså…¼å®¹

9. componet Effect ==> æ•°æ® | æ‰§è¡Œrender | patch

## vue/react ssr

å‚è€ƒä»£ç ï¼šdemo-collection

## react

reduxåŸºäºcontextå®ç°

æºç å­¦ä¹ ï¼š

- ç†Ÿæ‚‰api

- debugç›¸å…³api

- æŠ“å¤§æ”¾å°

- æŸ¥çœ‹ç›¸å…³issue

- demoå¤ç°

### react16å‰æ¶æ„

ä¸¤éƒ¨åˆ†

reconcilerï¼Œæ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ï¼Œä½¿ç”¨é€’å½’çš„æ–¹å¼å’Œjsè‡ªèº«çš„å‡½æ•°è°ƒç”¨æ ˆï¼Œé€’å½’ä¸å¥½æ‰“æ–­ï¼Œå¦‚æœå±‚çº§å¾ˆæ·±ï¼Œä¼šä¸€ç›´å ç”¨ä¸»çº¿ç¨‹

rendererï¼Œé€šè¿‡å˜åŒ–çš„ç»„ä»¶åšdom-diffï¼Œæ¸²æŸ“æœ€ç»ˆé¡µé¢

ç¼ºç‚¹ï¼š

é•¿ä»»åŠ¡ä¼šé€ æˆé˜»å¡äº¤äº’ï¼Œä¼šå¡é¡¿

### react16 fiberæ¶æ„

è§£å†³15çš„é•¿ä»»åŠ¡é˜»å¡é—®é¢˜ï¼Œå¢åŠ äº†schedulerè°ƒåº¦å™¨æ¨¡å—ï¼Œè‡ªå·±å®ç°äº†ç»„ä»¶è°ƒç”¨æ ˆï¼Œä»¥é“¾è¡¨çš„å½¢å¼éå†fiber treeï¼Œfiberå…¶å®æŒ‡ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ç§åŸºäºæµè§ˆå™¨çš„å•çº¿ç¨‹è°ƒåº¦ç®—æ³•

ç”¨å¾ªç¯ä»£æ›¿é€’å½’

ä½¿ç”¨requestldeCallbackå®ç°åˆ†ç‰‡

1. æ‰§è¡Œå¼‚æ­¥çš„è°ƒåº¦ä»»åŠ¡ä¼šåœ¨å®ä»»åŠ¡ä¸­æ‰§è¡Œï¼Œä¿è¯è®©ç”¨æˆ·ä¸ä¼šå¤±å»å“åº”ï¼Œä¹‹å‰ä¸€ç›´åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ‰€æœ‰ä»»åŠ¡ï¼Œé€ æˆé˜»å¡

2. åŒæ—¶å¯¹æ‰€æœ‰çš„æ›´æ–°åšäº†ä¸€ä¸ªä¼˜å…ˆçº§çš„ç»‘å®šï¼Œæ§åˆ¶å“ªäº›äººç‰©å¯ä»¥å…ˆè¿›å…¥reconcilerï¼Œå¯ä»¥ä¸­æ–­ä½ä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œå…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„æ›´æ–°ï¼ˆschedularæ¨¡å—ï¼‰

**fiber treeï¼ŒåŒå‘é“¾è¡¨ç»“æ„ï¼Œä¹‹å‰æ˜¯æ•°ç»„ç»“æ„ï¼Œå› ä¸ºä¸­æ–­ï¼Œæ¢å¤çš„æ€§èƒ½ï¼Œåªè¦ä¿å­˜é“¾è¡¨å¤´**

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-01 ä¸‹åˆ6.27.18.png" alt="æˆªå±2021-06-01 ä¸‹åˆ6.27.18" style="zoom:40%;" />

é€šè¿‡expirationTimeçš„æ¯”è¾ƒç¡®å®šä¼˜å…ˆçº§ï¼Œå–å†³äºä»»åŠ¡ä¼˜å…ˆçº§ï¼ˆå›ºå®šçš„ï¼Œä¸åŒä¼˜å…ˆçº§å¢åŠ ä¸åŒçš„åç§»é‡ï¼‰+currentTimeï¼ˆé¿å…ä¸€ç›´é˜»å¡ï¼‰ï¼Œå°äºå½“å‰æ—¶é—´æ—¶ä¼šç«‹å³æ‰§è¡Œ

ä¼˜å…ˆçº§ç›¸åŒï¼Œæ‰¹å¤„ç†

### react17æ‰©å±•

### lanes

expirationtimeçš„ä¸è¶³ï¼Œåœ¨å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯å¤Ÿç”¨çš„ï¼Œä½†æ˜¯suspenceï¼ˆIOï¼‰å‡ºç°åï¼Œé«˜ä¼˜å…ˆçº§çš„IOä»»åŠ¡ä¼šé˜»å¡ä½ä¼˜å…ˆçº§çš„cpuä»»åŠ¡

> reactçš„IOä»»åŠ¡æ˜¯suspenceæœºåˆ¶ç›¸å…³çš„ä»»åŠ¡ï¼Œå…¶ä»–éƒ½æ˜¯cpuä»»åŠ¡

suspenceä¼šç­‰å¾…æ¥å£è¿”å›åå†æ‰§è¡Œåç»­æ“ä½œï¼Œæ˜¯å¼‚æ­¥çš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„IOä»»åŠ¡å’Œä½ä¼˜å…ˆçº§çš„cpuä»»åŠ¡ï¼Œä½ä¼˜å…ˆçº§ä¼šä¸€ç›´ç­‰å¾…é«˜ä¼˜å…ˆçº§çš„IOå®Œæˆåæ‰§è¡Œï¼Œå¯¼è‡´é¡µé¢å¡é¡¿

ä½¿ç”¨lanesä»£æ›¿expirationTimeï¼Œå…¼å®¹expirationTimeï¼Œ

**ä¼˜å…ˆçº§å’Œæ‰¹å¤„ç†åˆ†ç¦»**

laneè¡¨ç¤ºä¼˜å…ˆçº§

lanesè¡¨ç¤ºæ‰¹å¤„ç†å¤šä¸ªä¼˜å…ˆçº§

é€šè¿‡äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œè¶Šå¾€åä¼˜å…ˆçº§è¶Šå¤§ï¼Œä¸€å…±31ä½

æ¯å‘èµ·ä¸€æ¬¡æ›´æ–°ï¼š

reactè®¾è®¡ä¸€ä¸ªä¼˜å…ˆçº§

æ ¹æ®ä¼˜å…ˆçº§ï¼Œå ç”¨ä¸€ä¸ªä½ç½®ï¼Œ000000000000001ï¼ˆé«˜ä¼˜å…ˆçº§çš„IOå’Œä½ä¼˜å…ˆçº§çš„cpuï¼Œæœ€ç»ˆä¸€èµ·æ‰§è¡Œï¼ŒexpirationTimeç›¸åŒæ—¶æ‰ä¼šæ‰¹å¤„ç†ï¼‰

å¦‚æœæœ‰æ–°çš„æ›´æ–°å ç”¨å‰©ä½™çš„ä½ç½®

æœ€ç»ˆä¼šè¿™ä¸ªlanesåŒºé—´çš„æ‰€æœ‰æ›´æ–°ä¸€èµ·å¤„ç†

wiplanesè¡¨ç¤ºå½“å‰å¤„ç†çš„å“ªäº›ä¼˜å…ˆçº§

### Scheduler

è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œå†³å®šå“ªäº›ä»»åŠ¡å…ˆè¿›å…¥Reconciler

ä¼˜å…ˆçº§ï¼š

ç”Ÿå‘½å‘¨æœŸæ–¹æ³•-åŒæ­¥

å—æ§çš„ç”¨æˆ·è¾“å…¥-åŒæ­¥

äº¤äº’äº‹ä»¶-é«˜

å…¶ä»–ï¼Œæ¯”å¦‚æ•°æ®è¯·æ±‚-ä½

> å¯ä»¥ä¿®æ”¹ä¼˜å…ˆçº§ï¼ŒReactDOM.unstable_runWithPriority(ä¼˜å…ˆçº§, () => {...})

#### fiberç»“æ„

å±æ€§ï¼š

fiber treeé‡è¦å±æ€§returnï¼Œchildï¼Œsibling

keyï¼Œæ ‡å¿—å”¯ä¸€æ€§ï¼Œç”¨æ¥å¤ç”¨èŠ‚ç‚¹ï¼Œæœ‰ä¸€äº›ç›´æ¥å¤ç”¨ï¼Œæœ‰ä¸€äº›éœ€è¦æ›¿æ¢returnï¼Œchildï¼Œsiblingå±æ€§

stateNodeï¼Œå¯¹åº”çš„çœŸå®èŠ‚ç‚¹ï¼Œshedularå’Œreconcileré˜¶æ®µæ˜¯å¯ä»¥ä¸­æ–­ï¼Œcommitæ“ä½œdomä¸èƒ½è¢«ä¸­æ–­å¹¶ä¸”å°½å¯èƒ½å¿«ï¼Œæ‰€ä»¥åœ¨reconcileré˜¶æ®µå°±ä¼šå°†stateNodeè®¡ç®—å‡ºæ¥ï¼Œcommitæ—¶ç›´æ¥æ›¿æ¢

pendingPropsï¼Œæœ¬æ¬¡æ›´æ–°çš„props

memoizePropsï¼Œä¸Šæ¬¡çš„props

memoizeStateï¼Œå­˜æ”¾hooks

flagsï¼Œæ ‡è®°æ›´æ–°ç±»å‹ï¼Œåˆ é™¤ï¼Œæ–°å¢ï¼Œæ›´æ”¹å±æ€§

lanesï¼Œhttps://github.com/facebook/react/pull/18796

alternateï¼ŒæŒ‡å‘ä¸Šä¸€æ¬¡æ„å»ºçš„fiberé•œåƒ

##### fiber tree

fiberèŠ‚ç‚¹ä¸æ˜¯æŒ‰ç»„ä»¶ä¸ºå•ä½ï¼Œä»¥å…ƒç´ ä¸ºå•ä½

fiberä¸fiberä¹‹é—´ä»¥é“¾è¡¨çš„æ–¹å¼è¿æ¥ï¼Œæ–¹ä¾¿ä¸­æ–­

##### è°ƒåº¦é€»è¾‘

æ ¹æ®ä¼˜å…ˆçº§**åŒºåˆ†åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡**ï¼ŒåŒæ­¥ä»»åŠ¡å¹¶ä¸”å¤„äºunBatchUpdateé˜¶æ®µç«‹å³æ‰§è¡Œåœ¨ä¸»çº¿ç¨‹ï¼Œæœ€å¿«æ¸²æŸ“ï¼Œç›´æ¥æ‰§è¡ŒperformSyncWorkOnRootï¼ˆReactDOM.render() => unBatchUpdateä¸»çº¿ç¨‹æ‰§è¡Œï¼Œå°½å¿«æ¸²æŸ“ï¼‰

å…·ä½“ä»£ç ï¼šscheduleUpdateOnFiber

> è·å–ä¼˜å…ˆçº§
>
> åˆ¤æ–­æ˜¯åŒæ­¥ä¼˜å…ˆçº§ï¼ˆlane === SyncLaneï¼‰å¹¶ä¸”å¤„äºunbatchUpdateé˜¶æ®µï¼ˆ(executionContext & LegacyUnbatchedContext) !== NoContext && (executionContext & (RenderContext | CommitContext)) === NoContext 
>
> // å·²ç»è°ƒç”¨è¿‡unBatchUpdateï¼Œä¸»çº¿ç¨‹ç«‹åˆ»æ‰§è¡Œï¼ŒReactDOM.render(ï¼‰ä¸­ä¼šæ‰§è¡ŒunBatchUpdateï¼Œ æ‰§è¡Œ unBatchUpdate å‡½æ•°ä½“å‰ä¼š executionContext = LegacyUnbatchedContext
>
> ç›´æ¥æ‰§è¡ŒperformSyncWorkOnRoot

å¼‚æ­¥ä»»åŠ¡èµ°schedulerå®ä»»åŠ¡æ‰§è¡Œ

å…·ä½“ä»£ç ï¼šensureRootIsScheduledï¼ˆåŒ…å«å¼‚æ­¥è°ƒåº¦å’Œä¸­æ–­ï¼‰

> åˆ¤æ–­æ˜¯å¦å¯ä»¥å¤ç”¨
>
> æ¯”å¦‚å¤šä¸ªsetStateåŒæ—¶æ‰§è¡Œï¼Œä¸ä¼šå¤šæ¬¡æ‰§è¡Œï¼Œä¼˜å…ˆçº§ç›¸åŒå¹¶ä¸”æ—¶é—´æ¥è¿‘ï¼Œä¼šç›´æ¥å¤ç”¨ç¬¬ä¸€ä¸ªä»»åŠ¡ä¸ä¼šæ–°å»ºscheduleCallbackã€‚
>
> ç¬¬ä¸€æ¬¡root.callbackNodeä¸å­˜åœ¨æ—¶æ–°å»ºnewCallbackNode = scheduleCallback(...)ï¼Œroot.callbackNode = newCallbackNodeï¼Œç¬¬äºŒæ¬¡åˆ¤æ–­root.callbackNodeå­˜åœ¨ï¼Œå†åˆ¤æ–­ä¼˜å…ˆçº§æ˜¯å¦ä¸€æ ·ï¼Œä¸€æ ·å°±ç›´æ¥returnå¤ç”¨å½“å‰çš„root.callbackNodeï¼Œä¼˜å…ˆçº§ä¸ä¸€æ ·ï¼Œcancelæ‰é‡æ–°å‘èµ·ä¸€ä¸ª 

è®¡ç®—å¾—åˆ° expirationTime = startTime + timeoutï¼ˆä¸åŒä¼˜å…ˆçº§æ—¶é—´é—´éš”ï¼Œè¶ŠçŸ­ä¼˜å…ˆçº§è¶Šå¤§ï¼‰ï¼ŒstartTime = currentTime + delay

å¯¹æ¯” startTime å’Œ currentTimeï¼Œå°†ä»»åŠ¡åˆ†ä¸ºåŠæ—¶ä»»åŠ¡å’Œå»¶æ—¶ä»»åŠ¡

> startTime > currentTime - timerQueue å»¶æ—¶
>
> startTime < currentTime - taskQueue åŠæ—¶

åŠæ—¶ä»»åŠ¡ç«‹åˆ»è¿›å…¥è°ƒåº¦ï¼Œåœ¨å®ä»»åŠ¡ä¸­æ‰§è¡Œ

> æ¯ä¸€æ‰¹ä»»åŠ¡æ‰§è¡Œåœ¨ä¸åŒçš„å®ä»»åŠ¡ä¸­ï¼Œåœ¨MessageChannelï¼ˆæ²¡æœ‰ç”¨setTimeoutï¼Œä¸å‡†ï¼ŒMessageChannelæ—©ï¼‰å®ä»»åŠ¡ä¸­æ‰§è¡Œè°ƒåº¦é€»è¾‘ï¼Œä¿è¯ä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´ä¸æ˜¯è¿ç»­æ‰§è¡Œï¼Œä¸é˜»å¡ç”¨æˆ·äº¤äº’

```js
const channel = new MessageChannel();
const port = channel.port2; channel.port1.onmessage = performWorkUntilDeadline;

requestHostCallback = function(callback) {
  scheduledHostCallback = callback;
 	if (!isMessageLoopRunning) {
    isMessageLoopRunning = true;
    // åœ¨å®ä»»åŠ¡ä¸­æ‰§è¡Œ performWorkUntilDeadline();
    // performWorkUntilDeadline ä¼šè°ƒåº¦æ‰§è¡Œå‰é¢ scheduleCallback ä¼ å…¥çš„ performConcurrentWorkOnRoot.bind(null, root)
    port.postMessage(null);
    // ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œ performWorkUntilDeadline(); 
    // setTimeout(() => {
    //	è¿›å…¥å®ä»»åŠ¡
    // }, 0)
	}
};
```

å»¶æ—¶ä»»åŠ¡ç­‰åˆ°currentTime >= expirationTimeæ—¶è¿›å…¥è°ƒåº¦ï¼Œæ¯æ¬¡è°ƒåº¦åŠæ—¶ä»»åŠ¡æ—¶éƒ½ä¼šæ‰§è¡ŒadvanceTimeråˆ¤æ–­å»¶æ—¶ä»»åŠ¡æ˜¯å¦åˆ°æ—¶é—´ï¼Œä»timeQueueåˆ°taskQueue

> éå†timerQueueåˆ¤æ–­æ—¶é—´ï¼Œä»timeQueueåˆ°taskQueue
>
> performConcurrentWorkOnRootåªä¼šæ‰§è¡ŒtaskQueueçš„ä»»åŠ¡

![æˆªå±2021-06-02 ä¸Šåˆ8.54.48](/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-02 ä¸Šåˆ8.54.48.png)

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-02 ä¸Šåˆ8.55.34.png" alt="æˆªå±2021-06-02 ä¸Šåˆ8.54.48" style="zoom:50%;" />

### Reconciler

è´Ÿè´£æ„å»ºfiber treeï¼Œæ‰¾å‡ºå˜åŒ–ç»„ä»¶ï¼Œæ ‡è®°ç»„ä»¶å˜åŒ–

> react fiber çš„æ ¸å¿ƒåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ
>
> 
>
> fiber æ¶æ„åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†
>
> schedulerè°ƒåº¦ï¼Œé€šè¿‡ä»»åŠ¡çš„ä¼˜å…ˆçº§è°ƒåº¦ä»»åŠ¡è¿›å…¥åé¢çš„æ„å»ºæµç¨‹
>
> â€‹	åŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡
>
> â€‹		åŒæ­¥ä»»åŠ¡unbatchedUpdateï¼ˆReactDom.renderï¼‰
>
> â€‹		å¼‚æ­¥ä»»åŠ¡setStateï¼Œèµ°MessageChannelè°ƒåº¦ä¼˜å…ˆçº§
>
> â€‹			å¤šä¸ªsetStateçš„æ‰¹å¤„ç†é—®é¢˜ï¼Œlanesä¸€è‡´å¤ç”¨äº†åŒä¸€ä¸ªï¼ˆreact17ï¼‰
>
> â€‹			MessageChannelå’ŒsetTimeout
>
> â€‹			ä¸ºä»€ä¹ˆä¸é‡‡ç”¨å¾®ä»»åŠ¡ï¼Ÿ-å¾®ä»»åŠ¡å¤šäº†ä¹Ÿæ˜¯ä¼šå¡æ­»é¡µé¢çš„ï¼Œå®ä»»åŠ¡ä¸ä¼š
>
> â€‹		å¼‚æ­¥ä»»åŠ¡èƒ½ä¸èƒ½åŒæ­¥ï¼Ÿ-èƒ½ï¼Œç”¨unbatchedUpdateåŒ…è£¹èµ·æ¥unbatchedUpdate(() => {this.setState({})})
>
> reconcileråè°ƒå™¨ï¼Œæ„å»º fiber tree åš dom diffï¼Œç»™å˜æ›´çš„ fiber æ‰“æ ‡è®°ï¼Œæ–¹ä¾¿å¤„ç†
>
> â€‹	æ„å»ºfiber treeçš„æµç¨‹ï¼š
>
> â€‹		- ä»ä¸Šåˆ°ä¸‹ï¼Œåˆ›å»ºfiberï¼Œdiffï¼Œç”Ÿå‘½å‘¨æœŸ
>
> â€‹		- ä»ä¸‹åˆ°ä¸Šï¼Œåˆ›å»ºdomå…ƒç´ ï¼ŒæŠŠeffectç»™åˆ°æ ¹èŠ‚ç‚¹
>
> â€‹	å¯ä»¥è¢«ä¸­æ–­
>
> â€‹	ä¸ºäº†è®©commité˜¶æ®µå°½é‡çš„å¿«ä¼šåšä¸€äº›å·¥ä½œï¼Œæ¯”å¦‚æ ‡è®°flagsï¼ˆå˜æ›´ç±»å‹ï¼‰ï¼Œç”Ÿæˆeffectsé“¾è¡¨ï¼Œcommité˜¶æ®µä¸ç”¨é‡æ–°éå†å±æ€§å˜åŒ–ï¼Œç›´æ¥å¤„ç†effectsé“¾è¡¨
>
> â€‹	ç©ºä½™æ—¶é—´ç”Ÿæˆdomï¼Œä¿å­˜èµ·æ¥
>
> commitï¼ˆrenderï¼‰é˜¶æ®µï¼ŒæŠŠå˜æ›´çš„ç»„ä»¶çš„å˜åŒ–æ¸²æŸ“åˆ°é¡µé¢ä¸Š
>
> â€‹	ä¸èƒ½è¢«ä¸­æ–­ï¼Œå› ä¸ºå¼€é”€å¤§
>
> â€‹	ä¸‰ä¸ªwhileï¼Œæ¸²æŸ“å‰ä¸­åï¼Œä¼˜å…ˆå­èŠ‚ç‚¹æ‰§è¡Œç”Ÿå‘½å‘¨æœŸ

reactæ¯å‘ç”Ÿä¸€æ¬¡æ›´æ–°ï¼Œæ¯”å¦‚ReactDOM.render/setStateï¼Œéƒ½ä¼šä»Fiber Rootå¼€å§‹é‡æ–°ä»ä¸Šå¾€ä¸‹éå†é€ä¸€æ‰¾åˆ°å˜åŒ–çš„èŠ‚ç‚¹ã€‚æ„å»ºå®Œæˆä¼šå½¢æˆä¸€é¢—fiber treeï¼Œreactå†…éƒ¨ä¼šåŒæ—¶å­˜åœ¨ä¸¤ä¸ªæ ‘

#### åŒç¼“å­˜ç»“æ„

å½“å‰æ˜¾ç¤ºçš„ç§°ä¸ºcurrent fiber treeï¼Œæ­£åœ¨æ„å»ºçš„ç§°ä¸ºworkInProgress fiber tree

é€šè¿‡alternateå±æ€§è¿æ¥ï¼Œå®ƒæŒ‡å‘workInProgress fiberï¼Œå…¶å®æ˜¯ä¸Šä¸€æ¬¡æ„å»ºçš„fiberé•œåƒï¼ˆä¹Ÿå°±æ˜¯current fiber treeï¼‰

å¦‚æœä¹‹å‰æ²¡æœ‰treeå°±é€çº§åˆ›å»ºï¼Œå¦‚æœå­˜åœ¨ï¼Œä¼šæ„å»ºä¸€ä¸ªworkInProgress fiber treeï¼Œå¯ä»¥å¤ç”¨current fiber treeä¸Šé¢æ²¡æœ‰æ”¹å˜çš„èŠ‚ç‚¹

> ä¸ºä»€ä¹ˆä½¿ç”¨åŒç¼“å­˜ï¼Ÿï¼ˆç±»ä¼¼canvasç¦»å±æ¸²æŸ“ä¼˜åŒ–ï¼‰
>
> 
>
> ä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œå¾ˆå¤šèŠ‚ç‚¹æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œè¿™ä¸ªç»“æ„ä¹Ÿæ˜¯ä¸ºäº†å¤ç”¨
>
> ä¸€ä¸ªå±æ€§å°±å¯ä»¥æ‹¿åˆ°å’Œå®ƒå¯¹åº”çš„èŠ‚ç‚¹
>
> æŸäº›æƒ…å†µä¸‹å¤ç”¨ç»“æ„
>
> æ›´æ–°å®Œæ¯•åcurrentç›´æ¥æŒ‡å‘workInProgress root å®Œæˆæ›´æ–°

#### æ„å»ºfiber tree

ä»£ç å¤§è‡´ä»**renderLoopSync()**å¼€å§‹ï¼Œä»ä¼˜å…ˆçº§æœ€é«˜çš„fiber rootå¼€å§‹é€’å½’

æ·±åº¦ä¼˜å…ˆï¼Œåªå¤„ç†äº†å­èŠ‚ç‚¹ï¼ˆä»ä¸Šåˆ°ä¸‹ï¼‰

**workInProgress**ï¼Œå½“å‰å¤„ç†çš„èŠ‚ç‚¹ï¼Œæ˜¯ä¸€ä¸ªé—­åŒ…

**beginWork()**åˆ›å»ºä¸€ä¸ªfiberï¼Œèµ‹å€¼ç»™workInProgress.childå¹¶è¿”å›ï¼Œèµ‹å€¼ç»™nextï¼ŒworkInProgres = next

å¾ªç¯åˆ°workInProgres === nullï¼Œæ‰§è¡ŒcompleteUnitOfWorkæ–¹æ³•

**completeUnitOfWork()**ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å…„å¼ŸèŠ‚ç‚¹ï¼Œæœ‰èµ‹å€¼ç»™workInProgresï¼Œç»§ç»­beginWorkï¼Œæ²¡æœ‰workInProgresè¿”å›åˆ°çˆ¶èŠ‚ç‚¹ï¼ˆä»ä¸‹å‘ä¸Šï¼‰ï¼Œç»§ç»­å¾ªç¯

##### beginWork

fiberç±»å‹å¾ˆå¤šï¼Œæ¯ä¸ªç±»å‹éƒ½æœ‰ä¸åŒçš„æ–¹æ³•è¿›è¡Œæ„å»º

Fragmentï¼ŒPartialï¼ŒFunctionï¼ŒClassï¼Œmemo...

**ç”Ÿå‘½å‘¨æœŸåœ¨beginWorkä¸­æ‰§è¡Œ**ï¼ŒrenderåŠrenderä¹‹å‰çš„æ‰€æœ‰ç”Ÿå‘½å‘¨æœŸ

1. åˆ›å»ºæˆ–è€…å¤ç”¨fiber

   current !== nullï¼Œä¸æ˜¯åˆæ¬¡æ„å»ºï¼Œåˆ¤æ–­propsæˆ–contextæ˜¯å¦æ”¹å˜ï¼Œè®¾ç½®didReceiveUpdateæ ‡å¿—ç»„ä»¶æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œå¦å¯ä»¥å¤ç”¨bailout

2. å¯¹æ¯”èŠ‚ç‚¹æ˜¯å¦éœ€è¦æ›´æ–°

   æ ¹æ®ä¸åŒçš„tagç”Ÿæˆä¸åŒçš„fiberèŠ‚ç‚¹

   éƒ½ä¼šè¿›å…¥reconcilerChildrenæ–¹æ³•

   mounté˜¶æ®µï¼Œåˆ›å»ºfiberèŠ‚ç‚¹

   updateé˜¶æ®µï¼Œå¯¹æ¯”fiberèŠ‚ç‚¹ç”Ÿæˆæ–°çš„fiberèŠ‚ç‚¹

   â€‹	å•èŠ‚ç‚¹diff

   â€‹	å¤šèŠ‚ç‚¹diff

3. æ‰“æ ‡è®°flags

   ç»™å˜æ›´çš„èŠ‚ç‚¹æ‰“æ ‡è®°ï¼Œä¾¿äºåé¢å¤„ç†

4. è¿”å›å­èŠ‚ç‚¹fiber

   èµ‹å€¼ç»™workInProgress.childå¹¶è¿”å›ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯

###### diffç®—æ³•

é¢„è®¾è§„åˆ™ï¼š

åŒçº§èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ

èŠ‚ç‚¹å˜åŒ–ï¼Œç›´æ¥åˆ æ‰ï¼Œç„¶åé‡å»º

å­˜åœ¨keyå€¼ï¼Œå¯¹æ¯”èŠ‚ç‚¹çš„keyå€¼

**å•èŠ‚ç‚¹diffï¼š**

reconcilerSingleChild

å¯¹æ¯”keyï¼Œä¸ä¸€è‡´æ ‡è®°åˆ é™¤

å¯¹æ¯”èŠ‚ç‚¹ç±»å‹ï¼Œéƒ½ä¸€è‡´å¯ä»¥å¤ç”¨ï¼Œä¸ä¸€è‡´ä¼šåˆ é™¤

å¤ç”¨æ—¶refï¼Œreturnï¼Œsiblingéœ€è¦é‡æ–°ç”Ÿæˆç»‘å®š

ä¸å­˜åœ¨å¯¹åº”èŠ‚ç‚¹ï¼Œæ–°å»º

**å¤šèŠ‚ç‚¹diffï¼š**

æ•°ç»„reconcilerChildrenArray

å¯¹æ¯”æ–°æ—§childrenç›¸åŒindexå¯¹è±¡çš„keyæ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰è¿”å›å¯¹è±¡ï¼Œå¦åˆ™null

keyä¸ç­‰ä¸ç”¨ç»§ç»­å¯¹æ¯”ï¼Œä¸èƒ½å¤ç”¨ï¼Œè·³å‡º

åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¦ç§»åŠ¨ï¼Œè¿”å›æ–°ä½ç½®

æ–°æ•°ç»„å°ä¸è€æ•°ç»„ï¼Œåˆ é™¤

æ–°æ•°ç»„æ–°å¢ï¼Œåˆ›å»º

åˆ›å»ºä¸€ä¸ªexistingChildrenä»£è¡¨å‰©ä½™æ²¡æœ‰åŒ¹é…çš„èŠ‚ç‚¹ï¼Œæ–°çš„æ•°ç»„æ ¹æ®keyä»mapä¸­æŸ¥æ‰¾ï¼Œæœ‰å°±å¤ç”¨ï¼Œæ²¡æœ‰æ–°å»º

##### completeUnitOfWork

å‘ä¸Šé€’å½’completeWork

åˆ›å»ºdomèŠ‚ç‚¹ï¼Œæ›´æ–°domèŠ‚ç‚¹ï¼ŒdomèŠ‚ç‚¹èµ‹å€¼ç»™stateNodeå±æ€§

æŠŠå­èŠ‚ç‚¹çš„side effecté™„åŠ åˆ°çˆ¶èŠ‚ç‚¹çš„sideEffecté“¾ä¸Šï¼Œcommité˜¶æ®µä½¿ç”¨

å­˜åœ¨å…„å¼ŸèŠ‚ç‚¹ï¼Œå°†workInProgressæŒ‡å‘å®ƒï¼Œæ‰§è¡ŒbeginWork

ä¸å­˜åœ¨å…„å¼Ÿï¼Œè¿”å›çˆ¶èŠ‚ç‚¹ï¼Œæ‰§è¡ŒbeginWork

> å­¦åˆ°äº†ä»€ä¹ˆï¼Ÿ
>
> 
>
> react-reconcilerï¼Œreactå°†reconcilerå°è£…æˆçš„ç‹¬ç«‹çš„å­æ¨¡å—ï¼Œtaroä½¿ç”¨
>
> reactçš„æ—¥å¸¸ä½¿ç”¨
>
> fiberçš„æ¶æ„æ€æƒ³
>
> 
>
> æ–°ç‰¹æ€§ï¼Ÿ
>
> 
>
> hooks

### commité˜¶æ®µ

è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Š

ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸èƒ½æ‰“æ–­

ä¸‰ä¸ªé˜¶æ®µï¼šä¸‰ä¸ªwhileå¾ªç¯ï¼Œé€’å½’èŠ‚ç‚¹åˆ†åˆ«æ‰§è¡ŒèŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸï¼Œéƒ½æ˜¯å…ˆæ‰§è¡Œçš„å­èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå†æ‰§è¡Œçˆ¶èŠ‚ç‚¹çš„

ä¸‰ä¸ªé˜¶æ®µéƒ½æ˜¯å…ˆæ‰§è¡Œçš„å­èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸï¼Œå†æ‰§è¡Œçˆ¶èŠ‚ç‚¹çš„

**commitBeforeMutationEffectsï¼ˆdomæ“ä½œå‰ï¼‰**

1. å¤„ç†domèŠ‚ç‚¹æ¸²æŸ“åˆ é™¤åçš„autofocusï¼Œbluré€»è¾‘
2. è°ƒç”¨getSnapshotBeforeUpdateç”Ÿå‘½å‘¨æœŸ
3. è°ƒåº¦useEffectï¼Œ**å¼‚æ­¥**ï¼Œä¸ä¼šé˜»å¡ï¼ŒuseEffect => componentDidMount + componentDidUpdateï¼ŒuseLayoutEffectæ˜¯åŒæ­¥çš„

**commitMutationEffectsï¼ˆdomæ“ä½œï¼‰**

1. éå†finishWorkï¼Œæ‰§è¡Œdomæ“ä½œ
2. å¯¹äºåˆ é™¤çš„ç»„ä»¶ï¼Œæ‰§è¡ŒcomponentWillUnmountç”Ÿå‘½å‘¨æœŸ

**recursivelyCommitLayoutEffectsï¼ˆdomæ“ä½œåï¼‰**

1. layouté˜¶æ®µä¹Ÿæ˜¯æ·±åº¦ä¼˜å…ˆéå†Effectlistè°ƒç”¨ç”Ÿå‘½å‘¨æœŸï¼ŒcomponentDidMount/componentDidUpdateï¼Œæ‰§è¡ŒuseEffectå‡½æ•°ä½“
2. èµ‹å€¼ref
3. å¤„ç†ReactDom.renderå›è°ƒ

> componentWillMountï¼Œåœ¨beginWorkä¸­æ‰§è¡Œï¼Œç”±äºä»ä¸Šå¾€ä¸‹æ„å»ºçš„ï¼Œæ‰€ä»¥renderä¹‹å‰çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å…ˆæ‰§è¡Œçš„çˆ¶èŠ‚ç‚¹çš„åæ‰§è¡Œçš„å­èŠ‚ç‚¹çš„

### Hooks

**ä½œç”¨**

class components + ç”Ÿå‘½å‘¨æœŸ - é€»è¾‘è¢«ç”Ÿå‘½å‘¨æœŸåˆ†æ•£ï¼Œä¸ç¬¦åˆå•ä¸€æŒ‡è´£åŸåˆ™ï¼Œå¯¼è‡´ä»£ç é‡å¤§ï¼Œä¸å¥½ç»´æŠ¤ï¼Œéœ€è¦æ‹†åˆ†

functional components - ä»£ç å°‘ï¼Œæ— çŠ¶æ€ï¼Œä¸€èˆ¬ç”¨äºUI

functional components + hooks - æœ‰çŠ¶æ€ï¼ˆuseStateï¼‰ï¼Œæ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸï¼ˆuseEffectå¼‚æ­¥/useLayoutEffectåŒæ­¥ï¼ŒæŒ‡è´£å•ä¸€ï¼Œé€»è¾‘æ›´åŠ æ¸…æ™°ç®€æ´ï¼Œä»£ç é‡å°äºclass componentsï¼Œmounté˜¶æ®µè°ƒç”¨ï¼‰ï¼Œä½¿ç”¨contextï¼ŒåŠŸèƒ½å®Œå–„ï¼Œä¸æ­¢UIï¼Œå¤ç”¨ç®€å•ï¼ˆè‡ªå®šä¹‰hooksï¼Œclassä½¿ç”¨é«˜é˜¶ç»„ä»¶ï¼‰

> è‡ªå®šä¹‰hooksï¼Œä½¿ç”¨äº†hooksçš„å‡½æ•°
>
> fcåœ¨beginWorkæ—¶æ‰§è¡Œï¼Œç›¸å½“äºrenderç”Ÿå‘½å‘¨æœŸï¼ŒsetStateçš„åˆå§‹å€¼åªåœ¨ç¬¬ä¸€æ¬¡æœ‰ç”¨
>
> **useEffectå¼‚æ­¥ï¼Œæ›´æ–°äº†DOMï¼Œé¡µé¢æ¸²æŸ“ä¹‹åæ‰§è¡Œï¼Œæ­¤æ—¶æ›´æ–°Domåªä¼šå›æµä¸¤æ¬¡**
>
> **useLayoutEffectåŒæ­¥ï¼Œä¼ []å®Œå…¨ç­‰ä»·äºdidMountï¼Œæ›´æ–°äº†DOMï¼Œé¡µé¢æ¸²æŸ“ä¹‹å‰ï¼ˆå› ä¸ºæ­¤æ—¶ä¸»çº¿ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾ï¼‰ï¼Œæ­¤æ—¶æ›´æ–°Domåªä¼šå›æµä¸€æ¬¡ï¼Œä¼šé˜»å¡ï¼Œçœ‹åœºæ™¯**
>
> æ¨¡æ‹Ÿç”Ÿå‘½å‘¨æœŸï¼Œæ¨¡æ‹ŸDidMountï¼ŒDidUpdateï¼ŒUnmountï¼ˆè¿”å›å‡½æ•°çš„å‡½æ•°ä½“ï¼‰

**å¸¸è§çš„å‘**

1. åªèƒ½å®šä¹‰åœ¨é¡¶å±‚ï¼Œä¸èƒ½æ”¾åœ¨ä»£ç å—ä¸­ï¼Œå› ä¸ºæ˜¯hooksæ˜¯é€šè¿‡é“¾è¡¨è¿æ¥èµ·æ¥çš„ï¼Œé¡ºåºæŸ¥æ‰¾ï¼Œæ”¾åˆ°é€»è¾‘åˆ†æ”¯ä¸­ä¼šé€ æˆæ··ä¹±

> æ‰‹åŠ¨ç»‘å®šçš„äº‹ä»¶ï¼Œå›è°ƒå‡½æ•°å¿…é¡»æŒ‚åœ¨thisä¸Šï¼Œå¸è½½æ—¶è¦ä¼ åŒä¸€ä¸ª

2. ç¼“å­˜è§£å†³å­ç»„ä»¶æ— æ•ˆæ¸²æŸ“

useCallbackï¼Œæ¯æ¬¡stateæ›´æ–°éƒ½ä¼šå¯¼è‡´å‡½æ•°éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°å‡½æ•°ï¼Œå¦‚æœæ˜¯ä¼ é€’ç»™å­ç»„ä»¶çš„ï¼Œè¿˜ä¼šå¯¼è‡´å­ç»„ä»¶æ›´æ–°ï¼Œæ‰€ä»¥éœ€è¦ç¼“å­˜

useMemoï¼Œé€‚ç”¨å¯¹è±¡ï¼Œæ•°ç»„

useCallback/useMemo + React.memoï¼ŒReact.memoåŒ…è£¹fcï¼Œæµ…æ¯”è¾ƒç›¸å½“äºPureComponent

3. capture valueé—®é¢˜ï¼Œå¼‚æ­¥ç”¨åˆ°çš„stateå€¼ä¼šæ˜¯è€å€¼ï¼Œå¦‚æœæœŸé—´å€¼å­˜åœ¨å˜åŒ–çš„è¯ï¼ŒåŸå› æ˜¯é—­åŒ…ï¼ŒuseRefå¯ä»¥è§£å†³

useRefï¼Œåœ¨fcä¸­ä½¿ç”¨ref

#### æ›´æ–°æµç¨‹

ReactDom.renderï¼š

upbatchUpdate()ä¼˜å…ˆçº§é«˜ï¼Œç›´æ¥åŒæ­¥è¿è¡Œ - updateContainer - scheduleUpdateOnFiberï¼ˆscheduleæµç¨‹ï¼Œåˆ¤æ–­åŒæ­¥ç­‰ï¼‰ - åŒæ­¥å¤„ç†

this.setState/hooks setStateï¼š

dispatchUserBlockingUpdate - dispatchEvent - scheduleUpdateOnFiber

#### useState

ä¸¤ä¸ªé˜¶æ®µï¼šmountï¼Œupdate

**mounté˜¶æ®µ**

mountStateï¼š

é»˜è®¤å€¼æ˜¯fnæ—¶æ‰§è¡Œfnå¾—åˆ°åˆå§‹å€¼

åˆ›å»ºä¸€ä¸ªhookå¯¹è±¡ï¼Œé“¾è¡¨ç»“æ„ï¼Œstateæ”¾åœ¨memoizedStateå±æ€§

æ–°å»ºä¸€ä¸ªqueue

æ–°å»ºdispatchï¼ŒæŠŠqueueå’Œå½“å‰fiberä¼ ç»™dispatchAction

è¿”å›é»˜è®¤å€¼å’Œdispatch

> hookå¯¹è±¡ï¼ŒmemoizedStateï¼Œå­˜æ”¾å€¼ï¼ˆfiberä¸­ä¹Ÿæœ‰ï¼ŒæŒ‡hookï¼‰ï¼ŒbaseStateï¼Œå­˜æ”¾å€¼ï¼Œå¯å˜ï¼ŒbaseQueueï¼Œqueueï¼Œnextï¼Œä¸‹ä¸€ä¸ªhook 
>
> queueå¯¹è±¡ï¼Œpendingï¼ˆæ‰€æœ‰çš„æ›´æ–°updateé“¾è¡¨ï¼‰ï¼Œdispatchå‚æ•°2ï¼ŒlastRenderedReducerï¼ŒlastRenderedState
>
> dispatchï¼Œç»™dispatchActionä¼ queueå’Œå½“å‰fiberç”Ÿæˆæ–°çš„å‡½æ•°

**updateé˜¶æ®µ**

dispatchï¼šï¼ˆdispatchActionï¼‰

åˆ›å»ºä¸€ä¸ªupdateï¼Œå±æ€§laneï¼Œactionï¼ˆç”¨æˆ·ä¼ å…¥çš„ï¼‰ï¼ŒeagerReducerï¼ŒeagerStateï¼ˆeagerxxxä¼˜åŒ–ï¼Œç©ºé—²æ—¶ä½¿ç”¨ï¼‰ï¼Œnext

updateæ·»åŠ åˆ°queue.pending

ç©ºé—²çŠ¶æ€æ—¶è®¡ç®—å‡ºæœ€æ–°çš„stateï¼Œä¿å­˜åœ¨eagerState

æœ€åè°ƒç”¨ä¸€æ¬¡scheduleUpdateOnFiberï¼Œè¿›å…¥è°ƒåº¦ï¼Œè§¦å‘functioné‡æ–°æ‰§è¡Œ

updateStateï¼šï¼ˆupdateReducerçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼‰

æ‰¾åˆ°å¯¹åº”çš„hook

é€’å½’è®¡ç®—queueä¸­çš„update

è®¡ç®—æœ€æ–°çš„stateï¼Œèµ‹å€¼ç»™memoizedStateï¼ŒdispatchActionè¿˜æ˜¯ä¹‹å‰çš„

> å¤šæ¬¡setStateä¼šå¤šæ¬¡æ›´æ–°ï¼Œæš‚æ—¶æ²¡æœ‰é»˜è®¤åšæ‰¹å¤„ç†ï¼Œæ”¾åœ¨setTimeoutå¯ä»¥è®©ä»–å˜æˆä¸€æ¬¡æ›´æ–°ï¼ˆç›¸å½“äºè®©è¿™å‡ ä¸ªdispatchè·³å‡ºäº†åŸæœ¬çš„contextï¼‰æˆ–è€…ä½¿ç”¨unstable_batchedUpdateæ–¹æ³•ï¼ˆreact-domæä¾›ï¼‰ï¼Œclass componentsä¼šåˆå¹¶æ›´æ–°

#### useEffect

**MountEffect**ï¼Œåœ¨beginWorké‡Œè°ƒç”¨å‡½æ•°ç»„ä»¶çš„æ—¶å€™æ‰§è¡Œï¼Œå›è°ƒåœ¨commité˜¶æ®µæ‰§è¡Œæˆ–è¿›å…¥è°ƒåº¦

å‚æ•°createå’Œdepsï¼Œ**æœç»ä¸å†™ä¾èµ–æ•°ç»„**ï¼Œæ¯ä¸ªstateå˜åŠ¨éƒ½ä¼šæ›´æ–°

åˆ›å»ºä¸€ä¸ªhook

æ‰“ä¸Šflagsæ ‡è®°ï¼ŒæŒ‰ä½ä¸æˆ–é€‚ç”¨äºå¤šç§flagsæ ‡è®°ï¼Œä¸æ‰“æ ‡è®°ä¸ä¼šæ‰§è¡Œ

pushä¸€ä¸ªeffect

> effect
>
> {
>
> â€‹	tag,
>
> â€‹	create,
>
> â€‹	destory,
>
> â€‹	deps,
>
> â€‹	next
>
> }

**UpdateEffect**ï¼Œå’Œmounté˜¶æ®µç±»ä¼¼

ç»™destroyèµ‹å€¼

å¯¹æ¯”ä¾èµ–çš„å€¼ï¼Œæœ‰å˜åŒ–é‡æ–°å‘èµ·ä¸€ä¸ªeffectï¼Œåœ¨commité˜¶æ®µæ‰§è¡Œ

æ‰“ä¸Šflagsæ ‡è®°

pushä¸€ä¸ªeffect

> useEffectå›è°ƒçš„æ‰§è¡Œæ—¶æœºï¼šï¼ˆcommité˜¶æ®µï¼‰
>
> åœ¨LayoutEffecté‡Œè°ƒç”¨commitHookEffectListMountæ–¹æ³•ï¼Œæ‰§è¡Œäº†createè¿”å›ç»™destory
>
> commitHookEffectListUnMounté‡Œæ‰§è¡Œdestory

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-04 ä¸‹åˆ5.00.19.png" alt="æˆªå±2021-06-04 ä¸‹åˆ5.00.19" style="zoom:50%;" />

#### useRef

åˆ›å»ºrefï¼Œvalue = initialValue

æŠŠrefèµ‹å€¼ç»™hook.memoizedState

#### é¢è¯•é¢˜

setStateåé¢å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ

- åœ¨å“ªé‡Œè°ƒç”¨çš„ï¼ŒonClickæˆ–ç”Ÿå‘½å‘¨æœŸ
  - æ ‡è®°ä¼˜å…ˆçº§
  - è¿›å…¥è°ƒåº¦æµç¨‹
    - scheduleræµç¨‹...reconcileræµç¨‹...commitæµç¨‹
- hooksé‡Œ
  - åˆ›å»ºä¸€ä¸ªupdateï¼Œæ·»åŠ åˆ°queue.pendingï¼Œæœ€åè°ƒç”¨scheduleUpdateOnFiberï¼Œè¿›å…¥scheduleè°ƒåº¦ï¼Œè§¦å‘functioné‡æ–°æ‰§è¡Œ
    - scheduleræµç¨‹...reconcileræµç¨‹...commitæµç¨‹

ç”Ÿå‘½å‘¨æœŸé‡Œçš„unsafeï¼Ÿ

- 16ä¹‹åreconcileré˜¶æ®µæ˜¯å¯ä»¥è¢«æ›´é«˜ä¼˜å…ˆçº§ä¸­æ–­çš„å¯èƒ½ä¼šåå¤æ‰§è¡Œçš„ç”Ÿå‘½å‘¨æœŸåŠ ä¸Šäº†unsafe
- DidMountä¸ä¼šå› ä¸ºæ˜¯commité˜¶æ®µ

useEffectä»€ä¹ˆæ—¶å€™æ‰§è¡Œï¼Ÿä¸didMountçš„åŒºåˆ«ï¼Ÿ

- å¼‚æ­¥è°ƒåº¦ï¼Œåœ¨é¡µé¢æ¸²æŸ“å®Œä¹‹åæ‰ä¼šæ‰§è¡Œ
- useLayoutEffect == didMountï¼ŒåŒæ­¥æ‰§è¡Œ

useCallbackå’ŒuseMemoåŒºåˆ«ï¼Ÿ

- ç¼“å­˜å‡½æ•°/å¼•ç”¨ç±»å‹æ•°æ®
- useCallback+React.memoåšæµ…æ¯”è¾ƒï¼Œé¿å…æ— æ„ä¹‰æ¸²æŸ“å­ç»„ä»¶

capture valueåŸç†ï¼Ÿ

- é—­åŒ…ï¼Œå˜é‡ä¸€ç›´åœ¨å†…å­˜ä¸­
- é€šè¿‡useRefè§£å†³

dom diffåŸç†ï¼Ÿ

è™šæ‹Ÿdomï¼Ÿ

- domæ“ä½œæ˜‚è´µ
- è™šæ‹Ÿdomå¯ä»¥åªæ›´æ–°ä¸€æ¬¡ï¼Œfiber treeï¼ŒåŒç¼“å­˜ç»“æ„ï¼Œcurrent treeå’ŒçœŸå®domä¸€ä¸€å¯¹åº”

æ€ä¹ˆåœ¨setStateåæ‰§è¡Œå›è°ƒï¼Ÿ

- this.setState({}, () => {})ï¼Œæ›´æ”¹åˆ°é¡µé¢ä¹‹åæ‰§è¡Œå›è°ƒï¼Œhookä¸è¡Œï¼ŒsetState + useEffectç›¸å½“äºdidMount

ç”Ÿå‘½å‘¨æœŸæ‰§è¡Œé¡ºåºï¼Ÿ

useEffectå’ŒuseLayoutEffectåŒºåˆ«ï¼Ÿ

Reactå¤„ç†å¼‚å¸¸ï¼Ÿ

- ErrorBundary

å®ç°è‡ªå®šä¹‰hookï¼Ÿ

```js
// mounté˜¶æ®µæ‰§è¡Œ
function useMount(cb) {
  useEffect(() => {
    cb()
  }, [])
}
```

useEffectæ­»å¾ªç¯ï¼Ÿ

- é€»è¾‘ä¸Šå¾ªç¯ä¾èµ–
- useRefï¼Œå‡å°‘ä¾èµ–

this.setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿ

setStateæœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ–¹æ³•ï¼Œå…¶ä¹‹æ‰€ä»¥ä¼šè¡¨ç°å‡ºä¸€ç§å¼‚æ­¥çš„å½¢å¼ï¼Œæ˜¯å› ä¸ºreactæ¡†æ¶æœ¬èº«çš„ä¸€ä¸ªæ€§èƒ½ä¼˜åŒ–æœºåˆ¶ã€‚

ä¸ºä»€ä¹ˆhookså‡½æ•°é¡¶éƒ¨ï¼Ÿ

é“¾è¡¨ç»“æ„

refä½¿ç”¨æ³¨æ„äº‹é¡¹ï¼Ÿ

- æ—¢å¯ä»¥ç”¨æ¥å¾—åˆ°domèŠ‚ç‚¹ï¼Œåˆå¯ä»¥å­˜å€¼ï¼Œclass compä¸­å¯ä»¥è·å–ç»„ä»¶å®ä¾‹ï¼Œfcä¸­useRefåªèƒ½è·å–domèŠ‚ç‚¹
  - fcè·å–å®ä¾‹éœ€è¦ç»“åˆè½¬å‘refï¼ŒforwardedRefå’ŒuseImperativeHandleè‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„å®ä¾‹å€¼ï¼Œå¯ä»¥è®©çˆ¶ç»„ä»¶è®¿é—®å­ç»„ä»¶æ–¹æ³•
- ç›‘å¬refï¼Œå¯ä»¥ç»™refå­—æ®µä¼ useCallbackå‡½æ•°

#### jsxè½¬æ¢

æ—§çš„æ˜¯React.createElement()ï¼Œè¦å¼•å…¥Reactï¼Œæ–°çš„jsxè½¬æ¢_jsx(...)

#### äº‹ä»¶å§”æ‰˜

16ï¼šæ³¨å†Œåˆ°documentèŠ‚ç‚¹

17ï¼šæ³¨å†Œåˆ°Reactçš„æ ¹èŠ‚ç‚¹å®¹å™¨ä¸­

å¯ä»¥å†™å¤šä¸ªReactDom.render

è§£å†³é˜»æ­¢äº‹ä»¶å†’æ³¡çš„é—®é¢˜

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-04 ä¸‹åˆ6.11.49.png" alt="æˆªå±2021-06-04 ä¸‹åˆ6.11.49" style="zoom:50%;" />

## vite

é¡¹ç›®å‚è€ƒï¼šdemo-collection

## recoil

redux - ä¸­å¿ƒåŒ–ç®¡ç†

â€‹	useReducer

mobx - ä¸­å¿ƒåŒ–ç®¡ç†

â€‹	mobx-lite - è½»é‡ï¼Œæ·±å±‚çŠ¶æ€æœ‰é—®é¢˜ï¼Œ+ mobx-state-treeï¼Œä½¿ç”¨*å‡½æ•°ï¼ˆæ€§èƒ½å½±å“å¤§ï¼Œè¿‡æ¸¡è¯­æ³•æ²¡ä¼˜åŒ–ï¼‰

recoil - åªé€‚ç”¨äºreactï¼ŒåŸå­stateï¼ŒçŠ¶æ€ç‹¬ç«‹ï¼Œåªæœ‰action

â€‹	åˆ·æ–°ä¸¤é

å¾®å‰ç«¯

â€‹	xstateï¼Œé€šç”¨

> redux ä¸­å¿ƒåŒ–ç®¡ç†
>  useReducer    
>  åŸºäºuseReducerçŠ¶æ€ç®¡ç†
>
>      provider  
>          provider
>              provider
>                  provider 
>                      provider
>
> Vuex ->  
> mobx ä¸­å¿ƒåŒ–ç®¡ç† éº»çƒ¦ 
>  mobx-lite + mobx-state-tree 
>      *å‡½æ•° 
>      useXxxxxxxxx.....
>  @xxxxxxxx
>  const x = function(){}
>
>
> recoil  Atom State
>  reactä¸­ ---> action
>  è¿è¡Œ2é useState({})  = setState({})  {} == {}
>
>
> å¾®å‰ç«¯
> index.html xstate poroxy

## C

æœ€åº•å±‚ï¼šcpuå’Œå†…å­˜

### cpuä¸å†…å­˜çš„å·¥ä½œåŸç†

#### CPUçš„æŒ‡ä»¤é›†

ä¸åŒçš„cpuæŒ‡ä»¤é›†ä¸ä¸€æ ·ï¼Œç›¸å½“äºcpuä½¿ç”¨çš„è¯­è¨€ï¼Œæœºå™¨æŒ‡ä»¤ä¸æ˜¯æ±‡ç¼–ï¼Œæ±‡ç¼–ä¹Ÿæ˜¯ç»™äººç”¨çš„ï¼Œå‰ä¸¤ä¸ªæ°‘ç”¨ï¼š

x86/x64æŒ‡ä»¤é›†ï¼ŒPCï¼ŒMACä¸€èˆ¬æ˜¯x86ï¼Œx64ä¸€èˆ¬ç”¨åœ¨æœåŠ¡å™¨ 

ARMæŒ‡ä»¤é›†ï¼Œæ‰‹æœºï¼Œå¹³æ¿å¸¸ç”¨

MIPSæŒ‡ä»¤é›†ï¼Œå¤šç”¨äºæœåŠ¡å™¨ï¼Œå›½äº§é¾™èŠ¯cpuç”¨çš„è¿™ä¸ª

RISCæŒ‡ä»¤é›†ï¼Œå¤šç”¨äºå·¥ä¸š

##### ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹

ç¨‹åºæœ€å¼€å§‹åœ¨ç¡¬ç›˜ï¼Œæ‰§è¡Œæ—¶è£…åˆ°å†…å­˜ä¸­å»ã€‚å†…å­˜ä¸­çš„ç¨‹åºï¼ˆè¿›ç¨‹ï¼‰åˆ†ä¸¤éƒ¨åˆ†ï¼Œ**ä»£ç æ®µå’Œæ•°æ®æ®µ**ï¼Œæ”¾åœ¨ä¸åŒçš„åŒºåŸŸã€‚

ä»£ç æ®µé©±åŠ¨cpuã€‚ç¨‹åºæ”¾è¿›å†…å­˜ä¸­å°±å˜æˆäº†è¿›ç¨‹ï¼Œæ“ä½œç³»ç»Ÿä¼šåˆ’åˆ†å‡ºä¸“é—¨çš„å†…å­˜ç©ºé—´ï¼Œå«è¿›ç¨‹ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿè®¡ç®—å¥½åç§»é‡ç„¶åä»è¿›ç¨‹çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å¼€å§‹æ‹¿ï¼Œcpué€šè¿‡æŒ‡ä»¤åœ°å€æ‰¾åˆ°æŒ‡ä»¤ï¼Œcpuçš„æŒ‡ä»¤è®¡æ•°å™¨ä¼šè®¡ç®—æŒ‡ä»¤çš„é•¿åº¦ï¼Œcpuæ‹¿åˆ°æŒ‡ä»¤åä¼šæ”¾åœ¨æŒ‡ä»¤å¯„å­˜å™¨ä¸­ï¼Œç„¶åå¼€å§‹æ‰§è¡Œï¼Œé€šè¿‡ç”µè·¯æ‰§è¡Œï¼ˆé—¨ç”µè·¯ï¼‰ã€‚

æœ‰çš„æŒ‡ä»¤è´Ÿè´£ä»å†…å­˜æ•°æ®æ®µæ‹¿æ•°æ®åˆ°å­˜å‚¨å•å…ƒï¼ˆMOVï¼‰ï¼Œæœ‰çš„è´Ÿè´£è¿›è¡Œè®¡ç®—ï¼ˆADDï¼‰ï¼Œæ¯”å¦‚æŒ‡ä»¤å°†æ•°æ®ä»æ•°æ®æ®µæ‹¿å‡ºç»™è¿ç®—å•å…ƒï¼Œç„¶åå°†ç»“æœè¿”å›ç»™å­˜å‚¨å•å…ƒï¼ˆè¾ƒå°ï¼‰ï¼Œç„¶åæ ¹æ®ä¸€å®šçš„ç®—æ³•ï¼Œæ•°æ®è¿˜ä¼šå›å†™åˆ°å†…å­˜çš„æ•°æ®æ®µã€‚

æŒ‡ä»¤æ˜¯å•å‘çš„ï¼Œæ•°æ®æ˜¯åŒå‘çš„ï¼Œå› ä¸ºæŒ‡ä»¤ä¸éœ€è¦å›å†™ï¼Œé™¤éæ˜¯æ¶æ„ç¨‹åºï¼ˆæ—©æœŸçš„å†…å­˜å¤§æˆ˜ï¼ŒæŠŠæŒ‡ä»¤å½“æˆæ•°æ®å†™è¿›å†…å­˜ï¼Œå½“æ—¶çš„å†…å­˜åˆ’åˆ†ä¸æ˜¯å¾ˆä¸¥æ ¼ï¼‰

cpuæ“ä½œå†…å­˜ï¼Œæ“ä½œçš„å°±æ˜¯åœ°å€ï¼ŒCè¯­è¨€é€šè¿‡æŒ‡é’ˆæ“ä½œåœ°å€

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ5.05.29.png" alt="æˆªå±2021-06-08 ä¸‹åˆ5.05.29" style="zoom:50%;" />

#### cpuçš„ç»„æˆ

æ§åˆ¶å™¨ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼ŒæŒ‡ä»¤ä»å†…å­˜æ¥

è¿ç®—å™¨ï¼Œå¤„ç†æ•°æ®ï¼Œè®¡ç®—åŸºäºåŠ æ³•

å­˜å‚¨å™¨ï¼Œä¸æ˜¯å†…å­˜ï¼Œæ•°æ®ä»å†…å­˜æ¥

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ4.48.10.png" alt="æˆªå±2021-06-08 ä¸‹åˆ4.48.10" style="zoom:50%;" />

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ5.57.20.png" alt="æˆªå±2021-06-08 ä¸‹åˆ5.57.20" style="zoom:50%;" />

### è®¡ç®—æœºè¯­è¨€çš„æœ¬æºå’Œå‘å±•

æœ¬æº:äºŒè¿›åˆ¶æ•°æ®

ç¬¬ä¸€ä»£è¯­è¨€:æœºå™¨æŒ‡ä»¤ (ç—›è‹¦æŒ‡æ•° âœ®âœ®âœ®âœ®âœ®)ï¼Œ0101

ç¬¬äºŒä»£è¯­è¨€:æ±‡ç¼–æŒ‡ä»¤(ç—›è‹¦æŒ‡æ•° âœ®âœ®âœ®âœ®âœ©)ï¼Œå¯¹æœºå™¨æŒ‡ä»¤çš„æ˜ å°„ï¼Œäººå¯ä»¥ç†è§£

ç¬¬ä¸‰ä»£è¯­è¨€:é«˜çº§è¯­è¨€(ä¸»è¦ç‰¹å¾:é¢å‘è¿‡ç¨‹)ï¼ŒC

ç¬¬å››ä»£è¯­è¨€:é¢å‘å¯¹è±¡è¯­è¨€(é¢å‘äº’è”ç½‘ã€å¤©ç„¶æ”¯æŒæ•°æ®åº“)ï¼Œjavaï¼ŒC++

#### äº†è§£æ±‡ç¼–è¯­è¨€

æ±‡ç¼–è¯­è¨€æ˜¯æœ€è´´è¿‘åº•å±‚çš„è®¡ç®—æœºè¯­è¨€

æ±‡ç¼–è¯­è¨€æ˜¯ç›´æ¥æ“ä½œç¡¬ä»¶çš„ï¼Œæ²¡æœ‰ä»»ä½•æŠ½è±¡ï¼Œä¸åŒçš„æŒ‡ä»¤é›†å¯¹åº”çš„æ±‡ç¼–è¯­è¨€ä¸ä¸€æ ·ï¼Œä¸èƒ½é€šç”¨

æ±‡ç¼–è¯­è¨€ç”±æŒ‡ä»¤ä¸æ•°æ®ç»„æˆï¼Œæ²¡æœ‰ä»»ä½•è¯­å¥

æ±‡ç¼–æŒ‡ä»¤å—åˆ°ç¡¬ä»¶å¹³å°é™åˆ¶ï¼Œå¯ç§»æ¤æ€§å¾ˆä½

äº†è§£ä¸€äº›åº•å±‚è¯­è¨€çŸ¥è¯†ï¼Œå¯¹ç†è§£è®¡ç®—æœºçš„è¿ä½œæœºåˆ¶å’Œå†…å­˜ç®¡ç†å¤§æœ‰å¥½å¤„

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ6.09.32.png" alt="æˆªå±2021-06-08 ä¸‹åˆ6.09.32" style="zoom:50%;" />

Hello wordä¼ªä»£ç ï¼Œç»™ç¼–è¯‘å™¨ç”¨çš„ï¼Œç¼–è¯‘å™¨è½¬ç ä¹‹åç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒæŒ‡ä»¤å’Œæ•°æ®è¦æ ¹æ®è§„åˆ™åˆ†å¼€æ”¾

å®šä¹‰æ•°æ®ï¼Œæ²¡æœ‰ç±»å‹ï¼ŒåŒ…å«æ•°æ®å’Œæ•°æ®é•¿åº¦

æŒ‡å®šç¨‹åºå…¥å£_start

movæŠŠä¸€ä¸ªæ•°æ®æ”¾åˆ°ä¸€ä¸ªå¯„å­˜å™¨ï¼ŒæŠŠ4æ”¾å…¥axå¯„å­˜å™¨ï¼Œä¸¤ä½å­—æ¯çš„å¯„å­˜å™¨ç”¨äº†16ä½ï¼Œä¸‰ä¸ªå­—æ¯çš„32ä½

movç›¸å½“äºç»™apiä¼ å‚ï¼Œç¬¬ä¸€ä¸ªmovæ˜¯å‡½æ•°åé¢æ˜¯å‚æ•°ï¼Œint 80hæ˜¯è°ƒç”¨æ“ä½œç³»ç»Ÿçš„api

### Cè¯­è¨€

#### å‘å±•å†å²

å¤©ç”Ÿçš„ç³»ç»Ÿçº§è¯­è¨€

æœ€æ—©ç”¨æ¥ç¼–å†™Unixå†…æ ¸

æ›¾ç»æœ€æµè¡Œçš„è¯­è¨€

è‡³ä»Šä»åœ¨ä¸æ–­å‘å±•

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ8.07.01.png" alt="æˆªå±2021-06-08 ä¸‹åˆ8.07.01" style="zoom:50%;" />

#### ä¸jsåŒºåˆ«

Cè¯­è¨€æ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œå¿…é¡»ç»è¿‡ç¼–è¯‘æˆæœºå™¨æŒ‡ä»¤ï¼Œç„¶åé“¾æ¥ï¼ˆç»„è£…æˆæ•´ä½“ï¼‰æ‰èƒ½æ‰§è¡Œ

JavaScriptæ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œä¹Ÿä¼šç»è¿‡ç¼–è¯‘ï¼Œts-jsï¼Œnodejs-å­—èŠ‚ç -jit

Cè¯­è¨€è¦å€ŸåŠ©ç¼–è¯‘å™¨è½¬æ¢æˆå¯æ‰§è¡Œç¨‹åº

JavaScriptè¦å€ŸåŠ©è§£é‡Šå¼•æ“è¿è¡Œ

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ8.10.52.png" alt="æˆªå±2021-06-08 ä¸‹åˆ8.10.52" style="zoom:50%;" />

#### cä¸c++çš„åŒºåˆ«

1ã€C++æ˜¯æ–°çš„ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä¸æ˜¯Cçš„æ‰©å±•ï¼Œæ¯”cå¤æ‚å¾ˆå¤šï¼Œé¢å‘å¯¹è±¡çš„ç‰¹æ€§æ˜¯æœ€å¤šçš„ï¼Œå­ç±»å¯ä»¥ç»§æ‰¿å¤šçˆ¶ç±»ï¼Œå¤šç»§æ‰¿ï¼Œæ¯”å¦‚å®ƒçš„ioåº“ï¼Œå‹å…ƒfriendï¼Œå¯ä»¥æ“ä½œç§æœ‰å±æ€§

2ã€Cè¯­è¨€æ˜¯é¢å‘è¿‡ç¨‹çš„ï¼ŒC++æ˜¯é¢å‘å¯¹è±¡çš„

3ã€Cå’ŒC++è¯­è¨€éƒ½æœ‰æ ‡å‡†åº“

4ã€ç›®å‰Cå¤§å¤šç”¨åœ¨ç½‘ç»œç›¸å…³å’ŒåµŒå…¥å¼ç­‰æ–¹é¢

5ã€ç›®å‰C++å¤§å¤šç”¨åœ¨å¤æ‚å¼•æ“å’Œåº”ç”¨è½¯ä»¶æ–¹é¢

C#å’Œjavaæ˜¯åŒä¸€ç±»ï¼Œäº’ç›¸æŠ„ï¼ŒC#åŸèº«æ˜¯J++ï¼Œjavaåœ¨å‰ï¼Œsunå¼€æºjava

Cå’ŒC++æ²¡æœ‰GC

goï¼Œrustï¼Œæ‰‹åŠ¨+GC

è¯­è¨€çš„å‘å±•ï¼Œé¢å‘å¯¹è±¡ï¼ŒGC

### é…ç½®ç¯å¢ƒ

Windowsç¯å¢ƒ: Visual C++/MingWin

Linux/unixç¯å¢ƒ:gcc/g++

Macç¯å¢ƒ:Xcode/gcc

æ¨èLinux/Unix/Macç¯å¢ƒ

### è¯­æ³•

æ¨èlearnxinyminutes.com

æ•°æ®ç±»å‹

æ•´å‹ï¼Œæœ‰ç¬¦å·/æ— ç¬¦å·ï¼Œ32ä½2å­—èŠ‚/64ä½4å­—èŠ‚ï¼Œé•¿æ•´å‹/çŸ­æ•´å‹2å­—èŠ‚16æ¯”ç‰¹

intï¼Œshortï¼Œlongï¼Œint64

æµ®ç‚¹å‹ï¼Œå•ç²¾åº¦4å­—èŠ‚/åŒç²¾åº¦8å­—èŠ‚

floatï¼Œdouble

å­—ç¬¦å‹ï¼Œæœ€å°çš„æ•´å‹ï¼Œ1å­—èŠ‚ï¼Œæœ‰ç¬¦å·/æ— ç¬¦å·

chart

ç»“æ„ä½“ï¼Œæ²¡æœ‰æ–¹æ³•ï¼Œå†…å­˜é‡Œç½—åˆ—

unionï¼Œè”åˆä½“ï¼Œå¤ç”¨ä¸€å—å†…å­˜

æšä¸¾

boolean

### å†…å­˜ä¸æŒ‡é’ˆ

cæ˜¯æœ€æ¥è¿‘ç¡¬ä»¶ï¼ˆå†…å­˜å’Œcpuï¼‰çš„è¯­è¨€ï¼Œå¯åµŒå…¥æ±‡ç¼–ä»£ç 

å†…å­˜çš„æœ€å°å•ä½ï¼Œå­—èŠ‚ï¼Œ8ä½

å†…å­˜ä¸å†…å­˜åœ°å€ï¼Œä¾é å†…å­˜åœ°å€å˜é‡

æŒ‡é’ˆã€åœ°å€ä¸å¼•ç”¨ï¼ŒæŒ‡é’ˆæ˜¯ä¸€ä¸ªå˜é‡ç”¨æ¥ä¿å­˜å†…å­˜åœ°å€ï¼ŒæŒ‡é’ˆä¹Ÿåœ¨å†…å­˜é‡Œï¼Œå¼•ç”¨æ˜¯è¢«å°è£…çš„æŒ‡é’ˆï¼Œå¼•ç”¨ä¸­çš„æŒ‡é’ˆç³»ç»Ÿç»´æŠ¤ï¼Œä¸ç”¨å¯¹åœ°å€è¿›è¡Œè®¡ç®—ï¼ŒåŠ å‡ï¼Œå¯¹å•ä½è¿›è¡Œè¿ç®—ï¼Œæ¯”å¦‚ä¸€ä¸ªæ•´å‹å•ä½ï¼ŒæŒ‡é’ˆå¯ä»¥æŒ‡å‘å†…å­˜ä¸­çš„ä»»ä½•ä¸œè¥¿

æŒ‡å‘å˜é‡çš„æŒ‡é’ˆï¼Œint a = 10; int *pa = &a; printf('%d', *pa)ï¼ˆé—´æ¥å¯»å€ï¼‰;prints('%d', a)ï¼ˆç›´æ¥å¯»å€ï¼‰

æŒ‡å‘æŒ‡é’ˆçš„æŒ‡é’ˆï¼ŒäºŒçº§æŒ‡é’ˆï¼Œint ** ppa = &pa; printf('%d', **ppa); // *paæ˜¯açš„åœ°å€

æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ8.52.27.png" alt="æˆªå±2021-06-08 ä¸‹åˆ8.52.27" style="zoom:50%;" />

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ9.39.45.png" alt="æˆªå±2021-06-08 ä¸‹åˆ9.39.45" style="zoom:50%;" />

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ9.40.13.png" alt="æˆªå±2021-06-08 ä¸‹åˆ9.40.13" style="zoom:50%;" />

åŠ¨æ€å†…å­˜åˆ†é…

cå’Œc++å¯¹æ•°æ®æ®µè¿›è¡Œäº†æ›´åŠ è¯¦ç»†çš„åˆ’åˆ†

å†…å­˜4åŒºï¼Œä»£ç +æ•°æ®

æ ˆåŒºï¼šå‡½æ•°è°ƒç”¨æ ˆï¼Œä¿å­˜å±€éƒ¨å˜é‡æœ¬è´¨ä¸Šæ˜¯åœ¨ä¿å­˜å¯„å­˜å™¨çŠ¶æ€ï¼Œè¦å¤åˆ¶åˆ°ä¸€å—å†…å­˜é‡Œå°±åœ¨æ ˆåŒº

å †åŒºï¼šå†…å­˜çš„åŠ¨æ€åˆ†é…ï¼Œcç”¨å¤šå°‘è¯·æ±‚å¤šå°‘ï¼Œcæ“ä½œç³»ç»Ÿç®¡ï¼Œnodejsç”³è¯·ä¸€å¤§å—ï¼Œnodejsè‡ªå·±ç®¡

é™æ€åŒºï¼šä¿å­˜å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œå­—ç¬¦ä¸²å°±æ˜¯åœ¨å…¨å±€åŒºé‡Œ

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-08 ä¸‹åˆ9.50.24.png" alt="æˆªå±2021-06-08 ä¸‹åˆ9.50.24" style="zoom:50%;" />

## Docker

### å¾®æœåŠ¡

ä¸dockeræ— å¿…ç„¶è”ç³»ï¼Œæœ¬è´¨æ˜¯ä¸šåŠ¡æ¨¡å—åŒ–

å¾®æœåŠ¡å±äº**æ¶æ„å±‚é¢**çš„è®¾è®¡æ¨¡å¼

å¾®æœåŠ¡çš„è®¾è®¡æ¦‚å¿µä»¥**ä¸šåŠ¡åŠŸèƒ½**ä¸ºä¸»

å¾®æœåŠ¡**ç‹¬ç«‹æä¾›**å¯¹åº”çš„ä¸šåŠ¡åŠŸèƒ½

å¾®æœåŠ¡**ä¸æ‹˜æ³¥**äºå…·ä½“çš„å®ç°**è¯­è¨€**ï¼Œçµæ´»

å¾®æœåŠ¡æ¶æ„ â‰ˆ **æ¨¡å—åŒ–å¼€å‘ + åˆ†å¸ƒå¼è®¡ç®—**

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-12 ä¸‹åˆ2.11.19.png" alt="æˆªå±2021-06-12 ä¸‹åˆ2.11.19" style="zoom:50%;" />

å·¦ï¼Œä¼ ç»Ÿç»“æ„ï¼Œå³ï¼Œå¾®æœåŠ¡

ä¼ ç»Ÿç»“æ„ï¼šå‡½æ•°çº§è°ƒç”¨ï¼Œè°ƒç”¨æ–¹ä¾¿ï¼Œå¿«ï¼›å¤æ‚ç³»ç»Ÿä¸æ˜“ç»´æŠ¤

å¾®æœåŠ¡

DBMSï¼šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿ

å•ä½“åº”ç”¨æ¶æ„ï¼šæ•°æ®åº“ç®¡ç†ç³»ç»Ÿå¯¹å¤–æä¾›çš„æœåŠ¡é€šè¿‡socketï¼ˆç½‘ç»œå¥—æ¥å­—ï¼Œå±äºæ•°æ®ä¼ è¾“å±‚ï¼‰ï¼Œä¼ è¾“å±‚åŒ…å«tcpå’Œudpï¼Œåœ¨tcpä¹‹ä¸Šå°è£…è‡ªå·±çš„ç§æœ‰åè®®ï¼Œé“¾æ¥tcpæ—¶ä¼šæœ‰æ¶ˆè€—ï¼Œæ¶ˆè€—æ•°æ®åº“æœåŠ¡å™¨çš„ç«¯å£ï¼Œæ¯ä¸ªé“¾æ¥éƒ½ä¼šç»´æŠ¤tcpçš„ä¼šè¯ï¼Œæœ‰ä¸Šé™ï¼Œæ•°æ®åº“æœ‰è¿æ¥æ± ï¼Œæ¯ä¸ªè¿æ¥æ± éƒ½æ˜¯ç»´æŠ¤tcpä¼šè¯çš„ï¼Œåº”ç”¨æ–¹é¢ä¹Ÿéœ€è¦ä¸€ä¸ªè¿æ¥æ± ï¼Œç»´æŠ¤å®¢æˆ·ç«¯ä¼šè¯ã€‚å•ä½“åº”ç”¨æœåŠ¡å‹åŠ›è¿‡å¤§æ—¶ï¼Œè´Ÿè½½å‡è¡¡ï¼Œæ¯åŠ ä¸€ä¸ªè´Ÿè½½ï¼Œå¤åˆ¶ä¸€ä»½ä»£ç ï¼Œæ¯”å¦‚ä¸€ä¸ªå•ä½“åº”ç”¨çš„ä¼šè¯è¿æ¥æ± æ˜¯10ä¸ªï¼Œæ¯å¤šä¸€ä¸ªè´Ÿè½½è¿æ¥æ± å¤š10ä¸ªï¼Œæ•°æ®åº“ä¹Ÿæ˜¯ä¸€æ ·å¤šï¼Œæ•°æ®åº“å°±éœ€è¦åšæ‰©å±•ï¼Œåˆ†å¸ƒå¼ï¼Œæ•°æ®åº“åšæ‰©å±•æœ‰éšœç¢ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå¤æ‚æ€§æé«˜ã€‚å¹¶å‘ç“¶é¢ˆéš¾ä»¥çªç ´

toBï¼Œç¨³å®šæ€§

toCï¼Œå¹¶å‘æ ‘

> æ•°æ®ä¸­å°ï¼Œä¸šåŠ¡è§’åº¦å’ŒæŠ€æœ¯æ— å…³ï¼Œç®¡ç†ä¸šåŠ¡

å¾®æœåŠ¡ï¼šä»¥ä¸šåŠ¡ä¸ºå•ä½æ‹†åˆ†ï¼Œç›¸äº’ç‹¬ç«‹ï¼Œç‹¬ç«‹è¿›ç¨‹ï¼Œé€šè¿‡ipç«¯å£è¿›è¡Œå®šä½ï¼Œå®¢æˆ·ç«¯é€šè¿‡**apiç½‘å…³**æ‰¾åˆ°å¯¹åº”æœåŠ¡ï¼Œapiç½‘å…³ä¹Ÿæ˜¯æ¶æ„æ¨¡å¼ï¼ŒæŠŠè¯·æ±‚ç»Ÿä¸€å…¥å£è¿›è¡ŒæœåŠ¡ã€‚apiåšçš„äº‹æƒ…ï¼Œè¯·æ±‚ä»£ç†åˆ°å¾®æœåŠ¡ï¼Œå°†åé¢çš„æœåŠ¡æä¾›çš„æ•°æ®èšåˆï¼ˆåœ¨å‰ç«¯æ˜¯BFFï¼‰ã€‚ä¸šåŠ¡æ¨¡å—ä¹‹é—´éœ€è¦å…³è”ï¼Œæ‰€ä»¥è¿˜éœ€è¦æä¾›æœåŠ¡ä¹‹é—´çš„é€šè®¯æ‰‹æ®µï¼Œæœ‰å¤šç§å°è£…æ–¹å¼ï¼Œæ¯”å¦‚restfulæ¥å£ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¾®æœåŠ¡æ¡†æ¶ï¼ˆæä¾›æ¨¡å—ä¹‹é—´çš„è°ƒç”¨æ‰‹æ®µï¼Œä¹Ÿæ˜¯åŸºäºtcpï¼Œå°è£…ç§æœ‰åè®®ï¼‰ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½æœ‰è‡ªå·±çš„æ•°æ®åº“å®ä¾‹ï¼ˆä¸€èˆ¬ä¸åŒæœºå™¨ï¼Œåˆ†æµäº†æ•°æ®åº“çš„å‹åŠ›ï¼‰åˆ†æµäº†æ•°æ®åº“å’Œä¸šåŠ¡æœåŠ¡å™¨çš„å‹åŠ›ï¼Œæ•°æ®åº“ä¹‹é—´çš„å…³è”ï¼Œç´¢å¼•å…³è”ã€‚å‹åŠ›å¤§æ—¶å¢åŠ å®ä¾‹ï¼Œå…¶ä½™æ—¶é—´å…³æ‰

ç‰¹ç‚¹ï¼š

å°, ä¸”ä¸“æ³¨äºåšä¸€ä»¶äº‹æƒ…ï¼Œunixå“²å­¦

å¤„äºç‹¬ç«‹çš„è¿›ç¨‹ä¸­

è½»é‡çº§çš„é€šä¿¡æœºåˆ¶ï¼Œé‡é‡é€šä¿¡æœºåˆ¶åŸºäºhttpï¼Œä¸šåŠ¡æ•°æ®å¯ä»¥ä½¿ç”¨jsonæˆ–xmlå°è£…ï¼Œè¾ƒè½»é‡ï¼Œæ›´è½»é‡äº‹ä»¥äºŒè¿›åˆ¶å½¢å¼è¿›è¡Œå°è£…ï¼Œhttp2ä½¿ç”¨çš„äºŒè¿›åˆ¶å¸§è¿›è¡Œå°è£…çš„

æ¾è€¦åˆã€ç‹¬ç«‹éƒ¨ç½²ï¼Œç»´æŠ¤æˆæœ¬ä½ä¸€äº›

#### åˆç†ä½¿ç”¨

ä¸šåŠ¡å¤æ‚åº¦é«˜

å›¢é˜Ÿè§„æ¨¡å¤§

ä¸šåŠ¡éœ€è¦é•¿æœŸæ¼”è¿›ï¼Œäº’è”ç½‘åº”ç”¨ï¼Œä¸šåŠ¡è§„åˆ™ä¸æ–­å˜åŒ–

æœ€åâ€”â€”æ²¡æœ‰é“¶å¼¹

#### é›†æˆä¸éƒ¨ç½²

æŒç»­é›†æˆâ€”â€”jekins

è™šæ‹ŸåŒ–â€”â€”è™šæ‹Ÿæœº

å®¹å™¨â€”â€”Dockerï¼Œæ‰“åŒ…

### docker

Dockeræ˜¯ä¸€ä¸ªå¼€æºçš„å¼•æ“ï¼Œå¯ä»¥è½»æ¾çš„ä¸ºä»»ä½•åº”ç”¨åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„ã€å¯ç§»æ¤çš„ã€ è‡ªç»™è‡ªè¶³çš„å®¹å™¨ã€‚å¼€å‘è€…åœ¨ç¬”è®°æœ¬ä¸Šç¼–è¯‘æµ‹è¯•é€šè¿‡çš„å®¹å™¨å¯ä»¥æ‰¹é‡åœ°åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ éƒ¨ç½²ï¼ŒåŒ…æ‹¬VMs(è™šæ‹Ÿæœº)ã€bare metalã€OpenStack é›†ç¾¤å’Œå…¶ä»–çš„åŸºç¡€åº”ç”¨å¹³å°ã€‚

Dockeré€šå¸¸ç”¨äºå¦‚ä¸‹åœºæ™¯:

- webåº”ç”¨çš„è‡ªåŠ¨åŒ–æ‰“åŒ…å’Œå‘å¸ƒ;
- è‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŒç»­é›†æˆã€å‘å¸ƒ; 
- åœ¨æœåŠ¡å‹ç¯å¢ƒä¸­éƒ¨ç½²å’Œè°ƒæ•´æ•°æ®åº“æˆ–å…¶ä»–çš„åå°åº”ç”¨; 
- ä»å¤´ç¼–è¯‘æˆ–è€…æ‰©å±•ç°æœ‰çš„OpenShiftæˆ–Cloud Foundryå¹³å°æ¥æ­å»ºè‡ªå·±çš„PaaSç¯å¢ƒã€‚

#### Docker vs. VM

VM: 

è¿è¡Œåœ¨å®¿ä¸»æœºä¹‹ä¸Šçš„å®Œæ•´çš„æ“ä½œç³»ç»Ÿ

è¿è¡Œè‡ªèº«æ“ä½œç³»ç»Ÿä¼šå ç”¨è¾ƒå¤šçš„èµ„æº

Docker: é€šè¿‡dockerä½¿ç”¨å®¿ä¸»çš„æ“ä½œç³»ç»Ÿ

Dockeræ›´åŠ è½»é‡é«˜æ•ˆ

å¯¹ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨ç‡å¾ˆé«˜ï¼Œæ— æ³•æ§åˆ¶cpuä½¿ç”¨

æ¯”è™šæ‹ŸæœºæŠ€æœ¯æ›´ä¸ºè½»ä¾¿ã€å¿«æ·

éš”ç¦»æ•ˆæœä¸å¦‚VM

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-12 ä¸‹åˆ3.59.24.png" alt="æˆªå±2021-06-12 ä¸‹åˆ3.59.24" style="zoom:50%;" />

è¿›ç¨‹ä¸¤ç§çŠ¶æ€ï¼šç”¨æˆ·æ€heå†…æ ¸æ€ï¼Œå†…æ ¸æ€éœ€è¦æ“ä½œç³»ç»Ÿè°ƒç”¨ï¼Œå®¹å™¨é€šè¿‡dockerä½¿ç”¨å®¿ä¸»çš„æ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥è½»é‡ï¼Œä½†æ˜¯éš”ç¦»æ•ˆæœä¸å¥½ï¼Œå¯èƒ½å½±å“åˆ°å…¶ä»–è¿›ç¨‹

#### æ¦‚å¿µ

Dockeræ˜¯CSæ¶æ„ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªæ¦‚å¿µ: 

Docker daemon:

è¿è¡Œåœ¨å®¿ä¸»æœºä¸Š

Dockerå®ˆæŠ¤è¿›ç¨‹

ç”¨æˆ·é€šè¿‡Docker client(Dockerå‘½ä»¤)ä¸Docker daemonäº¤äº’

Docker client:

Docker å‘½ä»¤è¡Œå·¥å…·ï¼Œæ˜¯ç”¨æˆ·ä½¿ç”¨Dockerçš„ä¸»è¦æ–¹å¼

Docker clientä¸Docker daemoné€šä¿¡å¹¶å°†ç»“æœè¿”å›ç»™ç”¨æˆ·

Docker clientä¹Ÿå¯ä»¥é€šè¿‡socketæˆ–è€…RESTful apiè®¿é—®è¿œç¨‹çš„ Docker daemon

```cmd
# å®¢æˆ·ç«¯å‘½ä»¤ï¼Œæ“ä½œ
docker
# æœåŠ¡å™¨ç«¯å‘½ä»¤ï¼Œå¹²æ´»ï¼Œæ„å»ºé•œåƒï¼Œä»é•œåƒåˆ›å»ºå®¹å™¨ï¼Œå®¹å™¨å°±æ˜¯é•œåƒçš„å®ä¾‹
systemctl status docker
```

dockeråªèƒ½è·‘åœ¨linuxï¼Œunix

#### docker file

Dockerfile æ¦‚å¿µ

Dockerfile æ–‡ä»¶æ ¼å¼

æ„å»ºé•œåƒ

é•œåƒæ ‡ç­¾

ä¿®æ”¹å®¹å™¨å†…å®¹

.dockerignore

ä¸¤ç§å¯åŠ¨æ¨¡å¼ï¼šç¬¬ä¸€æ¬¡runï¼Œé•œåƒåˆ°å®¹å™¨çš„è½¬æ¢ï¼Œåˆå§‹åŒ–ï¼Œnæ¬¡ä½¿ç”¨start

## k8s

è¿ç»´

### å®šä¹‰

Kubernetesï¼Œå› ä¸ºé¦–å°¾å­—æ¯ä¸­é—´æœ‰8ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥è¢«ç®€å†™æˆ K8sã€‚

K8s æ˜¯åº•å±‚èµ„æºï¼ˆç¡¬ä»¶ï¼Œcpuï¼Œå†…å­˜ï¼Œç½‘ç»œèµ„æºï¼Œç½‘å…³ç³»ç»Ÿï¼‰ä¸å®¹å™¨é—´çš„ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œå¦‚æœå’Œå•æœºæ¶æ„ç±»æ¯”ï¼Œå¯ä»¥ç®—ä½œæ˜¯ä¸€ä¸ª**åˆ†å¸ƒå¼**æ—¶ä»£çš„Linuxã€‚

K8s æ˜¯ Google å¼€æºçš„å®¹å™¨é›†ç¾¤ç®¡ç†ç³»ç»Ÿã€‚åœ¨ Docker æŠ€æœ¯çš„åŸºç¡€ä¸Šï¼Œä¸º å®¹å™¨åŒ–çš„åº”ç”¨æä¾›éƒ¨ç½²è¿è¡Œã€èµ„æºè°ƒåº¦ã€æœåŠ¡å‘ç°å’ŒåŠ¨æ€ä¼¸ç¼©ç­‰ä¸€ç³»åˆ— å®Œæ•´åŠŸèƒ½ï¼Œæé«˜äº†å¤§è§„æ¨¡å®¹å™¨é›†ç¾¤ç®¡ç†çš„ä¾¿æ·æ€§ã€‚

### ç‰¹ç‚¹

k8sæ˜¯ä¸€ä¸ªç®¡ç†å®¹å™¨çš„å·¥å…·ï¼Œä¹Ÿæ˜¯**ç®¡ç†åº”ç”¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªå·¥å…·ï¼Œ ä»åˆ›å»ºåº”ç”¨ï¼Œåº”ç”¨çš„éƒ¨ç½²ï¼Œåº”ç”¨æä¾›æœåŠ¡ï¼Œæ‰©å®¹ç¼©å®¹åº”ç”¨ï¼Œåº”ç”¨æ›´æ–°**ï¼Œ è€Œä¸”å¯ä»¥åšåˆ°æ•…éšœè‡ªæ„ˆã€‚

å¯ç§»æ¤:  æ”¯æŒå…¬æœ‰äº‘ï¼Œç§æœ‰äº‘ï¼Œæ··åˆäº‘;

å¯æ‰©å±•: æ¨¡å—åŒ–ï¼Œçƒ­æ’æ‹¨ï¼ˆè‡ªåŠ¨æ¥å…¥æ–°è®¾å¤‡ï¼ŒæœåŠ¡å™¨æœ‰é—®é¢˜å¯é€€å‡ºï¼‰ï¼Œå¯ç»„åˆ;

è‡ªæ„ˆ: è‡ªåŠ¨æ›¿æ¢ï¼Œè‡ªåŠ¨é‡å¯ï¼Œè‡ªåŠ¨å¤åˆ¶ï¼Œè‡ªåŠ¨æ‰©å±•ã€‚

### æ­¥éª¤

åœ¨k8sè¿›è¡Œç®¡ç†åº”ç”¨çš„æ—¶å€™ï¼ŒåŸºæœ¬æ­¥éª¤æ˜¯: 

åˆ›å»ºé›†ç¾¤

éƒ¨ç½²åº”ç”¨

å‘å¸ƒåº”ç”¨

æ‰©å±•åº”ç”¨

æ›´æ–°åº”ç”¨

### æ¶æ„ç»“æ„

ç”Ÿæ€ç³»ç»Ÿï¼Œå¤–å›´æ”¯æŒ

æ¥å£å±‚ï¼Œå¯¹å¤–æä¾›æ¥å£

ç®¡ç†å±‚ï¼Œå¸¸ç”¨

åº”ç”¨å±‚ï¼Œå…·ä½“åšäº‹

æ ¸å¿ƒå±‚ï¼Œå¯¹å¤–æŠ€æœ¯

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-12 ä¸‹åˆ7.09.11.png" alt="æˆªå±2021-06-12 ä¸‹åˆ7.09.11" style="zoom:50%;" />

### æ¦‚å¿µ 

ä¸»æœº(Master): ç®¡ç†ï¼Œç”¨äºæ§åˆ¶ Kubernetes èŠ‚ç‚¹çš„è®¡ç®—æœºã€‚æ‰€æœ‰ä»»åŠ¡åˆ†é…éƒ½æ¥è‡ªäºæ­¤ã€‚

èŠ‚ç‚¹(Node): å¹²æ´»ï¼Œæ‰§è¡Œè¯·æ±‚å’Œåˆ†é…ä»»åŠ¡çš„è®¡ç®—æœºã€‚ç”± Kubernetes ä¸»æœºè´Ÿè´£å¯¹èŠ‚ç‚¹è¿›è¡Œæ§åˆ¶ã€‚

å®¹å™¨é›†(Pod): éƒ¨ç½²åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šçš„ï¼Œä¸”åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨çš„å®¹å™¨ç»„ã€‚åŒä¸€å®¹å™¨é›†ä¸­çš„æ‰€æœ‰å®¹å™¨å…±äº«åŒä¸€ä¸ª IP åœ°å€ã€IPCã€ä¸»æœºåç§°åŠå…¶å®ƒèµ„æºã€‚å®¹å™¨é›†ä¼šå°†ç½‘ç»œå’Œå­˜å‚¨ä»åº•å±‚å®¹å™¨ä¸­æŠ½è±¡å‡ºæ¥ã€‚è¿™æ ·ï¼Œ æ‚¨å°±èƒ½æ›´åŠ è½»æ¾åœ°åœ¨é›†ç¾¤ä¸­ç§»åŠ¨å®¹å™¨ã€‚

å¤åˆ¶æ§åˆ¶å™¨(Replication controller): è·‘åœ¨ä¸»æœºï¼Œç”¨äºæ§åˆ¶åº”åœ¨é›†ç¾¤æŸå¤„è¿è¡Œçš„å®Œå…¨ç›¸åŒçš„å®¹å™¨é›†å‰¯æœ¬æ•°é‡ã€‚

æœåŠ¡(Service): è·‘åœ¨èŠ‚ç‚¹ï¼ŒæœåŠ¡å¯å°†å·¥ä½œå®šä¹‰ï¼ˆk8sè‡ªå·±çš„ä¸šåŠ¡ï¼‰ä¸å®¹å™¨é›†åˆ†ç¦»ã€‚Kubernetes æœåŠ¡ä»£ç†ä¼šè‡ªåŠ¨å°†æœåŠ¡è¯·æ±‚åˆ†é…åˆ°æ­£ ç¡®çš„å®¹å™¨é›†â€”â€”æ— è®ºè¿™ä¸ªå®¹å™¨é›†ä¼šç§»åˆ°é›†ç¾¤ä¸­çš„å“ªä¸ªä½ç½®ï¼Œå³ä½¿å®ƒå·²è¢«æ›¿æ¢ã€‚

Kubelet: è¿™æ˜¯ä¸€ä¸ªåœ¨èŠ‚ç‚¹ä¸Šè¿è¡Œçš„æœåŠ¡ï¼Œè¿è¡Œæ ¸å¿ƒï¼Œå¯è¯»å–å®¹å™¨æ¸…å•ï¼Œç¡®ä¿æŒ‡å®šçš„å®¹å™¨å¯åŠ¨å¹¶è¿è¡Œã€‚ 

kubectl: Kubernetes çš„å‘½ä»¤è¡Œé…ç½®å·¥å…·ã€‚

etcdï¼Œç®¡ç†é…ç½®æ–‡ä»¶çš„è¿›ç¨‹

ä¸¤ä¸ªèŠ‚ç‚¹

ä»£ç†

<img src="/Users/huangsiying/data/yd/Naixesé˜¶æ®µæ€§å­¦ä¹ ç¬”è®°.assets/æˆªå±2021-06-12 ä¸‹åˆ7.25.02.png" alt="æˆªå±2021-06-12 ä¸‹åˆ7.25.02" style="zoom:50%;" />

### å®‰è£…

åœ¨Linuxä¸‹å®‰è£…å•æœºç‰ˆçš„é›†ç¾¤ç¯å¢ƒ

ä»¥rootèº«ä»½æ‰§è¡Œä»¥ä¸‹æ“ä½œ: 

1ã€å…³é—­Linuxé˜²ç«å¢™

systemctl stop firewalld

systemctl disable firewalld 

2ã€å®‰è£…Kuberneteså’Œä¾èµ–ç»„ä»¶etcd

yum install -y etcd kubernetes 

3ã€ä¿®æ”¹é…ç½®

Dockeré…ç½®æ–‡ä»¶/etc/sysconfig/docker, OPTIONS=â€˜-- selinux-enabled=false --insecure-registry gcr.io'

Kubernetes apiservceé…ç½®æ–‡ä»¶/etc/kubernetes/apiserver, æŠŠ--admission-controlå‚æ•°ä¸­çš„ServiceAccountåˆ é™¤

4ã€æŒ‰é¡ºåºå¯åŠ¨æ‰€æœ‰çš„æœåŠ¡

systemctl start etcdï¼Œè¯»å–é…ç½®æ–‡ä»¶ç”¨åˆ°ï¼Œmasterè¿›ç¨‹ongdao

systemctl start dockerï¼Œåœ¨schedulerå‰æ‰§è¡Œï¼Œ nodeè¿›ç¨‹

systemctl start kube-apiserverï¼Œmasterè¿›ç¨‹

systemctl start kube-controller-managerï¼Œmasterè¿›ç¨‹

systemctl start kube-schedulerï¼Œ nodeè¿›ç¨‹

systemctl start kubeletï¼Œ nodeè¿›ç¨‹

systemctl start kube-proxyï¼Œ nodeè¿›ç¨‹

1ã€å®˜ç½‘ https://kubernetes.io

2ã€Chart åº”ç”¨ä»“åº“ https://hub.kubeapps.com/

3ã€ä¸­æ–‡æ‰‹å†Œ https://www.kubernetes.org.cn/docs

minikuber

